<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferretería Bruzzone - Tu Ferretería Online</title>
    
    <!-- Forzar apertura en navegador externo desde Instagram/Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ferretería Bruzzone">
    <meta property="og:description" content="Tu ferretería online - Los mejores productos al mejor precio">
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Detectar Instagram/Facebook WebView y mostrar botón para abrir en navegador -->
    <script>
    (function() {
        var ua = navigator.userAgent || navigator.vendor || window.opera;
        var isInstagram = ua.indexOf('Instagram') > -1;
        var isFacebook = ua.indexOf('FBAN') > -1 || ua.indexOf('FBAV') > -1;
        
        if(isInstagram || isFacebook) {
            // Mostrar overlay para abrir en navegador externo
            document.addEventListener('DOMContentLoaded', function() {
                var overlay = document.createElement('div');
                overlay.id = 'webviewOverlay';
                overlay.style.cssText = 'position:fixed;inset:0;background:linear-gradient(135deg,#2A7AB8,#1E5F8F);z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px;text-align:center;';
                overlay.innerHTML = '<div style="background:white;border-radius:20px;padding:40px 30px;max-width:350px;box-shadow:0 20px 60px rgba(0,0,0,0.3);">' +
                    '<i class="fas fa-store" style="font-size:60px;color:#2A7AB8;margin-bottom:20px;"></i>' +
                    '<h2 style="margin:0 0 15px;color:#1A1A2E;font-size:24px;">Ferretería Bruzzone</h2>' +
                    '<p style="color:#666;margin-bottom:25px;font-size:15px;">Para una mejor experiencia, abrí la tienda en tu navegador</p>' +
                    '<a href="' + window.location.href + '" target="_blank" rel="noopener" style="display:block;background:#2A7AB8;color:white;padding:15px 30px;border-radius:10px;text-decoration:none;font-weight:600;font-size:16px;margin-bottom:15px;">' +
                    '<i class="fas fa-external-link-alt" style="margin-right:8px;"></i>Abrir en Navegador</a>' +
                    '<button onclick="document.getElementById(\'webviewOverlay\').style.display=\'none\'" style="background:none;border:2px solid #ddd;color:#666;padding:12px 25px;border-radius:10px;font-size:14px;cursor:pointer;">Continuar aquí</button>' +
                    '</div>';
                document.body.insertBefore(overlay, document.body.firstChild);
            });
        }
    })();
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #2A7AB8;
            --primary-dark: #1E5F8F;
            --primary-light: #4A9AD4;
            --secondary: #1A1A2E;
            --secondary-light: #25253D;
            --accent: #00D4AA;
            --warning: #FFB800;
            --danger: #FF4757;
            --success: #00C853;
            --bg-main: #F8F9FC;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A2E;
            --text-secondary: #6B7280;
            --text-light: #9CA3AF;
            --border: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius: 12px;
            --radius-lg: 16px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-main); color: var(--text-primary); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        
        /* Loader */
        .loader-overlay { position: fixed; inset: 0; background: var(--secondary); display: flex; align-items: center; justify-content: center; z-index: 10000; transition: opacity 0.5s; }
        .loader-overlay.hidden { opacity: 0; pointer-events: none; display: none !important; }
        .loader-icon { width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: 20px; display: flex; align-items: center; justify-content: center; animation: pulse 1.5s ease-in-out infinite; }
        .loader-icon i { font-size: 36px; color: white; }
        .loader-text { color: white; font-size: 18px; font-weight: 600; margin-top: 20px; text-align: center; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Promo Slider */
        .promo-slider { position: relative; overflow: hidden; background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%); }
        .promo-slides { display: flex; transition: transform 0.5s ease-in-out; }
        .promo-slide { min-width: 100%; padding: 60px 20px; display: flex; align-items: center; justify-content: center; }
        .promo-content { max-width: 1200px; display: flex; align-items: center; gap: 60px; width: 100%; }
        .promo-text { flex: 1; color: white; }
        .promo-badge { display: inline-block; background: var(--primary); color: white; padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .promo-title { font-family: 'Space Grotesk', sans-serif; font-size: 42px; font-weight: 700; line-height: 1.2; margin-bottom: 15px; }
        .promo-title span { color: var(--primary); }
        .promo-desc { font-size: 18px; color: rgba(255,255,255,0.8); margin-bottom: 25px; }
        .promo-price { display: flex; align-items: baseline; gap: 15px; margin-bottom: 25px; }
        .promo-price-old { font-size: 24px; color: rgba(255,255,255,0.5); text-decoration: line-through; }
        .promo-price-new { font-size: 48px; font-weight: 800; color: var(--accent); }
        .promo-btn { display: inline-flex; align-items: center; gap: 10px; background: var(--primary); color: white; padding: 16px 32px; border-radius: var(--radius); font-weight: 600; text-decoration: none; transition: 0.3s; border: none; cursor: pointer; font-size: 16px; }
        .promo-btn:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .promo-image { flex: 0 0 400px; height: 300px; background: rgba(255,255,255,0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .promo-image img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .promo-image i { font-size: 120px; color: rgba(255,255,255,0.3); }
        .promo-nav { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        .promo-dot { width: 12px; height: 12px; border-radius: 50%; background: rgba(255,255,255,0.3); border: none; cursor: pointer; transition: 0.3s; }
        .promo-dot.active { background: var(--primary); width: 30px; border-radius: 6px; }
        .promo-arrows { position: absolute; top: 50%; transform: translateY(-50%); width: 100%; display: flex; justify-content: space-between; padding: 0 20px; pointer-events: none; }
        .promo-arrow { width: 50px; height: 50px; background: rgba(255,255,255,0.1); border: none; border-radius: 50%; color: white; font-size: 20px; cursor: pointer; transition: 0.3s; pointer-events: auto; }
        .promo-arrow:hover { background: var(--primary); }
        @media (max-width: 900px) {
            .promo-content { flex-direction: column; text-align: center; gap: 30px; }
            .promo-title { font-size: 28px; }
            .promo-image { flex: 0 0 200px; width: 100%; height: 200px; }
            .promo-price-new { font-size: 36px; }
            .promo-price { justify-content: center; }
        }

        /* Admin Login Modal */
        .login-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 0; visibility: hidden; transition: 0.3s; }
        .login-modal.active { opacity: 1; visibility: visible; }
        .login-box { background: white; border-radius: var(--radius-lg); padding: 40px; width: 100%; max-width: 420px; text-align: center; transform: scale(0.9); transition: 0.3s; }
        .login-modal.active .login-box { transform: scale(1); }
        .login-logo { width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; }
        .login-logo i { font-size: 36px; color: white; }
        .login-title { font-family: 'Space Grotesk', sans-serif; font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .login-subtitle { color: var(--text-secondary); margin-bottom: 30px; }
        .login-form { text-align: left; }
        .login-form .form-group { margin-bottom: 20px; }
        .login-form .form-label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        .login-form .form-input { width: 100%; padding: 14px 16px; border: 2px solid var(--border); border-radius: var(--radius); font-size: 15px; transition: 0.3s; }
        .login-form .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(255,107,53,0.1); }
        .login-error { background: #FEE2E2; color: var(--danger); padding: 12px; border-radius: var(--radius); margin-bottom: 20px; font-size: 14px; display: none; }
        .login-error.show { display: block; }
        .login-btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: var(--radius); font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .login-btn:hover { background: var(--primary-dark); }
        .login-btn:disabled { background: var(--text-light); cursor: not-allowed; }
        .login-back { margin-top: 20px; }
        .login-back a { color: var(--text-secondary); text-decoration: none; font-size: 14px; }
        .login-back a:hover { color: var(--primary); }
        
        /* Firebase Status */
        .firebase-status { position: fixed; bottom: 20px; right: 20px; padding: 10px 16px; border-radius: var(--radius); font-size: 13px; font-weight: 500; z-index: 1000; display: flex; align-items: center; gap: 8px; }
        .firebase-status.online { background: #D1FAE5; color: #065F46; }
        .firebase-status.offline { background: #FEE2E2; color: #991B1B; }
        
        /* WhatsApp Button */
        .whatsapp-btn { position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; background: #25D366; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; text-decoration: none; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); z-index: 999; transition: all 0.3s ease; }
        .whatsapp-btn:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(37, 211, 102, 0.5); }
        .whatsapp-btn .tooltip { position: absolute; right: 70px; background: white; color: var(--text-primary); padding: 10px 15px; border-radius: var(--radius); font-size: 14px; white-space: nowrap; box-shadow: var(--shadow-lg); opacity: 0; visibility: hidden; transition: 0.3s; }
        .whatsapp-btn:hover .tooltip { opacity: 1; visibility: visible; }
        @media (max-width: 768px) { .whatsapp-btn { bottom: 80px; width: 55px; height: 55px; font-size: 26px; } .whatsapp-btn .tooltip { display: none; } }
        .firebase-status.syncing { background: #FEF3C7; color: #92400E; }
        
        /* Header */
        .store-header { background: var(--secondary); color: white; position: sticky; top: 0; z-index: 1000; }
        .header-top { background: var(--secondary-light); padding: 8px 0; font-size: 13px; }
        .header-top .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .header-top a { color: rgba(255,255,255,0.8); text-decoration: none; transition: 0.3s; }
        .header-top a:hover { color: var(--primary); }
        .header-main { padding: 15px 0; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .header-main .container { display: flex; align-items: center; gap: 30px; flex-wrap: wrap; }
        
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text-primary); }
        .logo-icon { width: 48px; height: 48px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .logo-icon i { font-size: 24px; }
        .logo-text { font-family: 'Space Grotesk', sans-serif; font-size: 24px; font-weight: 700; }
        .logo-text span { color: var(--primary); }
        .logo-img { height: 50px; width: auto; object-fit: contain; }
        .logo-img-admin { height: 40px; width: auto; object-fit: contain; filter: brightness(0) invert(1); }
        .footer-about .logo-img { background: white; padding: 8px 15px; border-radius: 8px; }
        
        .search-box { flex: 1; max-width: 500px; position: relative; min-width: 200px; }
        .search-box input { width: 100%; padding: 14px 50px 14px 20px; border: 1px solid var(--border); border-radius: 50px; font-size: 15px; background: var(--bg-main); color: var(--text-primary); transition: 0.3s; }
        .search-box input::placeholder { color: var(--text-light); }
        .search-box input:focus { outline: none; border-color: var(--primary); background: white; }
        .search-box button { position: absolute; right: 5px; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border: none; background: var(--primary); color: white; border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .search-box button:hover { background: var(--primary-dark); }
        
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .header-btn { display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: transparent; border: 1px solid var(--border); color: var(--text-primary); border-radius: 50px; cursor: pointer; transition: 0.3s; text-decoration: none; font-size: 14px; }
        .header-btn:hover { background: var(--bg-main); border-color: var(--primary); color: var(--primary); }
        .header-btn.primary { background: var(--primary); border-color: var(--primary); color: white; }
        .cart-btn { position: relative; }
        .cart-count { position: absolute; top: -8px; right: -8px; width: 22px; height: 22px; background: var(--danger); color: white; border-radius: 50%; font-size: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
        
        /* Nav */
        .main-nav { background: var(--secondary-light); padding: 0; overflow-x: auto; }
        .nav-list { display: flex; list-style: none; gap: 5px; min-width: max-content; }
        .nav-list a { display: block; padding: 15px 20px; color: rgba(255,255,255,0.8); text-decoration: none; font-weight: 500; transition: 0.3s; border-bottom: 3px solid transparent; white-space: nowrap; }
        .nav-list a:hover, .nav-list a.active { color: white; background: rgba(255,255,255,0.05); border-bottom-color: var(--primary); }
        .nav-list .admin-link { color: var(--accent); }
        
        /* Hero */
        .hero-section { background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%); padding: 60px 0; position: relative; overflow: hidden; }
        .hero-content { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: center; }
        .hero-text h1 { font-family: 'Space Grotesk', sans-serif; font-size: clamp(32px, 5vw, 48px); font-weight: 700; color: white; line-height: 1.2; margin-bottom: 20px; }
        .hero-text h1 span { color: var(--primary); }
        .hero-text p { font-size: 18px; color: rgba(255,255,255,0.7); margin-bottom: 30px; }
        .hero-buttons { display: flex; gap: 15px; flex-wrap: wrap; }
        .btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; font-size: 15px; font-weight: 600; border-radius: 50px; border: none; cursor: pointer; transition: 0.3s; text-decoration: none; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255,107,53,0.3); }
        .btn-secondary { background: white; color: var(--secondary); }
        .btn-secondary:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text-primary); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        .hero-stats { display: flex; gap: 40px; margin-top: 40px; flex-wrap: wrap; }
        .stat-item { text-align: center; }
        .stat-number { font-family: 'Space Grotesk', sans-serif; font-size: 36px; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 14px; color: rgba(255,255,255,0.6); }
        .hero-image { display: flex; justify-content: center; }
        .hero-card { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); }
        .hero-card-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .hero-product { background: white; border-radius: var(--radius); padding: 15px; text-align: center; transition: 0.3s; }
        .hero-product:hover { transform: translateY(-5px); }
        .hero-product i { font-size: 40px; color: var(--primary); margin-bottom: 10px; }
        .hero-product span { display: block; font-size: 13px; color: var(--text-secondary); }
        
        /* Sections */
        .section { padding: 60px 0; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
        .section-title { font-family: 'Space Grotesk', sans-serif; font-size: 28px; font-weight: 700; }
        .section-link { color: var(--primary); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .section-link:hover { gap: 10px; }
        
        /* Categories */
        .categories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .category-card { background: var(--bg-card); border-radius: var(--radius-lg); padding: 25px 20px; text-align: center; cursor: pointer; transition: 0.3s; border: 2px solid transparent; }
        .category-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); border-color: var(--primary); }
        .category-card.active { border-color: var(--primary); background: linear-gradient(135deg, rgba(255,107,53,0.05), rgba(255,107,53,0.1)); }
        .category-icon { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; }
        .category-icon i { font-size: 24px; color: white; }
        .category-name { font-weight: 600; font-size: 14px; margin-bottom: 5px; }
        .category-count { font-size: 12px; color: var(--text-secondary); }
        
        /* Products */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .product-card { background: #FFFFFF; border-radius: var(--radius-lg); overflow: hidden; transition: 0.3s; position: relative; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .product-badge { position: absolute; top: 15px; left: 15px; padding: 5px 12px; border-radius: 50px; font-size: 12px; font-weight: 600; z-index: 10; }
        .badge-sale { background: var(--danger); color: white; }
        .badge-new { background: var(--accent); color: white; }
        .badge-hot { background: var(--warning); color: var(--secondary); }
        .product-actions { position: absolute; top: 15px; right: 15px; display: flex; flex-direction: column; gap: 8px; opacity: 0; transform: translateX(20px); transition: 0.3s; }
        .product-card:hover .product-actions { opacity: 1; transform: translateX(0); }
        .product-action-btn { width: 40px; height: 40px; background: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow); transition: 0.3s; }
        .product-action-btn:hover { background: var(--primary); color: white; }
        .product-image { height: 200px; background: #FAFAFA; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; overflow: hidden; }
        .product-image i { font-size: 60px; color: var(--text-light); }
        .product-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; display: block !important; visibility: visible !important; opacity: 1 !important; }
        .product-card:hover .product-image img { transform: scale(1.05); }
        .image-counter { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 15px; font-size: 11px; z-index: 5; display: flex; align-items: center; gap: 4px; }
        .product-info { padding: 20px; background: #FFFFFF; }
        .product-category { font-size: 12px; color: var(--primary); font-weight: 600; text-transform: uppercase; margin-bottom: 8px; }
        .product-name { font-weight: 600; font-size: 16px; margin-bottom: 10px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .product-rating { display: flex; align-items: center; gap: 5px; margin-bottom: 12px; }
        .stars { color: var(--warning); font-size: 14px; }
        .rating-count { font-size: 13px; color: var(--text-secondary); }
        .product-price { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .price-current { font-family: 'Space Grotesk', sans-serif; font-size: 22px; font-weight: 700; color: var(--primary); }
        .price-original { font-size: 16px; color: var(--text-light); text-decoration: line-through; }
        .product-footer { display: flex; gap: 10px; }
        .add-cart-btn { flex: 1; padding: 12px; background: var(--primary); color: white; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .add-cart-btn:hover { background: var(--primary-dark); }
        .whatsapp-product-btn { padding: 12px 14px; background: #25D366; color: white; border: none; border-radius: var(--radius); cursor: pointer; transition: 0.3s; font-size: 16px; }
        .whatsapp-product-btn:hover { background: #128C7E; }
        .share-product-btn { padding: 12px 14px; background: #6366F1; color: white; border: none; border-radius: var(--radius); cursor: pointer; transition: 0.3s; font-size: 16px; }
        .share-product-btn:hover { background: #4F46E5; }
        .buy-now-btn { padding: 12px 20px; background: var(--secondary); color: white; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer; transition: 0.3s; }
        .buy-now-btn:hover { background: var(--secondary-light); }
        
        /* Features */
        .features-section { background: var(--secondary); padding: 40px 0; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; }
        .feature-item { display: flex; align-items: center; gap: 15px; color: white; }
        .feature-icon { width: 50px; height: 50px; background: rgba(255,107,53,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .feature-icon i { font-size: 20px; color: var(--primary); }
        .feature-text h4 { font-weight: 600; margin-bottom: 3px; }
        .feature-text p { font-size: 13px; color: rgba(255,255,255,0.6); }
        
        /* Footer */
        .store-footer { background: var(--secondary); color: white; padding: 60px 0 30px; }
        .footer-grid { display: grid; grid-template-columns: 2fr repeat(3, 1fr); gap: 40px; margin-bottom: 40px; }
        .footer-about .logo { margin-bottom: 20px; }
        .footer-about p { color: rgba(255,255,255,0.6); font-size: 14px; margin-bottom: 20px; }
        .social-links { display: flex; gap: 10px; }
        .social-link { width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; transition: 0.3s; }
        .social-link:hover { background: var(--primary); }
        .footer-title { font-weight: 700; margin-bottom: 20px; }
        .footer-links { list-style: none; }
        .footer-links li { margin-bottom: 10px; }
        .footer-links a { color: rgba(255,255,255,0.6); text-decoration: none; font-size: 14px; transition: 0.3s; }
        .footer-links a:hover { color: var(--primary); }
        .footer-bottom { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .footer-bottom p { color: rgba(255,255,255,0.5); font-size: 14px; }
        .payment-methods { display: flex; gap: 10px; }
        .payment-methods i { font-size: 28px; color: rgba(255,255,255,0.5); }
        
        /* Cart Sidebar */
        .cart-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s; }
        .cart-overlay.active { opacity: 1; visibility: visible; }
        .cart-sidebar { position: fixed; top: 0; right: -450px; width: min(450px, 100%); height: 100%; background: white; z-index: 2001; transition: 0.3s; display: flex; flex-direction: column; }
        .cart-sidebar.active { right: 0; }
        .cart-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .cart-header h3 { font-family: 'Space Grotesk', sans-serif; font-size: 20px; }
        .close-cart { width: 40px; height: 40px; background: var(--bg-main); border: none; border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .close-cart:hover { background: var(--danger); color: white; }
        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .cart-item-image { width: 80px; height: 80px; background: var(--bg-main); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; flex-shrink: 0; overflow: hidden; }
        .cart-item-image i { font-size: 30px; color: var(--text-light); }
        .cart-item-info { flex: 1; }
        .cart-item-name { font-weight: 600; margin-bottom: 5px; }
        .cart-item-price { color: var(--primary); font-weight: 700; margin-bottom: 10px; }
        .cart-item-qty { display: flex; align-items: center; gap: 10px; }
        .qty-btn { width: 30px; height: 30px; border: 1px solid var(--border); background: white; border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .qty-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .qty-value { width: 40px; text-align: center; font-weight: 600; }
        .remove-item { color: var(--danger); cursor: pointer; font-size: 18px; transition: 0.3s; }
        .remove-item:hover { transform: scale(1.2); }
        .cart-empty { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
        .cart-empty i { font-size: 60px; color: var(--text-light); margin-bottom: 20px; display: block; }
        .cart-footer { padding: 20px; border-top: 1px solid var(--border); background: var(--bg-main); }
        .cart-summary { margin-bottom: 20px; }
        .cart-summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .cart-summary-row.total { font-size: 20px; font-weight: 700; padding-top: 10px; border-top: 1px solid var(--border); }
        .cart-summary-row.total .amount { color: var(--primary); }
        .checkout-btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: var(--radius); font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .checkout-btn:hover { background: var(--primary-dark); }
        
        /* Admin Panel */
        .admin-container { display: none; min-height: 100vh; }
        .admin-container.visible { display: flex; }
        .admin-sidebar { width: 280px; background: var(--secondary); color: white; position: fixed; height: 100%; overflow-y: auto; }
        .admin-logo { padding: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .admin-logo .logo-text { font-size: 20px; }
        .admin-badge { display: inline-block; padding: 4px 10px; background: var(--accent); color: white; font-size: 10px; font-weight: 700; border-radius: 20px; margin-left: 10px; }
        .admin-menu { padding: 20px 0; }
        .menu-section { margin-bottom: 25px; }
        .menu-title { padding: 0 25px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.4); margin-bottom: 10px; }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 12px 25px; color: rgba(255,255,255,0.7); text-decoration: none; cursor: pointer; transition: 0.3s; border-left: 3px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; }
        .menu-item.active { background: rgba(255,107,53,0.1); color: var(--primary); border-left-color: var(--primary); }
        .menu-item i { width: 20px; text-align: center; }
        .menu-item .badge { margin-left: auto; padding: 2px 8px; background: var(--danger); color: white; font-size: 11px; font-weight: 700; border-radius: 10px; }
        .admin-main { flex: 1; margin-left: 280px; background: var(--bg-main); }
        .admin-header { background: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; flex-wrap: wrap; gap: 15px; }
        .admin-header-left { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; }
        .back-to-store { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); text-decoration: none; font-size: 14px; transition: 0.3s; }
        .back-to-store:hover { color: var(--primary); }
        .admin-page-title { font-family: 'Space Grotesk', sans-serif; font-size: 24px; font-weight: 700; }
        .admin-header-right { display: flex; align-items: center; gap: 15px; }
        .admin-user { display: flex; align-items: center; gap: 12px; padding: 8px 15px; background: var(--bg-main); border-radius: 50px; }
        .admin-avatar { width: 36px; height: 36px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; }
        .admin-user-info { line-height: 1.3; }
        .admin-user-name { font-weight: 600; font-size: 14px; }
        .admin-user-role { font-size: 12px; color: var(--text-secondary); }
        .admin-content { padding: 30px; }
        
        /* Admin Sections */
        .admin-section { display: none; animation: fadeIn 0.3s ease; }
        .admin-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .stat-card { background: white; border-radius: var(--radius-lg); padding: 25px; position: relative; overflow: hidden; }
        .stat-card::after { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100%; background: linear-gradient(135deg, transparent, rgba(255,107,53,0.05)); }
        .stat-icon { width: 50px; height: 50px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; margin-bottom: 15px; }
        .stat-icon.blue { background: rgba(59,130,246,0.1); color: #3B82F6; }
        .stat-icon.green { background: rgba(0,200,83,0.1); color: var(--success); }
        .stat-icon.orange { background: rgba(255,107,53,0.1); color: var(--primary); }
        .stat-icon.purple { background: rgba(139,92,246,0.1); color: #8B5CF6; }
        .stat-value { font-family: 'Space Grotesk', sans-serif; font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .stat-card .stat-label { color: var(--text-secondary); font-size: 14px; margin-bottom: 15px; }
        .stat-change { display: flex; align-items: center; gap: 5px; font-size: 13px; }
        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }
        
        /* Admin Cards */
        .admin-card { background: white; border-radius: var(--radius-lg); overflow: hidden; margin-bottom: 25px; }
        
        /* Banners Grid */
        .banners-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .banner-card { background: var(--bg-main); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); }
        .banner-preview { height: 180px; background: var(--secondary); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .banner-preview img { width: 100%; height: 100%; object-fit: cover; }
        .banner-preview i { font-size: 48px; color: rgba(255,255,255,0.3); }
        .banner-order { position: absolute; top: 10px; left: 10px; background: var(--primary); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .banner-status { position: absolute; top: 10px; right: 10px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .banner-status.active { background: #D1FAE5; color: #065F46; }
        .banner-status.inactive { background: #FEE2E2; color: #991B1B; }
        .banner-info { padding: 15px; }
        .banner-title { font-weight: 600; margin-bottom: 5px; font-size: 15px; }
        .banner-subtitle { font-size: 13px; color: var(--text-secondary); margin-bottom: 10px; }
        .banner-actions { display: flex; gap: 8px; }
        .banner-actions .btn { flex: 1; padding: 8px; font-size: 13px; }
        .card-header { padding: 20px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .card-title { font-family: 'Space Grotesk', sans-serif; font-size: 18px; font-weight: 700; }
        .card-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .card-body { padding: 25px; }
        
        /* Tables */
        .table-responsive { overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .data-table th, .data-table td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border); }
        .data-table th { background: var(--bg-main); font-weight: 600; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary); }
        .data-table tr:hover { background: var(--bg-main); }
        .table-product { display: flex; align-items: center; gap: 15px; }
        .table-product-img { width: 50px; height: 50px; background: var(--bg-main); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; overflow: hidden; }
        .table-product-img i { font-size: 20px; color: var(--text-light); }
        .status-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-active { background: rgba(0,200,83,0.1); color: var(--success); }
        .status-pending { background: rgba(255,184,0,0.1); color: var(--warning); }
        .status-inactive { background: rgba(255,71,87,0.1); color: var(--danger); }
        .status-warning { background: rgba(255,152,0,0.1); color: #F57C00; }
        .status-info { background: rgba(33,150,243,0.1); color: #1976D2; }
        
        /* Order Detail Styles */
        .order-detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .order-detail-section { background: var(--bg-main); padding: 15px; border-radius: var(--radius); }
        .order-detail-section h4 { font-size: 14px; color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .order-detail-section p { font-size: 14px; margin-bottom: 5px; color: var(--text-secondary); }
        .order-items { max-height: 200px; overflow-y: auto; }
        .order-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border); }
        .order-item:last-child { border-bottom: none; }
        .order-item-name { font-weight: 500; }
        .order-item-qty { color: var(--text-light); font-size: 13px; }
        .order-item-price { font-weight: 600; color: var(--primary); }
        .order-total { display: flex; justify-content: space-between; padding: 15px; background: var(--primary); color: white; border-radius: var(--radius); margin-top: 15px; font-size: 18px; }
        .btn-success { background: #25D366; color: white; border: none; }
        .btn-success:hover { background: #128C7E; }
        @media (max-width: 600px) { .order-detail-grid { grid-template-columns: 1fr; } }
        
        .action-btn { width: 36px; height: 36px; border: none; background: var(--bg-main); border-radius: 8px; cursor: pointer; transition: 0.3s; margin-right: 5px; }
        .action-btn:hover { background: var(--primary); color: white; }
        .action-btn.danger:hover { background: var(--danger); }
        
        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group.full { grid-column: 1 / -1; }
        .form-label { display: block; font-weight: 600; font-size: 14px; margin-bottom: 8px; color: var(--text-primary); }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 16px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 14px; font-family: inherit; transition: 0.3s; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(255,107,53,0.1); }
        .form-textarea { min-height: 120px; resize: vertical; }
        .form-hint { font-size: 12px; color: var(--text-secondary); margin-top: 5px; }
        .btn-group { display: flex; gap: 10px; margin-top: 30px; flex-wrap: wrap; }
        .btn-lg { padding: 14px 32px; }
        
        /* Image Upload */
        .image-upload { border: 2px dashed var(--border); border-radius: var(--radius); padding: 40px; text-align: center; cursor: pointer; transition: 0.3s; }
        .image-upload:hover { border-color: var(--primary); background: rgba(255,107,53,0.02); }
        .image-upload i { font-size: 40px; color: var(--text-light); margin-bottom: 15px; }
        .image-upload p { color: var(--text-secondary); margin-bottom: 10px; }
        .image-upload span { color: var(--primary); font-weight: 600; }
        
        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 3000; opacity: 0; visibility: hidden; transition: 0.3s; padding: 20px; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; border-radius: var(--radius-lg); width: 100%; max-width: 700px; max-height: 90vh; overflow: hidden; transform: scale(0.9); transition: 0.3s; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-family: 'Space Grotesk', sans-serif; font-size: 20px; font-weight: 700; }
        .modal-close { width: 40px; height: 40px; background: var(--bg-main); border: none; border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .modal-close:hover { background: var(--danger); color: white; }
        .modal-body { padding: 25px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 20px 25px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; flex-wrap: wrap; }
        
        /* Alerts */
        .alert { padding: 15px 20px; border-radius: var(--radius); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .alert-success { background: rgba(0,200,83,0.1); color: var(--success); }
        .alert-warning { background: rgba(255,184,0,0.1); color: #B58B00; }
        .alert-danger { background: rgba(255,71,87,0.1); color: var(--danger); }
        .alert-info { background: rgba(59,130,246,0.1); color: #3B82F6; }
        
        /* Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 25px; border-bottom: 2px solid var(--border); flex-wrap: wrap; }
        .tab { padding: 12px 24px; background: transparent; border: none; cursor: pointer; font-weight: 600; color: var(--text-secondary); transition: 0.3s; position: relative; }
        .tab::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: var(--primary); transform: scaleX(0); transition: 0.3s; }
        .tab:hover { color: var(--primary); }
        .tab.active { color: var(--primary); }
        .tab.active::after { transform: scaleX(1); }
        
        /* Checkbox */
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .checkbox-item input { width: 18px; height: 18px; accent-color: var(--primary); }
        
        /* Toast */
        .toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 5000; }
        .toast { background: white; padding: 16px 20px; border-radius: var(--radius); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); margin-top: 10px; display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s ease; min-width: 300px; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .toast.success .toast-icon { background: rgba(0,200,83,0.1); color: var(--success); }
        .toast.error .toast-icon { background: rgba(255,71,87,0.1); color: var(--danger); }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; margin-bottom: 2px; }
        .toast-message { font-size: 13px; color: var(--text-secondary); }
        
        /* Sync Status */
        .sync-status { display: flex; align-items: center; gap: 10px; padding: 15px 20px; background: rgba(0,212,170,0.1); border-radius: var(--radius); margin-bottom: 20px; flex-wrap: wrap; }
        .sync-status.error { background: rgba(255,71,87,0.1); }
        .sync-status i { color: var(--accent); }
        .sync-status.error i { color: var(--danger); }
        .sync-text { flex: 1; min-width: 200px; }
        .sync-text strong { display: block; margin-bottom: 2px; }
        .sync-text span { font-size: 13px; color: var(--text-secondary); }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-state i { font-size: 80px; color: var(--text-light); margin-bottom: 20px; }
        .empty-state h3 { font-size: 20px; margin-bottom: 10px; }
        .empty-state p { color: var(--text-secondary); margin-bottom: 25px; }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .footer-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 992px) {
            .hero-content { grid-template-columns: 1fr; text-align: center; }
            .hero-buttons { justify-content: center; }
            .hero-stats { justify-content: center; }
            .hero-image { display: none; }
            .admin-sidebar { transform: translateX(-100%); position: fixed; z-index: 1001; }
            .admin-sidebar.mobile-open { transform: translateX(0); }
            .admin-main { margin-left: 0; }
            .mobile-menu-btn { display: flex !important; }
        }
        @media (max-width: 768px) {
            .header-main .container { justify-content: space-between; flex-wrap: wrap; gap: 10px; }
            .search-box { order: 3; width: 100%; max-width: none; margin-top: 10px; }
            .header-actions { gap: 8px; }
            .header-btn span { display: none; }
            .header-btn { padding: 10px; min-width: 44px; }
            .logo-text { font-size: 20px; }
            .logo-img { height: 40px; }
            .footer-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .nav-list { flex-wrap: wrap; justify-content: center; gap: 5px; }
            .nav-list a { padding: 8px 12px; font-size: 13px; }
            .products-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .product-card { padding: 10px; }
            .product-image { height: 150px; min-height: 150px; }
            .product-image img { width: 100% !important; height: 100% !important; object-fit: cover !important; display: block !important; }
            .product-name { font-size: 14px; }
            .product-footer { flex-wrap: wrap; gap: 8px; }
            .product-footer .add-cart-btn { flex: 1 1 100%; }
            .product-footer .whatsapp-product-btn, .product-footer .share-product-btn { flex: 1; }
            .add-cart-btn, .buy-now-btn { width: 100%; justify-content: center; }
            .categories-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .category-card { padding: 15px 10px; }
            .category-icon { width: 50px; height: 50px; font-size: 20px; }
            .category-name { font-size: 13px; }
            .hero-section { padding: 40px 0; }
            .hero-section h1 { font-size: 28px; }
            .hero-section p { font-size: 15px; }
            .section-header h2 { font-size: 24px; }
            .cart-sidebar { width: 100%; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .stat-card { padding: 15px; }
            .stat-value { font-size: 24px; }
            .admin-header { padding: 15px; }
            .admin-page-title { font-size: 18px; }
            .data-table { font-size: 13px; }
            .data-table th, .data-table td { padding: 10px 8px; }
            .table-product-img { width: 40px; height: 40px; }
            .modal { margin: 10px; max-height: 90vh; }
            .modal-body { padding: 15px; }
            .features-grid { grid-template-columns: 1fr 1fr; gap: 15px; }
            .feature-card { padding: 20px 15px; }
        }
        @media (max-width: 480px) {
            .container { padding: 0 12px; }
            .products-grid { grid-template-columns: 1fr; }
            .categories-grid { grid-template-columns: repeat(2, 1fr); }
            .promo-title { font-size: 22px; }
            .promo-price-new { font-size: 32px; }
            .promo-btn { padding: 12px 20px; font-size: 14px; }
            .hero-section h1 { font-size: 24px; }
            .hero-buttons { flex-direction: column; width: 100%; }
            .hero-buttons .btn { width: 100%; justify-content: center; }
            .stats-grid { grid-template-columns: 1fr; }
            .features-grid { grid-template-columns: 1fr; }
            .login-box { padding: 25px 20px; margin: 15px; }
            .admin-card-header, .admin-card-body { padding: 15px; }
            .btn-group { flex-direction: column; }
            .btn-group .btn { width: 100%; }
        }
        /* Mobile menu button */
        .mobile-menu-btn { display: none; width: 44px; height: 44px; background: var(--primary); border: none; border-radius: var(--radius); color: white; font-size: 20px; cursor: pointer; align-items: center; justify-content: center; }
        .mobile-menu-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; }
        .mobile-menu-overlay.active { display: block; }
        @media (max-width: 992px) {
            .hide-mobile { display: none; }
        }
        /* Image Upload Styles */
        .image-upload-container { display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap; }
        .image-preview { width: 150px; height: 150px; background: var(--bg-main); border: 2px dashed var(--border); border-radius: var(--radius); display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .image-preview i { font-size: 40px; color: var(--text-light); margin-bottom: 8px; }
        .image-preview span { font-size: 12px; color: var(--text-light); }
        .image-preview img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Product Images Gallery */
        .product-images-gallery { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; min-height: 100px; padding: 15px; background: var(--bg-main); border-radius: var(--radius); border: 2px dashed var(--border); }
        .product-images-gallery:empty::after { content: 'Sin imágenes - Agregá hasta 5 imágenes'; display: flex; width: 100%; justify-content: center; align-items: center; color: var(--text-light); font-size: 14px; }
        .gallery-image-item { position: relative; width: 100px; height: 100px; border-radius: var(--radius); overflow: hidden; border: 2px solid var(--border); }
        .gallery-image-item img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-image-item.main { border-color: var(--primary); }
        .gallery-image-item .main-badge { position: absolute; top: 0; left: 0; background: var(--primary); color: white; font-size: 9px; padding: 2px 6px; }
        .gallery-image-item .remove-img { position: absolute; top: 5px; right: 5px; width: 22px; height: 22px; background: var(--danger); color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; opacity: 0; transition: 0.2s; }
        .gallery-image-item:hover .remove-img { opacity: 1; }
        .gallery-image-item .set-main { position: absolute; bottom: 5px; left: 5px; width: 22px; height: 22px; background: var(--secondary); color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; opacity: 0; transition: 0.2s; }
        .gallery-image-item:hover .set-main { opacity: 1; }
        .gallery-image-item.main .set-main { display: none; }
        .image-upload-actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .image-preview.has-image { border-style: solid; border-color: var(--primary); }
        .image-upload-options { flex: 1; display: flex; flex-direction: column; gap: 10px; min-width: 200px; }
        .image-upload-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--secondary); color: white; border-radius: var(--radius); cursor: pointer; font-weight: 500; transition: 0.3s; }
        .image-upload-btn:hover { background: var(--primary); }
        .image-url-input { display: flex; gap: 10px; }
        .image-url-input input { flex: 1; }
        .btn-remove-image { padding: 8px 16px; background: var(--danger); color: white; border: none; border-radius: var(--radius); cursor: pointer; font-size: 13px; display: inline-flex; align-items: center; gap: 6px; }
        .btn-remove-image:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader-overlay" id="loader">
        <div style="text-align: center;">
            <div class="loader-icon"><i class="fas fa-tools"></i></div>
            <p class="loader-text">Cargando Ferretería Bruzzone...</p>
        </div>
    </div>

    <!-- ==================== TIENDA ONLINE ==================== -->
    <div class="store-view" id="storeView" style="display: none;">
        <!-- Header -->
        <header class="store-header">
            <div class="header-top">
                <div class="container">
                    <div><a href="tel:" id="headerPhone"><i class="fas fa-phone"></i> <span id="headerPhoneText">(358) 412-3456</span></a> &nbsp;|&nbsp; <a href="/cdn-cgi/l/email-protection#9d" id="headerEmail"><i class="fas fa-envelope"></i> <span id="headerEmailText"><span class="__cf_email__" data-cfemail="bfc9dad1cbdeccffd9dacdcddadcd3d0cadb91dcd0d2">[email&#160;protected]</span></span></a></div>
                    <div><i class="fas fa-truck"></i> Envío gratis en compras +$<span id="headerFreeShipping">50.000</span></div>
                </div>
            </div>
            <div class="header-main">
                <div class="container">
                    <a href="#" class="logo" onclick="showStore()">
                        <img src="logo.jpg" alt="Ferretería Bruzzone" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <span class="logo-text" style="display:none;">Ferretería <span>Bruzzone</span></span>
                    </a>
                    <div class="search-box">
                        <input type="text" placeholder="Buscar productos..." id="searchInput" onkeyup="searchProducts()">
                        <button><i class="fas fa-search"></i></button>
                    </div>
                    <div class="header-actions">
                        <button class="header-btn" onclick="showAuthModal()"><i class="fas fa-user"></i> <span>Mi Cuenta</span></button>
                        <button class="header-btn cart-btn" onclick="toggleCart()"><i class="fas fa-shopping-cart"></i> <span>Carrito</span> <span class="cart-count" id="cartCount">0</span></button>
                    </div>
                </div>
            </div>
            <nav class="main-nav">
                <div class="container">
                    <ul class="nav-list">
                        <li><a href="#" class="active" onclick="showStore()">Inicio</a></li>
                        <li><a href="#" onclick="scrollToProducts()">Productos</a></li>
                        <li><a href="#" onclick="filterByCategory('ofertas')">Ofertas</a></li>
                        <li><a href="#" onclick="filterByCategory('nuevos')">Nuevos</a></li>
                        <li><a href="#contacto">Contacto</a></li>
                        <li><a href="#" class="admin-link" onclick="requireAdminLogin()"><i class="fas fa-cog"></i> Administrar</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Promo Slider -->
        <section class="promo-slider" id="promoSlider">
            <div class="promo-slides" id="promoSlides">
                <!-- Slide 1 -->
                <div class="promo-slide">
                    <div class="promo-content">
                        <div class="promo-text">
                            <span class="promo-badge"><i class="fas fa-fire"></i> Oferta Especial</span>
                            <h2 class="promo-title">Taladro Percutor <span>Bosch 750W</span></h2>
                            <p class="promo-desc">El taladro más vendido del año. Ideal para trabajos profesionales y del hogar.</p>
                            <div class="promo-price">
                                <span class="promo-price-old">$109.900</span>
                                <span class="promo-price-new">$89.900</span>
                            </div>
                            <button class="promo-btn" onclick="addToCart(2)"><i class="fas fa-cart-plus"></i> Agregar al Carrito</button>
                        </div>
                        <div class="promo-image"><i class="fas fa-tools"></i></div>
                    </div>
                </div>
                <!-- Slide 2 -->
                <div class="promo-slide">
                    <div class="promo-content">
                        <div class="promo-text">
                            <span class="promo-badge"><i class="fas fa-percent"></i> 20% OFF</span>
                            <h2 class="promo-title">Pinturas <span>Alba Premium</span></h2>
                            <p class="promo-desc">Pintura látex interior de alta calidad. Rendimiento superior y colores vibrantes.</p>
                            <div class="promo-price">
                                <span class="promo-price-old">$45.000</span>
                                <span class="promo-price-new">$39.900</span>
                            </div>
                            <button class="promo-btn" onclick="addToCart(7)"><i class="fas fa-cart-plus"></i> Comprar Ahora</button>
                        </div>
                        <div class="promo-image"><i class="fas fa-paint-roller"></i></div>
                    </div>
                </div>
                <!-- Slide 3 -->
                <div class="promo-slide">
                    <div class="promo-content">
                        <div class="promo-text">
                            <span class="promo-badge"><i class="fas fa-truck"></i> Envío Gratis</span>
                            <h2 class="promo-title">En compras mayores a <span>$50.000</span></h2>
                            <p class="promo-desc">Aprovechá el envío gratis a todo el país. Sin mínimo de productos, solo superá los $50.000.</p>
                            <button class="promo-btn" onclick="scrollToProducts()"><i class="fas fa-shopping-bag"></i> Ver Productos</button>
                        </div>
                        <div class="promo-image"><i class="fas fa-box-open"></i></div>
                    </div>
                </div>
            </div>
            <div class="promo-arrows">
                <button class="promo-arrow" onclick="prevSlide()"><i class="fas fa-chevron-left"></i></button>
                <button class="promo-arrow" onclick="nextSlide()"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="promo-nav" id="promoNav">
                <button class="promo-dot active" onclick="goToSlide(0)"></button>
                <button class="promo-dot" onclick="goToSlide(1)"></button>
                <button class="promo-dot" onclick="goToSlide(2)"></button>
            </div>
        </section>

        <!-- Hero -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-text">
                        <h1>Todo para tu <span>hogar</span> y <span>obra</span></h1>
                        <p>Encontrá las mejores herramientas, materiales y productos de ferretería con envío a todo el país. Más de 5.000 productos disponibles.</p>
                        <div class="hero-buttons">
                            <button class="btn btn-primary" onclick="scrollToProducts()"><i class="fas fa-shopping-bag"></i> Ver Productos</button>
                            <button class="btn btn-secondary" onclick="filterByCategory('ofertas')"><i class="fas fa-tags"></i> Ver Ofertas</button>
                        </div>
                        <div class="hero-stats">
                            <div class="stat-item"><div class="stat-number" id="heroProductCount">0</div><div class="stat-label">Productos</div></div>
                            <div class="stat-item"><div class="stat-number">500+</div><div class="stat-label">Clientes</div></div>
                            <div class="stat-item"><div class="stat-number">10+</div><div class="stat-label">Años</div></div>
                        </div>
                    </div>
                    <div class="hero-image">
                        <div class="hero-card">
                            <div class="hero-card-grid" id="heroCategories">
                                <div class="hero-product"><i class="fas fa-hammer"></i><span>Herramientas</span></div>
                                <div class="hero-product"><i class="fas fa-lightbulb"></i><span>Electricidad</span></div>
                                <div class="hero-product"><i class="fas fa-faucet"></i><span>Plomería</span></div>
                                <div class="hero-product"><i class="fas fa-paint-roller"></i><span>Pinturas</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section class="section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Categorías</h2>
                    <a href="#" class="section-link" onclick="loadAllProducts()">Ver todas <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="categories-grid" id="categoriesGrid"></div>
            </div>
        </section>

        <!-- Products -->
        <section class="section" id="productosSection" style="background: var(--bg-main);">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title" id="productsSectionTitle">Productos Destacados</h2>
                    <a href="#" class="section-link" onclick="loadAllProducts()">Ver todos <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="products-grid" id="productsGrid"></div>
                <div id="noProductsMessage" class="empty-state" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>No se encontraron productos</h3>
                    <p>Intenta con otros términos de búsqueda</p>
                    <button class="btn btn-primary" onclick="loadAllProducts()">Ver todos los productos</button>
                </div>
            </div>
        </section>

        <!-- Features -->
        <section class="features-section">
            <div class="container">
                <div class="features-grid">
                    <div class="feature-item"><div class="feature-icon"><i class="fas fa-truck"></i></div><div class="feature-text"><h4>Envío Gratis</h4><p>En compras +$50.000</p></div></div>
                    <div class="feature-item"><div class="feature-icon"><i class="fas fa-shield-alt"></i></div><div class="feature-text"><h4>Pago Seguro</h4><p>100% protegido</p></div></div>
                    <div class="feature-item"><div class="feature-icon"><i class="fas fa-undo"></i></div><div class="feature-text"><h4>Devoluciones</h4><p>30 días de garantía</p></div></div>
                    <div class="feature-item"><div class="feature-icon"><i class="fas fa-headset"></i></div><div class="feature-text"><h4>Soporte 24/7</h4><p>Atención personalizada</p></div></div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="store-footer" id="contacto">
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-about">
                        <a href="#" class="logo"><img src="logo.jpg" alt="Ferretería Bruzzone" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><span class="logo-text" style="display:none;">Ferretería <span>Bruzzone</span></span></a>
                        <p>Tu ferretería de confianza con más de 10 años de experiencia. Todo lo que necesitas para tu hogar y obra en un solo lugar.</p>
                        <div class="social-links">
                            <a href="#" class="social-link" id="socialFacebook" target="_blank"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="social-link" id="socialInstagram" target="_blank"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="social-link" id="socialWhatsapp" target="_blank"><i class="fab fa-whatsapp"></i></a>
                        </div>
                    </div>
                    <div><h4 class="footer-title">Enlaces</h4><ul class="footer-links"><li><a href="#">Inicio</a></li><li><a href="#">Productos</a></li><li><a href="#">Ofertas</a></li><li><a href="#">Contacto</a></li></ul></div>
                    <div><h4 class="footer-title">Categorías</h4><ul class="footer-links" id="footerCategories"></ul></div>
                    <div><h4 class="footer-title">Contacto</h4><ul class="footer-links" id="footerContact"><li><i class="fas fa-map-marker-alt"></i> <span id="footerAddress">Dr. Carlos Rocha 128</span></li><li><i class="fas fa-phone"></i> <span id="footerPhone">(358) 412-3456</span></li><li><i class="fas fa-envelope"></i> <span id="footerEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c7b1a2a9b3a6b487a1a2b5b5a2a4aba8b2a3e9a4a8aa">[email&#160;protected]</a></span></li></ul></div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 <span id="footerCompanyName">FerreCloud</span>. Todos los derechos reservados.</p>
                    <div class="payment-methods"><i class="fab fa-cc-visa"></i><i class="fab fa-cc-mastercard"></i><i class="fab fa-cc-amex"></i><i class="fas fa-money-bill-wave"></i></div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header"><h3><i class="fas fa-shopping-cart"></i> Mi Carrito</h3><button class="close-cart" onclick="toggleCart()"><i class="fas fa-times"></i></button></div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-summary">
                <div class="cart-summary-row"><span>Subtotal</span><span id="cartSubtotal">$0</span></div>
                <div class="cart-summary-row"><span>Envío</span><span id="cartShipping">A calcular</span></div>
                <div class="cart-summary-row total"><span>Total</span><span class="amount" id="cartTotal">$0</span></div>
            </div>
            <button class="checkout-btn" onclick="proceedToCheckout()"><i class="fas fa-lock"></i> Finalizar Compra</button>
        </div>
    </div>

    <!-- ==================== PANEL ADMIN ==================== -->
    <div class="admin-container" id="adminView">
        <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
        <aside class="admin-sidebar">
            <div class="admin-logo"><a href="#" class="logo" onclick="showStore()"><img src="logo.jpg" alt="Ferretería Bruzzone" class="logo-img-admin" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><span class="logo-text" style="display:none;">Ferretería <span>Bruzzone</span></span></a><span class="admin-badge">ADMIN</span></div>
            <nav class="admin-menu">
                <div class="menu-section">
                    <div class="menu-title">Principal</div>
                    <a class="menu-item active" onclick="showAdminSection('dashboard', this)"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>
                    <a class="menu-item" onclick="showAdminSection('orders', this)"><i class="fas fa-shopping-bag"></i><span>Pedidos</span><span class="badge" id="pendingOrdersBadge">0</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-title">Catálogo</div>
                    <a class="menu-item" onclick="showAdminSection('products', this)"><i class="fas fa-box"></i><span>Productos</span></a>
                    <a class="menu-item" onclick="showAdminSection('categories', this)"><i class="fas fa-tags"></i><span>Categorías</span></a>
                    <a class="menu-item" onclick="showAdminSection('banners', this)"><i class="fas fa-images"></i><span>Banners</span></a>
                    <a class="menu-item" onclick="showAdminSection('inventory', this)"><i class="fas fa-warehouse"></i><span>Inventario</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-title">Clientes</div>
                    <a class="menu-item" onclick="showAdminSection('customers', this)"><i class="fas fa-users"></i><span>Clientes</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-title">Marketing</div>
                    <a class="menu-item" onclick="showAdminSection('coupons', this)"><i class="fas fa-percent"></i><span>Cupones</span></a>
                </div>
                <div class="menu-section">
                    <div class="menu-title">Configuración</div>
                    <a class="menu-item" onclick="showAdminSection('company', this)"><i class="fas fa-building"></i><span>Datos Empresa</span></a>
                    <a class="menu-item" onclick="showAdminSection('shipping', this)"><i class="fas fa-truck"></i><span>Envíos</span></a>
                    <a class="menu-item" onclick="showAdminSection('payments', this)"><i class="fas fa-credit-card"></i><span>Pagos</span></a>
                    <a class="menu-item" onclick="showAdminSection('notifications', this)"><i class="fas fa-bell"></i><span>Notificaciones</span></a>
                    <a class="menu-item" onclick="showAdminSection('wyndes', this)"><i class="fas fa-sync-alt"></i><span>Sync Wyndes</span></a>
                    <a class="menu-item" onclick="showAdminSection('firebase', this)"><i class="fas fa-cloud"></i><span>Firebase</span></a>
                    <a class="menu-item" onclick="showAdminSection('security', this)"><i class="fas fa-lock"></i><span>Seguridad</span></a>
                </div>
            </nav>
        </aside>
        <main class="admin-main">
            <header class="admin-header">
                <div class="admin-header-left">
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
                    <a href="#" class="back-to-store" onclick="showStore()"><i class="fas fa-arrow-left"></i> <span class="hide-mobile">Volver a la tienda</span></a>
                    <h1 class="admin-page-title" id="adminPageTitle">Dashboard</h1>
                </div>
                <div class="admin-header-right">
                    <div class="admin-user"><div class="admin-avatar">MB</div><div class="admin-user-info"><div class="admin-user-name">Mauricio</div><div class="admin-user-role">Administrador</div></div></div>
                    <button class="btn btn-outline" onclick="adminLogout()" style="padding:10px 16px;font-size:13px;"><i class="fas fa-sign-out-alt"></i> Salir</button>
                </div>
            </header>
            <div class="admin-content">
                <!-- Dashboard -->
                <section class="admin-section active" id="section-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-icon blue"><i class="fas fa-shopping-cart"></i></div><div class="stat-value" id="statOrders">0</div><div class="stat-label">Pedidos del Mes</div><div class="stat-change positive"><i class="fas fa-arrow-up"></i> 12% vs mes anterior</div></div>
                        <div class="stat-card"><div class="stat-icon green"><i class="fas fa-dollar-sign"></i></div><div class="stat-value" id="statRevenue">$0</div><div class="stat-label">Ingresos del Mes</div><div class="stat-change positive"><i class="fas fa-arrow-up"></i> 8% vs mes anterior</div></div>
                        <div class="stat-card"><div class="stat-icon orange"><i class="fas fa-box"></i></div><div class="stat-value" id="statProducts">0</div><div class="stat-label">Productos Activos</div><div class="stat-change positive"><i class="fas fa-arrow-up"></i> 5 nuevos</div></div>
                        <div class="stat-card"><div class="stat-icon purple"><i class="fas fa-users"></i></div><div class="stat-value" id="statCustomers">0</div><div class="stat-label">Clientes</div><div class="stat-change positive"><i class="fas fa-arrow-up"></i> 15 nuevos</div></div>
                    </div>
                    <div class="admin-card"><div class="card-header"><h3 class="card-title">Pedidos Recientes</h3></div><div class="card-body"><div id="recentOrdersList" class="table-responsive"></div></div></div>
                </section>
                <!-- Products -->
                <section class="admin-section" id="section-products">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Gestión de Productos</h3><div class="card-actions"><div class="btn-group" style="display:inline-flex;gap:2px;margin-right:10px;"><button class="btn btn-success" onclick="exportImageList()" title="Descargar lista de imágenes para guardarlas"><i class="fas fa-download"></i> Exportar Imgs</button><button class="btn btn-success" onclick="autoLoadImagesByCode()" title="Asignar imágenes desde tu dominio usando el código"><i class="fas fa-images"></i> Por Código</button><button class="btn btn-outline" onclick="checkMissingImages()" title="Ver productos sin imagen"><i class="fas fa-search"></i> Sin Img</button></div><button class="btn btn-outline" onclick="exportProducts('csv')"><i class="fas fa-file-export"></i> Exportar</button><button class="btn btn-outline" onclick="showImportModal()"><i class="fas fa-file-import"></i> Importar</button><button class="btn btn-primary" onclick="showProductModal()"><i class="fas fa-plus"></i> Nuevo</button></div></div>
                        <div class="card-body"><div class="table-responsive"><table class="data-table"><thead><tr><th>Producto</th><th>Código</th><th>Categoría</th><th>Precio</th><th>Stock</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="productsTableBody"></tbody></table></div></div>
                    </div>
                </section>
                <!-- Categories -->
                <section class="admin-section" id="section-categories">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Gestión de Categorías</h3><button class="btn btn-primary" onclick="showCategoryModal()"><i class="fas fa-plus"></i> Nueva</button></div>
                        <div class="card-body"><div class="table-responsive"><table class="data-table"><thead><tr><th>Icono</th><th>Nombre</th><th>Productos</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="categoriesTableBody"></tbody></table></div></div>
                    </div>
                </section>
                <!-- Banners -->
                <section class="admin-section" id="section-banners">
                    <div class="admin-card">
                        <div class="card-header">
                            <h3 class="card-title">Banners del Carrusel</h3>
                            <button class="btn btn-primary" onclick="showBannerModal()"><i class="fas fa-plus"></i> Nuevo Banner</button>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info"><i class="fas fa-info-circle"></i><span>Tamaño recomendado: <strong>800 x 600 píxeles</strong>. Formatos: JPG, PNG. Peso máximo: 500KB</span></div>
                            <div class="banners-grid" id="bannersGrid"></div>
                        </div>
                    </div>
                </section>
                <!-- Orders -->
                <section class="admin-section" id="section-orders">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Gestión de Pedidos</h3></div>
                        <div class="card-body"><div class="table-responsive"><table class="data-table"><thead><tr><th>Pedido #</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="ordersTableBody"></tbody></table></div></div>
                    </div>
                </section>
                <!-- Customers -->
                <section class="admin-section" id="section-customers">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Gestión de Clientes</h3><button class="btn btn-primary" onclick="showCustomerModal()"><i class="fas fa-plus"></i> Nuevo</button></div>
                        <div class="card-body"><div class="table-responsive"><table class="data-table"><thead><tr><th>Cliente</th><th>Email</th><th>Teléfono</th><th>Pedidos</th><th>Total Compras</th><th>Acciones</th></tr></thead><tbody id="customersTableBody"></tbody></table></div></div>
                    </div>
                </section>
                <!-- Inventory -->
                <section class="admin-section" id="section-inventory">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Control de Inventario</h3></div>
                        <div class="card-body">
                            <div class="alert alert-warning"><i class="fas fa-exclamation-triangle"></i><span>Hay <strong id="lowStockCount">0</strong> productos con stock bajo.</span></div>
                            <div class="table-responsive"><table class="data-table"><thead><tr><th>Producto</th><th>Código</th><th>Stock Actual</th><th>Stock Mínimo</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="inventoryTableBody"></tbody></table></div>
                        </div>
                    </div>
                </section>
                <!-- Coupons -->
                <section class="admin-section" id="section-coupons">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Cupones de Descuento</h3><button class="btn btn-primary" onclick="showCouponModal()"><i class="fas fa-plus"></i> Nuevo</button></div>
                        <div class="card-body"><div class="table-responsive"><table class="data-table"><thead><tr><th>Código</th><th>Descuento</th><th>Tipo</th><th>Usos</th><th>Válido hasta</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="couponsTableBody"></tbody></table></div></div>
                    </div>
                </section>
                <!-- Company -->
                <section class="admin-section" id="section-company">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Datos de la Empresa</h3></div>
                        <div class="card-body">
                            <form id="companyForm" onsubmit="saveCompanyData(event)">
                                <div class="form-grid">
                                    <div class="form-group"><label class="form-label">Nombre de la Tienda</label><input type="text" class="form-input" id="companyName" value="FerreCloud"></div>
                                    <div class="form-group"><label class="form-label">CUIT</label><input type="text" class="form-input" id="companyCuit" placeholder="XX-XXXXXXXX-X"></div>
                                    <div class="form-group full"><label class="form-label">Dirección</label><input type="text" class="form-input" id="companyAddress" value="Dr. Carlos Rocha 128, Alejandro Roca, Córdoba"></div>
                                    <div class="form-group"><label class="form-label">Teléfono</label><input type="text" class="form-input" id="companyPhone" value="(358) 412-3456"></div>
                                    <div class="form-group"><label class="form-label">WhatsApp</label><input type="text" class="form-input" id="companyWhatsapp" placeholder="+54 9 358 123 4567"></div>
                                    <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="companyEmail" value="ventas@ferrecloud.com"></div>
                                    <div class="form-group"><label class="form-label">Instagram</label><input type="text" class="form-input" id="companyInstagram" placeholder="@ferreteria.bruzzone"></div>
                                    <div class="form-group"><label class="form-label">Facebook</label><input type="text" class="form-input" id="companyFacebook" placeholder="ferreteriabruzzone"></div>
                                    <div class="form-group full"><label class="form-label">Descripción</label><textarea class="form-textarea" id="companyDescription">Tu ferretería de confianza con más de 10 años de experiencia.</textarea></div>
                                    <div class="form-group"><label class="form-label">Horario</label><input type="text" class="form-input" id="companyHours" value="Lun-Sab: 8:00 - 20:00"></div>
                                    <div class="form-group"><label class="form-label">Monto Envío Gratis</label><input type="number" class="form-input" id="companyFreeShipping" value="50000"></div>
                                </div>
                                <div class="btn-group"><button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-save"></i> Guardar</button></div>
                            </form>
                        </div>
                    </div>
                </section>
                <!-- Shipping -->
                <section class="admin-section" id="section-shipping">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Configuración de Envíos</h3><button class="btn btn-primary" onclick="showShippingModal()"><i class="fas fa-plus"></i> Nueva Zona</button></div>
                        <div class="card-body"><div class="table-responsive"><table class="data-table"><thead><tr><th>Zona</th><th>Tiempo</th><th>Costo</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="shippingTableBody"></tbody></table></div></div>
                    </div>
                </section>
                <!-- Payments -->
                <section class="admin-section" id="section-payments">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Métodos de Pago</h3></div>
                        <div class="card-body">
                            <form id="paymentsForm" onsubmit="savePaymentSettings(event)">
                                <div class="form-group"><label class="form-label">Métodos Habilitados</label>
                                    <div class="checkbox-group">
                                        <label class="checkbox-item"><input type="checkbox" id="payMercadoPago" checked><span>Mercado Pago</span></label>
                                        <label class="checkbox-item"><input type="checkbox" id="payTransfer" checked><span>Transferencia</span></label>
                                        <label class="checkbox-item"><input type="checkbox" id="payCash" checked><span>Efectivo</span></label>
                                        <label class="checkbox-item"><input type="checkbox" id="payDebit" checked><span>Débito</span></label>
                                        <label class="checkbox-item"><input type="checkbox" id="payCredit" checked><span>Crédito</span></label>
                                    </div>
                                </div>
                                <div class="form-grid" style="margin-top: 30px;">
                                    <div class="form-group"><label class="form-label">Banco</label><input type="text" class="form-input" id="bankName" placeholder="Ej: Banco Nación"></div>
                                    <div class="form-group"><label class="form-label">Titular</label><input type="text" class="form-input" id="bankHolder" placeholder="Nombre del titular"></div>
                                    <div class="form-group"><label class="form-label">CBU</label><input type="text" class="form-input" id="bankCbu" placeholder="0000000000000000000000"></div>
                                    <div class="form-group"><label class="form-label">Alias</label><input type="text" class="form-input" id="bankAlias" placeholder="MI.ALIAS.CBU"></div>
                                </div>
                                <div class="btn-group"><button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-save"></i> Guardar</button></div>
                            </form>
                        </div>
                    </div>
                </section>
                <!-- Wyndes Sync -->
                <section class="admin-section" id="section-wyndes">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title">Sincronización con Wyndes</h3></div>
                        <div class="card-body">
                            <div class="sync-status" id="wyndesStatus"><i class="fas fa-check-circle"></i><div class="sync-text"><strong>Listo para conectar</strong><span>Última sincronización: <span id="lastSync">Nunca</span></span></div><button class="btn btn-primary" onclick="syncWithWyndes()"><i class="fas fa-sync-alt"></i> Sincronizar</button></div>
                            <form id="wyndesForm" onsubmit="saveWyndesConfig(event)">
                                <div class="form-grid">
                                    <div class="form-group"><label class="form-label">URL API Wyndes</label><input type="text" class="form-input" id="wyndesUrl" placeholder="https://api.wyndes.com"></div>
                                    <div class="form-group"><label class="form-label">API Key</label><input type="password" class="form-input" id="wyndesApiKey" placeholder="Tu API Key"></div>
                                    <div class="form-group full"><label class="form-label">Opciones</label>
                                        <div class="checkbox-group">
                                            <label class="checkbox-item"><input type="checkbox" id="syncProducts" checked><span>Productos</span></label>
                                            <label class="checkbox-item"><input type="checkbox" id="syncStock" checked><span>Stock</span></label>
                                            <label class="checkbox-item"><input type="checkbox" id="syncPrices" checked><span>Precios</span></label>
                                            <label class="checkbox-item"><input type="checkbox" id="syncOrders" checked><span>Pedidos</span></label>
                                        </div>
                                    </div>
                                    <div class="form-group"><label class="form-label">Frecuencia</label><select class="form-select" id="syncFrequency"><option value="manual">Manual</option><option value="hourly">Cada hora</option><option value="daily">Diaria</option><option value="realtime">Tiempo real</option></select></div>
                                    <div class="form-group"><label class="form-label">Margen de Precio (%)</label><input type="number" class="form-input" id="priceMargin" value="0"><span class="form-hint">Agregar sobre precio Wyndes</span></div>
                                </div>
                                <div class="btn-group"><button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-save"></i> Guardar</button><button type="button" class="btn btn-outline btn-lg" onclick="testWyndesConnection()"><i class="fas fa-plug"></i> Probar</button></div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Firebase Config -->
                <section class="admin-section" id="section-firebase">
                    <div class="admin-card">
                        <div class="admin-card-header">
                            <h3><i class="fas fa-cloud"></i> Configuración Firebase</h3>
                        </div>
                        <div class="admin-card-body">
                            <div class="alert" style="background:#EFF6FF;border-left:4px solid #3B82F6;padding:15px;border-radius:8px;margin-bottom:20px;">
                                <strong><i class="fas fa-info-circle"></i> ¿Qué es Firebase?</strong><br>
                                Firebase te permite guardar todos los datos en la nube. Así podés acceder desde cualquier dispositivo y no perdés nada si cambiás de computadora.
                            </div>
                            
                            <div class="firebase-current-status" style="background:var(--bg-main);padding:20px;border-radius:var(--radius);margin-bottom:25px;display:flex;align-items:center;gap:15px;">
                                <div id="fbStatusIcon" style="width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;background:#FEE2E2;color:#991B1B;">
                                    <i class="fas fa-times"></i>
                                </div>
                                <div>
                                    <strong id="fbStatusTitle">Modo Local</strong><br>
                                    <small id="fbStatusDesc" style="color:var(--text-secondary)">Los datos se guardan en este navegador únicamente</small>
                                </div>
                            </div>

                            <h4 style="margin-bottom:15px;"><i class="fas fa-cog"></i> Configuración</h4>
                            <p style="color:var(--text-secondary);margin-bottom:20px;">
                                Para usar Firebase, creá un proyecto en <a href="https://console.firebase.google.com" target="_blank" style="color:var(--primary);">Firebase Console</a> y copiá los datos de configuración.
                            </p>
                            
                            <form onsubmit="saveFirebaseConfig(event)">
                                <div class="form-grid">
                                    <div class="form-group"><label class="form-label">API Key *</label><input type="text" class="form-input" id="fbApiKey" placeholder="AIzaSy..."></div>
                                    <div class="form-group"><label class="form-label">Project ID *</label><input type="text" class="form-input" id="fbProjectId" placeholder="mi-proyecto"></div>
                                    <div class="form-group"><label class="form-label">Auth Domain</label><input type="text" class="form-input" id="fbAuthDomain" placeholder="mi-proyecto.firebaseapp.com"></div>
                                    <div class="form-group"><label class="form-label">Storage Bucket</label><input type="text" class="form-input" id="fbStorageBucket" placeholder="mi-proyecto.appspot.com"></div>
                                </div>
                                <div class="btn-group" style="margin-top:20px;">
                                    <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-save"></i> Guardar y Conectar</button>
                                    <button type="button" class="btn btn-outline btn-lg" onclick="testFirebaseConnection()"><i class="fas fa-plug"></i> Probar Conexión</button>
                                </div>
                            </form>

                            <hr style="margin:30px 0;border:none;border-top:1px solid var(--border);">

                            <h4 style="margin-bottom:15px;"><i class="fas fa-database"></i> Migrar Datos</h4>
                            <p style="color:var(--text-secondary);margin-bottom:15px;">
                                Si ya tenés datos guardados localmente, podés subirlos a Firebase con un clic.
                            </p>
                            <button class="btn btn-secondary" onclick="migrateToFirebase()"><i class="fas fa-cloud-upload-alt"></i> Subir Datos a Firebase</button>
                        </div>
                    </div>
                </section>
                <!-- Notifications -->
                <section class="admin-section" id="section-notifications">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title"><i class="fas fa-bell"></i> Configuración de Notificaciones por Email</h3></div>
                        <div class="card-body">
                            <div class="alert" style="background:#DBEAFE;border-left:4px solid #3B82F6;padding:15px;border-radius:8px;margin-bottom:20px;">
                                <strong><i class="fas fa-info-circle"></i> EmailJS - Servicio Gratuito</strong><br>
                                Recibí notificaciones por email cuando lleguen nuevos pedidos. Hasta 200 emails/mes gratis.<br>
                                <a href="https://www.emailjs.com/" target="_blank" style="color:#2563EB;">Crear cuenta en EmailJS →</a>
                            </div>
                            
                            <div id="emailNotifStatus" style="background:var(--bg-main);padding:15px;border-radius:var(--radius);margin-bottom:20px;display:flex;align-items:center;gap:10px;">
                                <i class="fas fa-circle" style="color:#EF4444;"></i>
                                <span>Notificaciones desactivadas</span>
                            </div>
                            
                            <h4 style="margin-bottom:15px;"><i class="fas fa-cog"></i> Configuración de EmailJS</h4>
                            <p style="color:var(--text-secondary);margin-bottom:15px;font-size:14px;">
                                1. Creá una cuenta en <a href="https://www.emailjs.com/" target="_blank">emailjs.com</a><br>
                                2. Agregá un servicio de email (Gmail, Outlook, etc.)<br>
                                3. Creá un template con las variables: {{order_id}}, {{customer_name}}, {{customer_email}}, {{customer_phone}}, {{products}}, {{total}}<br>
                                4. Copiá los IDs acá abajo
                            </p>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Public Key (User ID)</label>
                                    <input type="text" class="form-input" id="emailjsPublicKey" placeholder="Ej: user_xxxxxxxxxx">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Service ID</label>
                                    <input type="text" class="form-input" id="emailjsServiceId" placeholder="Ej: service_xxxxxxx">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Template ID (Nuevo Pedido)</label>
                                    <input type="text" class="form-input" id="emailjsTemplateId" placeholder="Ej: template_xxxxxxx">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email del Admin (donde recibir avisos)</label>
                                    <input type="email" class="form-input" id="emailjsAdminEmail" placeholder="tu@email.com">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" id="emailjsEnabled">
                                    <span>Activar notificaciones por email</span>
                                </label>
                            </div>
                            
                            <div style="display:flex;gap:10px;margin-top:20px;">
                                <button class="btn btn-primary" onclick="saveEmailConfig()"><i class="fas fa-save"></i> Guardar Configuración</button>
                                <button class="btn btn-outline" onclick="testEmailNotification()"><i class="fas fa-paper-plane"></i> Enviar Email de Prueba</button>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Security -->
                <section class="admin-section" id="section-security">
                    <div class="admin-card">
                        <div class="card-header"><h3 class="card-title"><i class="fas fa-lock"></i> Seguridad - Cambiar Credenciales</h3></div>
                        <div class="card-body">
                            <div class="alert" style="background:#FEF3C7;border-left:4px solid #F59E0B;padding:15px;border-radius:8px;margin-bottom:20px;">
                                <strong><i class="fas fa-exclamation-triangle"></i> Importante</strong><br>
                                Guardá bien tu usuario y contraseña. Si los olvidás, tendrás que editar el archivo index.html para recuperarlos.
                            </div>
                            
                            <div style="background:var(--bg-main);padding:20px;border-radius:var(--radius);margin-bottom:25px;">
                                <h4 style="margin-bottom:10px;"><i class="fas fa-user-shield"></i> Credenciales Actuales</h4>
                                <p><strong>Usuario:</strong> <span id="currentAdminUser">admin</span></p>
                                <p><strong>Contraseña:</strong> ••••••••</p>
                            </div>

                            <form id="securityForm" onsubmit="changeAdminCredentials(event)">
                                <h4 style="margin-bottom:15px;"><i class="fas fa-key"></i> Cambiar Credenciales</h4>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Contraseña Actual *</label>
                                        <input type="password" class="form-input" id="currentPassword" required placeholder="Ingresá tu contraseña actual">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nuevo Usuario</label>
                                        <input type="text" class="form-input" id="newUsername" placeholder="Dejar vacío para mantener">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Nueva Contraseña</label>
                                        <input type="password" class="form-input" id="newPassword" placeholder="Mínimo 6 caracteres">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Confirmar Nueva Contraseña</label>
                                        <input type="password" class="form-input" id="confirmPassword" placeholder="Repetir contraseña">
                                    </div>
                                </div>
                                <div class="btn-group" style="margin-top:20px;">
                                    <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-save"></i> Guardar Cambios</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modales -->
    <div class="modal-overlay" id="productModal">
        <div class="modal">
            <div class="modal-header"><h3 class="modal-title" id="productModalTitle">Nuevo Producto</h3><button class="modal-close" onclick="closeModal('productModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <form id="productForm"><input type="hidden" id="productId">
                    <div class="form-grid">
                        <div class="form-group full">
                            <label class="form-label">Imágenes del Producto (máx. 5)</label>
                            <div class="product-images-gallery" id="productImagesGallery">
                                <!-- Las imágenes se renderizan aquí -->
                            </div>
                            <div class="image-upload-actions">
                                <div class="image-upload-btn" onclick="document.getElementById('productImage').click()">
                                    <i class="fas fa-upload"></i> Subir imagen
                                    <input type="file" id="productImage" accept="image/*" style="display:none" onchange="handleProductImage(this)" multiple>
                                </div>
                                <div class="image-upload-btn" onclick="searchProductImage()" style="background:#10B981;color:white;">
                                    <i class="fas fa-magic"></i> Buscar Automática
                                </div>
                                <div class="image-url-input" style="flex:1;">
                                    <input type="text" class="form-input" id="productImageUrl" placeholder="Pegar URL y presionar Enter..." onkeypress="if(event.key==='Enter'){event.preventDefault();addImageByUrl();}">
                                </div>
                                <button type="button" class="btn btn-outline" onclick="addImageByUrl()"><i class="fas fa-plus"></i></button>
                            </div>
                            <span class="form-hint">Podés agregar hasta 5 imágenes. La primera será la principal.</span>
                        </div>
                        <div class="form-group"><label class="form-label">Nombre *</label><input type="text" class="form-input" id="productName" required></div>
                        <div class="form-group"><label class="form-label">Código *</label><input type="text" class="form-input" id="productCode" required></div>
                        <div class="form-group"><label class="form-label">Categoría *</label><select class="form-select" id="productCategory" required></select></div>
                        <div class="form-group"><label class="form-label">Marca</label><input type="text" class="form-input" id="productBrand"></div>
                        <div class="form-group"><label class="form-label">Precio *</label><input type="number" class="form-input" id="productPrice" step="0.01" required></div>
                        <div class="form-group"><label class="form-label">Precio Oferta</label><input type="number" class="form-input" id="productSalePrice" step="0.01"></div>
                        <div class="form-group"><label class="form-label">Stock *</label><input type="number" class="form-input" id="productStock" required></div>
                        <div class="form-group"><label class="form-label">Stock Mínimo</label><input type="number" class="form-input" id="productMinStock" value="5"></div>
                        <div class="form-group full"><label class="form-label">Descripción</label><textarea class="form-textarea" id="productDescription"></textarea></div>
                        <div class="form-group"><label class="checkbox-item"><input type="checkbox" id="productActive" checked><span>Activo</span></label></div>
                        <div class="form-group"><label class="checkbox-item"><input type="checkbox" id="productFeatured"><span>Destacado</span></label></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('productModal')">Cancelar</button><button class="btn btn-primary" onclick="saveProduct()"><i class="fas fa-save"></i> Guardar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="categoryModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header"><h3 class="modal-title" id="categoryModalTitle">Nueva Categoría</h3><button class="modal-close" onclick="closeModal('categoryModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <form id="categoryForm"><input type="hidden" id="categoryId">
                    <div class="form-group"><label class="form-label">Nombre *</label><input type="text" class="form-input" id="categoryName" required></div>
                    <div class="form-group"><label class="form-label">Icono (Font Awesome)</label><input type="text" class="form-input" id="categoryIcon" placeholder="fa-hammer"><span class="form-hint">Ej: fa-hammer, fa-lightbulb</span></div>
                    <div class="form-group"><label class="checkbox-item"><input type="checkbox" id="categoryActive" checked><span>Activa</span></label></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('categoryModal')">Cancelar</button><button class="btn btn-primary" onclick="saveCategory()"><i class="fas fa-save"></i> Guardar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="couponModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header"><h3 class="modal-title" id="couponModalTitle">Nuevo Cupón</h3><button class="modal-close" onclick="closeModal('couponModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <form id="couponForm"><input type="hidden" id="couponId">
                    <div class="form-group"><label class="form-label">Código *</label><input type="text" class="form-input" id="couponCode" required placeholder="DESCUENTO20" style="text-transform: uppercase;"></div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Tipo *</label><select class="form-select" id="couponType"><option value="percentage">Porcentaje (%)</option><option value="fixed">Monto Fijo ($)</option></select></div>
                        <div class="form-group"><label class="form-label">Valor *</label><input type="number" class="form-input" id="couponValue" required></div>
                        <div class="form-group"><label class="form-label">Compra Mínima</label><input type="number" class="form-input" id="couponMinPurchase" value="0"></div>
                        <div class="form-group"><label class="form-label">Límite Usos</label><input type="number" class="form-input" id="couponMaxUses" placeholder="Sin límite"></div>
                    </div>
                    <div class="form-group"><label class="form-label">Válido hasta</label><input type="date" class="form-input" id="couponExpiry"></div>
                    <div class="form-group"><label class="checkbox-item"><input type="checkbox" id="couponActive" checked><span>Activo</span></label></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('couponModal')">Cancelar</button><button class="btn btn-primary" onclick="saveCoupon()"><i class="fas fa-save"></i> Guardar</button></div>
        </div>
    </div>

    <!-- Shipping Zone Modal -->
    <div class="modal-overlay" id="shippingModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header"><h3 class="modal-title" id="shippingModalTitle">Nueva Zona de Envío</h3><button class="modal-close" onclick="closeModal('shippingModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <form id="shippingForm"><input type="hidden" id="shippingId">
                    <div class="form-group">
                        <label class="form-label">Nombre de la Zona *</label>
                        <input type="text" class="form-input" id="shippingName" required placeholder="Ej: Córdoba Capital, Interior, etc.">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Tiempo de Entrega *</label>
                            <input type="text" class="form-input" id="shippingTime" required placeholder="Ej: 24-48hs">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Costo de Envío *</label>
                            <input type="number" class="form-input" id="shippingCost" required min="0" value="0" placeholder="0 = Gratis">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripción / Localidades</label>
                        <textarea class="form-textarea" id="shippingDescription" rows="2" placeholder="Ej: Incluye barrios céntricos, zona norte, etc."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Compra Mínima para Envío Gratis</label>
                        <input type="number" class="form-input" id="shippingMinFree" min="0" value="0" placeholder="0 = No aplica">
                        <span class="form-hint">Si el cliente supera este monto, el envío es gratis en esta zona.</span>
                    </div>
                    <div class="form-group"><label class="checkbox-item"><input type="checkbox" id="shippingActive" checked><span>Zona Activa</span></label></div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('shippingModal')">Cancelar</button><button class="btn btn-primary" onclick="saveShipping()"><i class="fas fa-save"></i> Guardar</button></div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header"><h3 class="modal-title">Detalle del Pedido #<span id="orderModalId"></span></h3><button class="modal-close" onclick="closeModal('orderModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <div class="order-detail-grid">
                    <div class="order-detail-section">
                        <h4><i class="fas fa-user"></i> Cliente</h4>
                        <p><strong id="orderCustomerName"></strong></p>
                        <p id="orderCustomerPhone"></p>
                        <p id="orderCustomerEmail"></p>
                        <p id="orderCustomerAddress"></p>
                    </div>
                    <div class="order-detail-section">
                        <h4><i class="fas fa-info-circle"></i> Información</h4>
                        <p><strong>Fecha:</strong> <span id="orderDate"></span></p>
                        <p><strong>Estado:</strong> <span id="orderStatus"></span></p>
                        <p><strong>Método pago:</strong> <span id="orderPayment"></span></p>
                    </div>
                </div>
                <div class="order-detail-section" style="margin-top:20px;">
                    <h4><i class="fas fa-shopping-cart"></i> Productos</h4>
                    <div class="order-items" id="orderItems"></div>
                </div>
                <div class="order-total">
                    <span>Total del Pedido:</span>
                    <strong id="orderTotal"></strong>
                </div>
                <div class="form-group" style="margin-top:20px;">
                    <label class="form-label">Cambiar Estado</label>
                    <select class="form-select" id="orderStatusSelect" onchange="updateOrderStatus()">
                        <option value="pending">Pendiente</option>
                        <option value="processing">En Proceso</option>
                        <option value="shipped">Enviado</option>
                        <option value="completed">Entregado</option>
                        <option value="cancelled">Cancelado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Link de Pago (Mercado Pago, banco, etc.)</label>
                    <div style="display:flex;gap:10px;">
                        <input type="text" class="form-input" id="orderPaymentLink" placeholder="https://...">
                        <button class="btn btn-primary" onclick="sendPaymentLinkFromModal()"><i class="fab fa-whatsapp"></i> Enviar</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notas internas</label>
                    <textarea class="form-textarea" id="orderNotes" rows="2" placeholder="Notas sobre el pedido..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('orderModal')">Cerrar</button>
                <button class="btn btn-success" onclick="contactCustomerFromModal()"><i class="fab fa-whatsapp"></i> Contactar</button>
                <button class="btn btn-primary" onclick="saveOrderChanges()"><i class="fas fa-save"></i> Guardar</button>
            </div>
        </div>
    </div>

    <!-- Banner Modal -->
    <div class="modal-overlay" id="bannerModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header"><h3 class="modal-title" id="bannerModalTitle">Nuevo Banner</h3><button class="modal-close" onclick="closeModal('bannerModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <form id="bannerForm"><input type="hidden" id="bannerId">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Título *</label><input type="text" class="form-input" id="bannerTitle" required placeholder="Oferta Especial"></div>
                        <div class="form-group"><label class="form-label">Subtítulo</label><input type="text" class="form-input" id="bannerSubtitle" placeholder="¡No te lo pierdas!"></div>
                    </div>
                    <div class="form-group full"><label class="form-label">Descripción</label><input type="text" class="form-input" id="bannerDescription" placeholder="Descripción corta del banner"></div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Precio Anterior</label><input type="number" class="form-input" id="bannerOldPrice" placeholder="150000"></div>
                        <div class="form-group"><label class="form-label">Precio Actual</label><input type="number" class="form-input" id="bannerNewPrice" placeholder="99000"></div>
                    </div>
                    <div class="form-group"><label class="form-label">Texto del Botón</label><input type="text" class="form-input" id="bannerBtnText" placeholder="¡Lo Quiero!" value="¡Lo Quiero!"></div>
                    <div class="form-group"><label class="form-label">Enlace del Botón</label><select class="form-select" id="bannerBtnAction">
                        <option value="products">Ir a Productos</option>
                        <option value="whatsapp">Abrir WhatsApp</option>
                        <option value="category">Ir a Categoría</option>
                    </select></div>
                    <div class="form-group">
                        <label class="form-label">Imagen del Banner (800x600 px recomendado)</label>
                        <div class="image-upload-container">
                            <div class="image-preview" id="bannerImagePreview"><i class="fas fa-image"></i><span>Sin imagen</span></div>
                            <div class="image-upload-options">
                                <div class="form-group"><label class="form-label">Subir imagen</label><input type="file" class="form-input" id="bannerImageFile" accept="image/*" onchange="handleBannerImage(this)"></div>
                                <div class="form-group"><label class="form-label">O pegar URL</label><input type="text" class="form-input" id="bannerImageUrl" placeholder="https://..." onchange="handleBannerImageUrl(this.value)"></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Orden</label><input type="number" class="form-input" id="bannerOrder" value="1" min="1"></div>
                        <div class="form-group"><label class="checkbox-item" style="margin-top: 30px;"><input type="checkbox" id="bannerActive" checked><span>Activo</span></label></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('bannerModal')">Cancelar</button><button class="btn btn-primary" onclick="saveBanner()"><i class="fas fa-save"></i> Guardar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="importModal">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header"><h3 class="modal-title">Importar Productos</h3><button class="modal-close" onclick="closeModal('importModal')"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <div class="alert alert-info"><i class="fas fa-info-circle"></i><span>Soporta: CSV de Tienda Nube, Excel (.xlsx) o JSON</span></div>
                <div class="image-upload" onclick="document.getElementById('importFile').click()"><i class="fas fa-file-import"></i><p>Arrastra o <span>selecciona</span> archivo</p><input type="file" id="importFile" accept=".xlsx,.xls,.csv,.json" style="display:none;" onchange="handleImportFile(this)"></div>
                <div id="importPreview" style="margin-top: 20px; display: none;">
                    <p><strong>Archivo:</strong> <span id="importFileName"></span></p>
                    <p><strong>Productos encontrados:</strong> <span id="importCount">0</span></p>
                    <p><strong>Categorías:</strong> <span id="importCategories">0</span></p>
                </div>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('importModal')">Cancelar</button><button class="btn btn-primary" onclick="processImport()" id="importBtn" disabled><i class="fas fa-upload"></i> Importar</button></div>
        </div>
    </div>

    <div class="modal-overlay" id="authModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3 class="modal-title" id="authModalTitle">Iniciar Sesión</h3>
                <button class="modal-close" onclick="closeModal('authModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <!-- Login Form -->
                <div id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="tu@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="••••••••" onkeypress="if(event.key==='Enter')handleLogin()">
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="handleLogin()">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                    <div style="text-align: center; color: var(--text-secondary); font-size: 14px;">
                        ¿No tenés cuenta? <a href="#" onclick="showRegisterForm()" style="color: var(--primary); font-weight: 600;">Registrate</a>
                    </div>
                </div>
                
                <!-- Register Form -->
                <div id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Nombre Completo *</label>
                        <input type="text" class="form-input" id="registerName" placeholder="Juan Pérez">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="tu@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Teléfono *</label>
                        <input type="tel" class="form-input" id="registerPhone" placeholder="358 412-3456">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-input" id="registerAddress" placeholder="Calle 123, Ciudad">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contraseña * (mín. 6 caracteres)</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="••••••••">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirmar Contraseña *</label>
                        <input type="password" class="form-input" id="registerPasswordConfirm" placeholder="••••••••" onkeypress="if(event.key==='Enter')handleRegister()">
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="handleRegister()">
                        <i class="fas fa-user-plus"></i> Crear Cuenta
                    </button>
                    <div style="text-align: center; color: var(--text-secondary); font-size: 14px;">
                        ¿Ya tenés cuenta? <a href="#" onclick="showLoginForm()" style="color: var(--primary); font-weight: 600;">Iniciar Sesión</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Customer Account Modal -->
    <div class="modal-overlay" id="customerAccountModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-circle"></i> Mi Cuenta</h3>
                <button class="modal-close" onclick="closeModal('customerAccountModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="customer-account-header" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4 style="margin: 0; font-size: 18px;" id="customerAccountName">Cliente</h4>
                            <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;" id="customerAccountEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="147179757d7854717e717964787b3a777b79">[email&#160;protected]</a></p>
                        </div>
                    </div>
                </div>
                
                <div class="customer-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--border); padding-bottom: 10px;">
                    <button class="customer-tab active" onclick="showCustomerTab('profile')" id="tabProfile" style="padding: 10px 20px; border: none; background: var(--primary); color: white; border-radius: 8px; cursor: pointer;"><i class="fas fa-user"></i> Perfil</button>
                    <button class="customer-tab" onclick="showCustomerTab('orders')" id="tabOrders" style="padding: 10px 20px; border: none; background: var(--bg-main); color: var(--text-secondary); border-radius: 8px; cursor: pointer;"><i class="fas fa-shopping-bag"></i> Mis Pedidos</button>
                </div>
                
                <!-- Profile Tab -->
                <div id="customerProfileTab">
                    <form id="customerProfileForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nombre Completo</label>
                                <input type="text" class="form-input" id="customerName">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Teléfono</label>
                                <input type="tel" class="form-input" id="customerPhone">
                            </div>
                            <div class="form-group full">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="customerEmail" disabled style="background: var(--bg-main);">
                            </div>
                            <div class="form-group full">
                                <label class="form-label">Dirección de Envío</label>
                                <input type="text" class="form-input" id="customerAddress">
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button type="button" class="btn btn-primary" onclick="saveCustomerProfile()"><i class="fas fa-save"></i> Guardar Cambios</button>
                            <button type="button" class="btn btn-outline" onclick="customerLogout()" style="color: var(--danger); border-color: var(--danger);"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
                        </div>
                    </form>
                </div>
                
                <!-- Orders Tab -->
                <div id="customerOrdersTab" style="display: none;">
                    <div id="customerOrdersList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="login-modal" id="adminLoginModal">
        <div class="login-box">
            <div class="login-logo"><i class="fas fa-lock"></i></div>
            <h2 class="login-title">Panel de Administración</h2>
            <p class="login-subtitle">Ingresá tus credenciales para continuar</p>
            <div class="login-error" id="loginError">Usuario o contraseña incorrectos</div>
            <form class="login-form" onsubmit="handleAdminLogin(event)">
                <div class="form-group">
                    <label class="form-label">Usuario</label>
                    <input type="text" class="form-input" id="adminUser" placeholder="Ingresá tu usuario" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" class="form-input" id="adminPass" placeholder="Ingresá tu contraseña" required>
                </div>
                <button type="submit" class="login-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Ingresar
                </button>
            </form>
            <div class="login-back">
                <a href="#" onclick="closeAdminLogin()"><i class="fas fa-arrow-left"></i> Volver a la tienda</a>
            </div>
        </div>
    </div>

    <!-- Firebase Status -->
    <div class="firebase-status" id="firebaseStatus" style="display:none;">
        <i class="fas fa-database"></i>
        <span id="firebaseStatusText">Conectando...</span>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-shopping-cart"></i> Finalizar Compra</h3>
                <button class="modal-close" onclick="closeModal('checkoutModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div id="checkoutStep1">
                    <h4 style="margin-bottom: 15px; color: var(--text-secondary);"><i class="fas fa-user"></i> Datos de Contacto</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nombre Completo *</label>
                            <input type="text" class="form-input" id="checkoutName" placeholder="Juan Pérez">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Teléfono *</label>
                            <input type="tel" class="form-input" id="checkoutPhone" placeholder="358 412-3456">
                        </div>
                        <div class="form-group full">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" id="checkoutEmail" placeholder="tu@email.com">
                        </div>
                        <div class="form-group full">
                            <label class="form-label">Dirección de Envío *</label>
                            <input type="text" class="form-input" id="checkoutAddress" placeholder="Calle 123, Ciudad, CP">
                        </div>
                    </div>
                    
                    <h4 style="margin: 20px 0 15px; color: var(--text-secondary);"><i class="fas fa-truck"></i> Zona de Envío</h4>
                    <div class="form-group">
                        <select class="form-select" id="checkoutShipping" onchange="updateCheckoutTotal()">
                            <option value="">Seleccioná tu zona...</option>
                        </select>
                    </div>
                    
                    <h4 style="margin: 20px 0 15px; color: var(--text-secondary);"><i class="fas fa-credit-card"></i> Método de Pago</h4>
                    <div class="form-group">
                        <select class="form-select" id="checkoutPayment">
                            <option value="efectivo">Efectivo al recibir</option>
                            <option value="transferencia">Transferencia Bancaria</option>
                            <option value="mercadopago">Mercado Pago</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notas del Pedido (opcional)</label>
                        <textarea class="form-textarea" id="checkoutNotes" rows="2" placeholder="Indicaciones especiales, horarios de entrega, etc."></textarea>
                    </div>
                    
                    <div style="background: var(--bg-main); padding: 15px; border-radius: 10px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Subtotal:</span>
                            <span id="checkoutSubtotal">$0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Envío:</span>
                            <span id="checkoutShippingCost">Seleccioná zona</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: 700; color: var(--primary); border-top: 2px solid var(--border); padding-top: 10px; margin-top: 10px;">
                            <span>Total:</span>
                            <span id="checkoutTotal">$0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="flex-direction: column; gap: 10px;">
                <button class="btn btn-primary" style="width: 100%;" onclick="confirmOrder()">
                    <i class="fas fa-check"></i> Confirmar Pedido
                </button>
                <button class="btn btn-success" style="width: 100%;" onclick="sendOrderWhatsApp()">
                    <i class="fab fa-whatsapp"></i> Enviar por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- WhatsApp Button -->
    <a href="#" class="whatsapp-btn" id="whatsappBtn" onclick="openWhatsApp()" title="Chatea con nosotros">
        <i class="fab fa-whatsapp"></i>
        <span class="tooltip">¡Chatea con nosotros!</span>
    </a>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
// ==================== FIREBASE CONFIG ====================
// Configuración de Firebase - Proyecto FerreCloud
const firebaseConfig = {
    apiKey: "AIzaSyAH01gINHutJWKr1e3QB-qmgD0ZMR6GW1A",
    authDomain: "ecomence-5c085.firebaseapp.com",
    projectId: "ecomence-5c085",
    storageBucket: "ecomence-5c085.firebasestorage.app",
    messagingSenderId: "135449717732",
    appId: "1:135449717732:web:568e44023edcb2ff6135f1"
};

// Variables globales
let db = null;
let firebaseEnabled = false;
let isAdmin = false;

// Credenciales admin (se cargan desde localStorage/Firebase)
let ADMIN_CREDENTIALS = {
    user: 'admin',
    pass: 'ferrecloud2024'
};

// Cargar credenciales guardadas
function loadAdminCredentials() {
    const saved = localStorage.getItem('ferrecloud_admin_credentials');
    if(saved) {
        try {
            ADMIN_CREDENTIALS = JSON.parse(saved);
        } catch(e) {}
    }
}
loadAdminCredentials();

// ==================== DATA STORE ====================
let appData = {
    products: [],
    categories: [],
    orders: [],
    customers: [],
    coupons: [],
    shippingZones: [],
    company: { name: 'FerreCloud', address: 'Dr. Carlos Rocha 128, Alejandro Roca, Córdoba', phone: '(358) 412-3456', email: 'ventas@ferrecloud.com', freeShipping: 50000 },
    cart: [],
    currentUser: null,
    wyndesConfig: { url: '', apiKey: '', lastSync: null },
    banners: []
};

// ==================== PROMO SLIDER ====================
let currentSlide = 0;
let slideInterval = null;

function initSlider() {
    renderSlider();
    startSlideShow();
}

function startSlideShow() {
    if(slideInterval) clearInterval(slideInterval);
    slideInterval = setInterval(() => nextSlide(), 5000);
}

function nextSlide() {
    const slides = document.querySelectorAll('.promo-slide');
    currentSlide = (currentSlide + 1) % slides.length;
    updateSlider();
}

function prevSlide() {
    const slides = document.querySelectorAll('.promo-slide');
    currentSlide = (currentSlide - 1 + slides.length) % slides.length;
    updateSlider();
    startSlideShow();
}

function goToSlide(index) {
    currentSlide = index;
    updateSlider();
    startSlideShow();
}

function updateSlider() {
    const slidesContainer = document.getElementById('promoSlides');
    const dots = document.querySelectorAll('.promo-dot');
    slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
    dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
}

// ==================== ADMIN LOGIN ====================
function requireAdminLogin() {
    if(isAdmin) {
        showAdmin();
    } else {
        document.getElementById('adminLoginModal').classList.add('active');
        document.getElementById('adminUser').focus();
    }
}

function closeAdminLogin() {
    document.getElementById('adminLoginModal').classList.remove('active');
    document.getElementById('loginError').classList.remove('show');
    document.getElementById('adminUser').value = '';
    document.getElementById('adminPass').value = '';
}

function handleAdminLogin(e) {
    e.preventDefault();
    const user = document.getElementById('adminUser').value;
    const pass = document.getElementById('adminPass').value;
    const loginBtn = document.getElementById('loginBtn');
    
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
    
    setTimeout(() => {
        if(user === ADMIN_CREDENTIALS.user && pass === ADMIN_CREDENTIALS.pass) {
            isAdmin = true;
            closeAdminLogin();
            showAdmin();
            showToast('success', 'Bienvenido', 'Acceso concedido al panel de administración');
        } else {
            document.getElementById('loginError').classList.add('show');
            document.getElementById('adminPass').value = '';
        }
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Ingresar';
    }, 800);
}

function adminLogout() {
    isAdmin = false;
    showStore();
    showToast('success', 'Sesión cerrada', 'Cerraste sesión del panel admin');
}

// ==================== SECURITY ====================
function changeAdminCredentials(e) {
    e.preventDefault();
    
    const currentPass = document.getElementById('currentPassword').value;
    const newUser = document.getElementById('newUsername').value.trim();
    const newPass = document.getElementById('newPassword').value;
    const confirmPass = document.getElementById('confirmPassword').value;
    
    // Validar contraseña actual
    if(currentPass !== ADMIN_CREDENTIALS.pass) {
        showToast('error', 'Error', 'La contraseña actual es incorrecta');
        return;
    }
    
    // Validar que haya algo que cambiar
    if(!newUser && !newPass) {
        showToast('error', 'Error', 'Ingresá un nuevo usuario o contraseña');
        return;
    }
    
    // Validar nueva contraseña
    if(newPass) {
        if(newPass.length < 6) {
            showToast('error', 'Error', 'La contraseña debe tener al menos 6 caracteres');
            return;
        }
        if(newPass !== confirmPass) {
            showToast('error', 'Error', 'Las contraseñas no coinciden');
            return;
        }
    }
    
    // Actualizar credenciales
    if(newUser) ADMIN_CREDENTIALS.user = newUser;
    if(newPass) ADMIN_CREDENTIALS.pass = newPass;
    
    // Guardar en localStorage
    localStorage.setItem('ferrecloud_admin_credentials', JSON.stringify(ADMIN_CREDENTIALS));
    
    // Actualizar UI
    document.getElementById('currentAdminUser').textContent = ADMIN_CREDENTIALS.user;
    
    // Limpiar formulario
    document.getElementById('securityForm').reset();
    
    showToast('success', 'Guardado', 'Credenciales actualizadas correctamente');
}

function loadSecurityPanel() {
    const el = document.getElementById('currentAdminUser');
    if(el) el.textContent = ADMIN_CREDENTIALS.user;
}

// ==================== FIREBASE FUNCTIONS ====================
function initFirebase() {
    try {
        // Verificar si Firebase está configurado
        if(!firebaseConfig.apiKey || firebaseConfig.apiKey === "TU_API_KEY") {
            console.log('Firebase no configurado, usando localStorage');
            updateFirebaseStatus('offline', 'Modo local');
            return false;
        }
        
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        firebaseEnabled = true;
        updateFirebaseStatus('online', 'Conectado a Firebase');
        console.log('Firebase conectado correctamente');
        return true;
    } catch(e) {
        console.error('Error Firebase:', e);
        updateFirebaseStatus('offline', 'Error: ' + e.message);
        return false;
    }
}

function updateFirebaseStatus(status, text) {
    const el = document.getElementById('firebaseStatus');
    const textEl = document.getElementById('firebaseStatusText');
    el.className = 'firebase-status ' + status;
    textEl.textContent = text;
    el.style.display = 'flex';
    
    // Ocultar después de 3 segundos si está online
    if(status === 'online') {
        setTimeout(() => el.style.display = 'none', 3000);
    }
}

async function loadDataFromFirebase() {
    if(!firebaseEnabled) return false;
    
    try {
        updateFirebaseStatus('syncing', 'Sincronizando...');
        
        // Timeout de 5 segundos para evitar bloqueos
        const timeoutPromise = new Promise((_, reject) => 
            setTimeout(() => reject(new Error('Timeout')), 5000)
        );
        
        const collections = ['products', 'categories', 'orders', 'customers', 'coupons', 'shippingZones', 'banners'];
        
        for(const col of collections) {
            const snapshot = await db.collection(col).get();
            if(!snapshot.empty) {
                appData[col] = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            }
        }
        
        // Cargar configuración
        const configDoc = await db.collection('config').doc('company').get();
        if(configDoc.exists) appData.company = configDoc.data();
        
        const wyndesDoc = await db.collection('config').doc('wyndes').get();
        if(wyndesDoc.exists) appData.wyndesConfig = wyndesDoc.data();
        
        updateFirebaseStatus('online', 'Sincronizado');
        setTimeout(() => document.getElementById('firebaseStatus').style.display = 'none', 2000);
        return true;
    } catch(e) {
        console.error('Error cargando Firebase:', e);
        updateFirebaseStatus('offline', 'Error sync');
        return false;
    }
}

async function saveDataToFirebase() {
    if(!firebaseEnabled) {
        saveDataLocal();
        return;
    }
    
    try {
        const batch = db.batch();
        
        // Guardar productos
        for(const p of appData.products) {
            const ref = db.collection('products').doc(String(p.id));
            batch.set(ref, p);
        }
        
        // Guardar categorías
        for(const c of appData.categories) {
            const ref = db.collection('categories').doc(String(c.id));
            batch.set(ref, c);
        }
        
        // Guardar pedidos
        for(const o of appData.orders) {
            const ref = db.collection('orders').doc(String(o.id));
            batch.set(ref, o);
        }
        
        // Guardar clientes
        for(const c of appData.customers) {
            const ref = db.collection('customers').doc(String(c.id));
            batch.set(ref, c);
        }
        
        // Guardar cupones
        for(const c of appData.coupons) {
            const ref = db.collection('coupons').doc(String(c.id));
            batch.set(ref, c);
        }
        
        // Guardar zonas envío
        for(const z of appData.shippingZones) {
            const ref = db.collection('shippingZones').doc(String(z.id));
            batch.set(ref, z);
        }
        
        // Guardar banners
        for(const b of appData.banners) {
            const ref = db.collection('banners').doc(String(b.id));
            batch.set(ref, b);
        }
        
        // Guardar config
        batch.set(db.collection('config').doc('company'), appData.company);
        batch.set(db.collection('config').doc('wyndes'), appData.wyndesConfig);
        
        await batch.commit();
        
        // También guardar local como backup
        saveDataLocal();
        
    } catch(e) {
        console.error('Error guardando en Firebase:', e);
        showToast('warning', 'Guardado local', 'No se pudo sincronizar con la nube');
        saveDataLocal();
    }
}

function saveDataLocal() {
    try {
        localStorage.setItem('ferrecloud_data', JSON.stringify(appData));
    } catch(e) {
        if(e.name === 'QuotaExceededError') {
            showToast('error', 'Almacenamiento lleno', 'Eliminá algunas imágenes o usá Firebase');
        }
    }
}

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log('FerreCloud iniciando...');
    
    // 1. Ocultar loader inmediatamente
    var loader = document.getElementById('loader');
    var store = document.getElementById('storeView');
    if(loader) loader.style.display = 'none';
    if(store) store.style.display = 'block';
    
    console.log('Loader oculto, tienda visible');
    
    // 2. Cargar datos
    try {
        var saved = localStorage.getItem('ferrecloud_data');
        if(saved) {
            var parsed = JSON.parse(saved);
            for(var key in parsed) {
                if(parsed.hasOwnProperty(key)) {
                    appData[key] = parsed[key];
                }
            }
            console.log('Datos cargados de localStorage');
        } else {
            initSampleData();
            console.log('Datos de ejemplo cargados');
        }
    } catch(e) {
        console.error('Error cargando datos:', e);
        initSampleData();
    }
    
    // 3. Renderizar
    try {
        renderAll();
        console.log('Renderizado completo');
    } catch(e) {
        console.error('Error en renderAll:', e);
    }
    
    // 4. Slider (opcional)
    try {
        initSlider();
    } catch(e) {
        console.log('Slider error (no crítico):', e);
    }
    
    // 5. Firebase (en background, no crítico)
    setTimeout(function() {
        try {
            initFirebase();
        } catch(e) {
            console.log('Firebase no disponible');
        }
    }, 1000);
    
    console.log('FerreCloud listo!');
});

function saveData() {
    if(firebaseEnabled) {
        saveDataToFirebase();
    } else {
        saveDataLocal();
    }
}

function initSampleData() {
    appData.categories = [
        { id: 1, name: 'Herramientas Manuales', icon: 'fa-hammer', active: true, productCount: 0 },
        { id: 2, name: 'Electricidad', icon: 'fa-bolt', active: true, productCount: 0 },
        { id: 3, name: 'Plomería', icon: 'fa-faucet', active: true, productCount: 0 },
        { id: 4, name: 'Pinturas', icon: 'fa-paint-roller', active: true, productCount: 0 },
        { id: 5, name: 'Cerrajería', icon: 'fa-key', active: true, productCount: 0 },
        { id: 6, name: 'Tornillería', icon: 'fa-cogs', active: true, productCount: 0 },
        { id: 7, name: 'Jardinería', icon: 'fa-leaf', active: true, productCount: 0 },
        { id: 8, name: 'Iluminación', icon: 'fa-lightbulb', active: true, productCount: 0 }
    ];
    appData.products = [
        { id: 1, name: 'Martillo Carpintero Stanley 20oz', code: 'HM-001', category: 'Herramientas Manuales', brand: 'Stanley', price: 15500, salePrice: 12900, stock: 25, minStock: 5, description: 'Martillo profesional con mango de fibra de vidrio', active: true, featured: true, badge: 'sale', image: 'https://placehold.co/400x400/2563EB/ffffff?text=Martillo', images: ['https://placehold.co/400x400/2563EB/ffffff?text=Martillo'] },
        { id: 2, name: 'Taladro Percutor Bosch 750W', code: 'EL-001', category: 'Electricidad', brand: 'Bosch', price: 89900, salePrice: null, stock: 12, minStock: 3, active: true, featured: true, badge: 'hot', image: 'https://placehold.co/400x400/F59E0B/ffffff?text=Taladro', images: ['https://placehold.co/400x400/F59E0B/ffffff?text=Taladro'] },
        { id: 3, name: 'Llave Francesa Ajustable 12"', code: 'HM-002', category: 'Herramientas Manuales', brand: 'Bahco', price: 18500, salePrice: null, stock: 30, minStock: 5, active: true, featured: false, image: 'https://placehold.co/400x400/2563EB/ffffff?text=Llave', images: ['https://placehold.co/400x400/2563EB/ffffff?text=Llave'] },
        { id: 4, name: 'Set Destornilladores x10 pzas', code: 'HM-003', category: 'Herramientas Manuales', brand: 'Stanley', price: 8900, salePrice: 7500, stock: 45, minStock: 10, active: true, featured: true, badge: 'sale', image: 'https://placehold.co/400x400/2563EB/ffffff?text=Destornilladores', images: ['https://placehold.co/400x400/2563EB/ffffff?text=Destornilladores'] },
        { id: 5, name: 'Cable Unipolar 2.5mm x 100m', code: 'EL-002', category: 'Electricidad', brand: 'Trefilcon', price: 32000, salePrice: null, stock: 8, minStock: 5, active: true, featured: false, image: 'https://placehold.co/400x400/F59E0B/ffffff?text=Cable', images: ['https://placehold.co/400x400/F59E0B/ffffff?text=Cable'] },
        { id: 6, name: 'Canilla Esférica 1/2"', code: 'PL-001', category: 'Plomería', brand: 'FV', price: 4500, salePrice: null, stock: 60, minStock: 15, active: true, featured: false, image: 'https://placehold.co/400x400/3B82F6/ffffff?text=Canilla', images: ['https://placehold.co/400x400/3B82F6/ffffff?text=Canilla'] },
        { id: 7, name: 'Pintura Látex Interior 20L', code: 'PI-001', category: 'Pinturas', brand: 'Alba', price: 45000, salePrice: 39900, stock: 15, minStock: 5, active: true, featured: true, badge: 'sale', image: 'https://placehold.co/400x400/10B981/ffffff?text=Pintura', images: ['https://placehold.co/400x400/10B981/ffffff?text=Pintura'] },
        { id: 8, name: 'Cerradura de Seguridad 3 Puntos', code: 'CE-001', category: 'Cerrajería', brand: 'Prive', price: 78000, salePrice: null, stock: 6, minStock: 2, active: true, featured: true, badge: 'new', image: 'https://placehold.co/400x400/6366F1/ffffff?text=Cerradura', images: ['https://placehold.co/400x400/6366F1/ffffff?text=Cerradura'] },
        { id: 9, name: 'Tornillos Autoperforantes x500', code: 'TO-001', category: 'Tornillería', brand: 'Nacional', price: 5200, salePrice: null, stock: 100, minStock: 20, active: true, featured: false, image: 'https://placehold.co/400x400/6B7280/ffffff?text=Tornillos', images: ['https://placehold.co/400x400/6B7280/ffffff?text=Tornillos'] },
        { id: 10, name: 'Manguera de Jardín 15m', code: 'JA-001', category: 'Jardinería', brand: 'Tramontina', price: 12500, salePrice: 9900, stock: 20, minStock: 5, active: true, featured: true, badge: 'sale', image: 'https://placehold.co/400x400/059669/ffffff?text=Manguera', images: ['https://placehold.co/400x400/059669/ffffff?text=Manguera'] },
        { id: 11, name: 'Lámpara LED Panel 60x60', code: 'IL-001', category: 'Iluminación', brand: 'Philips', price: 18900, salePrice: null, stock: 25, minStock: 5, active: true, featured: false, image: 'https://placehold.co/400x400/FBBF24/ffffff?text=Lampara', images: ['https://placehold.co/400x400/FBBF24/ffffff?text=Lampara'] },
        { id: 12, name: 'Amoladora Angular 4.5" 850W', code: 'EL-003', category: 'Electricidad', brand: 'DeWalt', price: 125000, salePrice: null, stock: 8, minStock: 2, active: true, featured: true, badge: 'hot', image: 'https://placehold.co/400x400/F59E0B/ffffff?text=Amoladora', images: ['https://placehold.co/400x400/F59E0B/ffffff?text=Amoladora'] }
    ];
    appData.shippingZones = [
        { id: 1, name: 'Alejandro Roca', time: '1-2 días', cost: 0, description: 'Entrega local sin cargo', minFree: 0, active: true },
        { id: 2, name: 'Córdoba Capital', time: '2-3 días', cost: 2500, description: 'Ciudad de Córdoba y alrededores', minFree: 50000, active: true },
        { id: 3, name: 'Buenos Aires', time: '3-5 días', cost: 5000, description: 'CABA y GBA', minFree: 80000, active: true },
        { id: 4, name: 'Interior del País', time: '5-7 días', cost: 7500, description: 'Resto del país', minFree: 100000, active: true }
    ];
    appData.coupons = [
        { id: 1, code: 'BIENVENIDO10', type: 'percentage', value: 10, minPurchase: 10000, maxUses: 100, uses: 23, expiry: '2025-12-31', active: true },
        { id: 2, code: 'ENVIOGRATIS', type: 'fixed', value: 5000, minPurchase: 30000, maxUses: 50, uses: 12, expiry: '2025-06-30', active: true }
    ];
    appData.customers = [
        { id: 1, name: 'Juan', lastname: 'Pérez', email: 'juan@email.com', phone: '351-1234567', orders: 5, totalPurchases: 125000 },
        { id: 2, name: 'María', lastname: 'González', email: 'maria@email.com', phone: '358-7654321', orders: 3, totalPurchases: 67500 }
    ];
    appData.orders = [
        { id: 1001, customer: 'Juan Pérez', email: 'juan@email.com', date: '2025-01-28', total: 45600, status: 'pending', items: [] },
        { id: 1002, customer: 'María González', email: 'maria@email.com', date: '2025-01-27', total: 89900, status: 'processing', items: [] }
    ];
    saveData();
}

// ==================== RENDER ====================
function renderAll() {
    updateCategoryProductCounts();
    renderCategories();
    renderProducts();
    renderAdminTables();
    renderBannersAdmin();
    updateStats();
    updateCartUI();
    loadCompanyData();
    loadSecurityPanel();
}

function updateCategoryProductCounts() {
    appData.categories.forEach(cat => {
        cat.productCount = appData.products.filter(p => p.category === cat.name && p.active).length;
    });
}

function renderCategories() {
    const grid = document.getElementById('categoriesGrid');
    const footerCats = document.getElementById('footerCategories');
    const heroCats = document.getElementById('heroCategories');
    
    const activeCategories = appData.categories.filter(c => c.active);
    
    // Grid principal de categorías
    grid.innerHTML = activeCategories.map(cat => `
        <div class="category-card" onclick="filterByCategory('${cat.name}')">
            <div class="category-icon"><i class="fas ${cat.icon}"></i></div>
            <div class="category-name">${cat.name}</div>
            <div class="category-count">${cat.productCount || 0} productos</div>
        </div>
    `).join('');
    
    // Categorías en el footer
    footerCats.innerHTML = activeCategories.slice(0, 5).map(cat => `
        <li><a href="#" onclick="filterByCategory('${cat.name}')">${cat.name}</a></li>
    `).join('');
    
    // Categorías en el hero (primeras 4)
    if(heroCats && activeCategories.length > 0) {
        heroCats.innerHTML = activeCategories.slice(0, 4).map(cat => `
            <div class="hero-product" onclick="filterByCategory('${cat.name}')">
                <i class="fas ${cat.icon}"></i>
                <span>${cat.name}</span>
            </div>
        `).join('');
    }
}

function renderProducts(products = null) {
    const grid = document.getElementById('productsGrid');
    const display = products || appData.products.filter(p => p.active);
    if (display.length === 0) {
        grid.innerHTML = '';
        document.getElementById('noProductsMessage').style.display = 'block';
        return;
    }
    document.getElementById('noProductsMessage').style.display = 'none';
    document.getElementById('heroProductCount').textContent = appData.products.filter(p => p.active).length;
    grid.innerHTML = display.map(p => {
        const badge = p.badge ? `<span class="product-badge badge-${p.badge}">${p.badge === 'sale' ? 'Oferta' : p.badge === 'new' ? 'Nuevo' : 'Popular'}</span>` : '';
        const price = p.salePrice ? `<span class="price-current">$${formatNumber(p.salePrice)}</span><span class="price-original">$${formatNumber(p.price)}</span>` : `<span class="price-current">$${formatNumber(p.price)}</span>`;
        
        // Obtener imágenes (compatibilidad con imagen única o array)
        const images = p.images && p.images.length > 0 ? p.images : (p.image ? [p.image] : []);
        const hasMultipleImages = images.length > 1;
        let mainImage = images[0];
        
        // Si no tiene imagen, generar placeholder
        if(!mainImage) {
            const colors = {'Herramientas Manuales':'2563EB','Electricidad':'F59E0B','Plomería':'3B82F6','Pinturas':'10B981','Cerrajería':'6366F1','Tornillería':'6B7280','Jardinería':'059669','Iluminación':'FBBF24'};
            const color = colors[p.category] || '2A7AB8';
            const text = encodeURIComponent((p.name || 'Producto').substring(0, 12));
            mainImage = `https://placehold.co/400x400/${color}/ffffff?text=${text}`;
        }
        
        const productImageHtml = `<img src="${mainImage}" alt="${p.name}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x400/cccccc/666666?text=Sin+Imagen';">`;
        
        const imageCounter = hasMultipleImages ? `<span class="image-counter"><i class="fas fa-images"></i> ${images.length}</span>` : '';
        
        return `
            <div class="product-card" data-product-id="${p.id}">
                ${badge}
                ${imageCounter}
                <div class="product-actions">
                    <button class="product-action-btn" onclick="quickView(${p.id})" title="Vista rápida"><i class="fas fa-eye"></i></button>
                    <button class="product-action-btn" title="Favoritos"><i class="fas fa-heart"></i></button>
                </div>
                <div class="product-image" ${hasMultipleImages ? `onclick="showProductGallery(${p.id})"` : ''}>${productImageHtml}</div>
                <div class="product-info">
                    <div class="product-category">${p.category}</div>
                    <h3 class="product-name">${p.name}</h3>
                    <div class="product-rating"><span class="stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></span><span class="rating-count">(${Math.floor(Math.random()*50)+10})</span></div>
                    <div class="product-price">${price}</div>
                    <div class="product-footer">
                        <button class="add-cart-btn" onclick="addToCart(${p.id})"><i class="fas fa-cart-plus"></i> Agregar</button>
                        <button class="whatsapp-product-btn" onclick="openWhatsApp('${p.name.replace(/'/g, "\\'")}')"><i class="fab fa-whatsapp"></i></button>
                        <button class="share-product-btn" onclick="shareProduct(${p.id})" title="Compartir"><i class="fas fa-share-alt"></i></button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

// Galería de imágenes del producto
function showProductGallery(productId) {
    const p = appData.products.find(x => x.id === productId);
    if(!p) return;
    
    const images = p.images && p.images.length > 0 ? p.images : (p.image ? [p.image] : []);
    if(images.length === 0) return;
    
    const modal = document.createElement('div');
    modal.id = 'productGalleryModal';
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:10000;';
    
    modal.innerHTML = `
        <div style="position:relative;max-width:90%;max-height:90%;">
            <button onclick="document.getElementById('productGalleryModal').remove()" style="position:absolute;top:-40px;right:0;background:none;border:none;color:white;font-size:30px;cursor:pointer;">×</button>
            <img id="galleryMainImage" src="${images[0]}" style="max-width:100%;max-height:80vh;object-fit:contain;border-radius:10px;">
            <div style="display:flex;justify-content:center;gap:10px;margin-top:15px;">
                ${images.map((img, idx) => `
                    <img src="${img}" onclick="document.getElementById('galleryMainImage').src='${img}'" 
                        style="width:60px;height:60px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid ${idx === 0 ? 'var(--primary)' : 'transparent'};"
                        onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='transparent'">
                `).join('')}
            </div>
            <p style="text-align:center;color:white;margin-top:15px;">${p.name}</p>
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.addEventListener('click', (e) => {
        if(e.target === modal) modal.remove();
    });
}

function renderAdminTables() {
    // Products
    document.getElementById('productsTableBody').innerHTML = appData.products.map(p => {
        const imgContent = p.image ? `<img src="${p.image}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover;border-radius:6px;" onerror="this.outerHTML='<i class=\\'fas fa-box\\'></i>'">` : '<i class="fas fa-box"></i>';
        return `
        <tr>
            <td><div class="table-product"><div class="table-product-img">${imgContent}</div><div><strong>${p.name}</strong>${p.brand ? `<br><small style="color:var(--text-secondary)">${p.brand}</small>` : ''}</div></div></td>
            <td>${p.code}</td><td>${p.category}</td>
            <td>${p.salePrice ? `<span style="text-decoration:line-through;color:var(--text-light)">$${formatNumber(p.price)}</span><br>` : ''}<strong>$${formatNumber(p.salePrice||p.price)}</strong></td>
            <td><span style="color:${p.stock<=p.minStock?'var(--danger)':'var(--success)'}">${p.stock}</span></td>
            <td><span class="status-badge ${p.active?'status-active':'status-inactive'}">${p.active?'Activo':'Inactivo'}</span></td>
            <td><button class="action-btn" onclick="editProduct(${p.id})" title="Editar"><i class="fas fa-edit"></i></button><button class="action-btn danger" onclick="deleteProduct(${p.id})" title="Eliminar"><i class="fas fa-trash"></i></button></td>
        </tr>
    `}).join('');

    // Categories
    document.getElementById('categoriesTableBody').innerHTML = appData.categories.map(c => `
        <tr>
            <td><div class="table-product-img" style="background:var(--primary);color:white"><i class="fas ${c.icon}"></i></div></td>
            <td><strong>${c.name}</strong></td><td>${c.productCount}</td>
            <td><span class="status-badge ${c.active?'status-active':'status-inactive'}">${c.active?'Activa':'Inactiva'}</span></td>
            <td><button class="action-btn" onclick="editCategory(${c.id})"><i class="fas fa-edit"></i></button><button class="action-btn danger" onclick="deleteCategory(${c.id})"><i class="fas fa-trash"></i></button></td>
        </tr>
    `).join('');

    // Orders
    document.getElementById('ordersTableBody').innerHTML = appData.orders.map(o => {
        const st = {pending:'Pendiente',processing:'En Proceso',shipped:'Enviado',completed:'Entregado',cancelled:'Cancelado'}[o.status] || 'Pendiente';
        const cl = {completed:'status-active',pending:'status-pending',processing:'status-warning',shipped:'status-info',cancelled:'status-inactive'}[o.status] || 'status-pending';
        return `<tr>
            <td><strong>#${o.id}</strong></td>
            <td><div>${o.customer}</div><small style="color:var(--text-light)">${o.phone || ''}</small></td>
            <td>${o.date}</td>
            <td><strong>$${formatNumber(o.total)}</strong></td>
            <td><span class="status-badge ${cl}">${st}</span></td>
            <td>
                <button class="action-btn" onclick="viewOrderDetail(${o.id})" title="Ver detalle"><i class="fas fa-eye"></i></button>
                <button class="action-btn" onclick="changeOrderStatus(${o.id})" title="Cambiar estado"><i class="fas fa-exchange-alt"></i></button>
                <button class="action-btn" onclick="sendPaymentLink(${o.id})" title="Enviar link de pago"><i class="fas fa-credit-card"></i></button>
                <button class="action-btn" onclick="contactCustomerOrder(${o.id})" title="Contactar por WhatsApp"><i class="fab fa-whatsapp"></i></button>
            </td>
        </tr>`;
    }).join('');

    // Customers
    document.getElementById('customersTableBody').innerHTML = appData.customers.map(c => `
        <tr><td><strong>${c.name} ${c.lastname}</strong></td><td>${c.email}</td><td>${c.phone}</td><td>${c.orders}</td><td><strong>$${formatNumber(c.totalPurchases)}</strong></td><td><button class="action-btn" onclick="editCustomer(${c.id})"><i class="fas fa-edit"></i></button></td></tr>
    `).join('');

    // Shipping
    document.getElementById('shippingTableBody').innerHTML = appData.shippingZones.map(z => `
        <tr>
            <td>
                <strong>${z.name}</strong>
                ${z.description ? `<br><small style="color:var(--text-secondary)">${z.description}</small>` : ''}
            </td>
            <td><i class="fas fa-clock" style="color:var(--text-light);margin-right:5px;"></i>${z.time}</td>
            <td>
                ${z.cost === 0 ? '<span style="color:var(--success);font-weight:600;"><i class="fas fa-check"></i> Gratis</span>' : '$' + formatNumber(z.cost)}
                ${z.minFree > 0 ? `<br><small style="color:var(--primary)">Gratis +$${formatNumber(z.minFree)}</small>` : ''}
            </td>
            <td><span class="status-badge ${z.active ? 'status-active' : 'status-inactive'}">${z.active ? 'Activa' : 'Inactiva'}</span></td>
            <td>
                <button class="action-btn" onclick="editShipping(${z.id})" title="Editar"><i class="fas fa-edit"></i></button>
                <button class="action-btn danger" onclick="deleteShipping(${z.id})" title="Eliminar"><i class="fas fa-trash"></i></button>
            </td>
        </tr>
    `).join('');
    
    // Mostrar mensaje si no hay zonas
    if(appData.shippingZones.length === 0) {
        document.getElementById('shippingTableBody').innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:var(--text-light);"><i class="fas fa-truck" style="font-size:30px;display:block;margin-bottom:10px;"></i>No hay zonas de envío configuradas<br><small>Creá tu primera zona de envío</small></td></tr>';
    }

    // Coupons
    document.getElementById('couponsTableBody').innerHTML = appData.coupons.map(c => `
        <tr><td><strong>${c.code}</strong></td><td>${c.type==='percentage'?c.value+'%':'$'+formatNumber(c.value)}</td><td>${c.type==='percentage'?'Porcentaje':'Monto'}</td><td>${c.uses}/${c.maxUses||'∞'}</td><td>${c.expiry||'Sin fecha'}</td><td><span class="status-badge ${c.active?'status-active':'status-inactive'}">${c.active?'Activo':'Inactivo'}</span></td><td><button class="action-btn" onclick="editCoupon(${c.id})"><i class="fas fa-edit"></i></button><button class="action-btn danger" onclick="deleteCoupon(${c.id})"><i class="fas fa-trash"></i></button></td></tr>
    `).join('');

    // Inventory
    document.getElementById('inventoryTableBody').innerHTML = appData.products.map(p => {
        const st = p.stock===0?'out':p.stock<=p.minStock?'low':'in';
        const txt = {out:'Sin Stock',low:'Stock Bajo',in:'En Stock'}[st];
        const cl = {out:'status-inactive',low:'status-pending',in:'status-active'}[st];
        return `<tr><td><div class="table-product"><div class="table-product-img"><i class="fas fa-box"></i></div><strong>${p.name}</strong></div></td><td>${p.code}</td><td><strong>${p.stock}</strong></td><td>${p.minStock}</td><td><span class="status-badge ${cl}">${txt}</span></td><td><button class="action-btn" onclick="adjustStock(${p.id})"><i class="fas fa-edit"></i></button></td></tr>`;
    }).join('');
    document.getElementById('lowStockCount').textContent = appData.products.filter(p=>p.stock<=p.minStock).length;

    // Recent Orders
    document.getElementById('recentOrdersList').innerHTML = `<table class="data-table"><thead><tr><th>Pedido</th><th>Cliente</th><th>Total</th><th>Estado</th></tr></thead><tbody>${appData.orders.slice(0,5).map(o=>{
        const st = {pending:'Pendiente',processing:'En Proceso',shipped:'Enviado',completed:'Completado'}[o.status];
        return `<tr><td><strong>#${o.id}</strong></td><td>${o.customer}</td><td>$${formatNumber(o.total)}</td><td>${st}</td></tr>`;
    }).join('')}</tbody></table>`;

    // Category select
    document.getElementById('productCategory').innerHTML = '<option value="">Seleccionar...</option>' + appData.categories.filter(c=>c.active).map(c=>`<option value="${c.name}">${c.name}</option>`).join('');
}

function updateStats() {
    document.getElementById('statOrders').textContent = appData.orders.length;
    document.getElementById('statRevenue').textContent = '$' + formatNumber(appData.orders.reduce((s,o)=>s+o.total,0));
    document.getElementById('statProducts').textContent = appData.products.filter(p=>p.active).length;
    document.getElementById('statCustomers').textContent = appData.customers.length;
    document.getElementById('pendingOrdersBadge').textContent = appData.orders.filter(o=>o.status==='pending').length;
}

// ==================== NAVIGATION ====================
function showStore() {
    document.getElementById('storeView').style.display = 'block';
    document.getElementById('adminView').classList.remove('visible');
    closeMobileMenu();
}

function showAdmin() {
    document.getElementById('storeView').style.display = 'none';
    document.getElementById('adminView').classList.add('visible');
    showAdminSection('dashboard', document.querySelector('.menu-item.active'));
}

function showAdminSection(section, el) {
    document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));
    if(el) el.classList.add('active');
    document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
    document.getElementById('section-'+section).classList.add('active');
    const titles = {dashboard:'Dashboard',products:'Productos',categories:'Categorías',banners:'Banners',orders:'Pedidos',customers:'Clientes',inventory:'Inventario',coupons:'Cupones',company:'Datos Empresa',shipping:'Envíos',payments:'Pagos',notifications:'Notificaciones',wyndes:'Sync Wyndes',firebase:'Firebase',security:'Seguridad'};
    document.getElementById('adminPageTitle').textContent = titles[section]||section;
    closeMobileMenu(); // Cerrar menú en móvil al seleccionar sección
}

// Mobile menu functions
function toggleMobileMenu() {
    const sidebar = document.querySelector('.admin-sidebar');
    const overlay = document.getElementById('mobileMenuOverlay');
    sidebar.classList.toggle('mobile-open');
    overlay.classList.toggle('active');
}

function closeMobileMenu() {
    const sidebar = document.querySelector('.admin-sidebar');
    const overlay = document.getElementById('mobileMenuOverlay');
    if(sidebar) sidebar.classList.remove('mobile-open');
    if(overlay) overlay.classList.remove('active');
}

function scrollToProducts() { document.getElementById('productosSection').scrollIntoView({behavior:'smooth'}); }

// ==================== FILTERS ====================
function searchProducts() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const filtered = appData.products.filter(p=>p.active&&(p.name.toLowerCase().includes(q)||p.code.toLowerCase().includes(q)||p.category.toLowerCase().includes(q)||(p.brand&&p.brand.toLowerCase().includes(q))));
    document.getElementById('productsSectionTitle').textContent = q?`Resultados para "${q}"`:'Productos Destacados';
    renderProducts(filtered);
}

function filterByCategory(cat) {
    let filtered, title;
    if(cat==='ofertas') { filtered = appData.products.filter(p=>p.active&&p.salePrice); title='Ofertas'; }
    else if(cat==='nuevos') { filtered = appData.products.filter(p=>p.active&&p.badge==='new'); title='Nuevos Productos'; }
    else { filtered = appData.products.filter(p=>p.active&&p.category===cat); title=cat; }
    document.getElementById('productsSectionTitle').textContent = title;
    renderProducts(filtered);
    scrollToProducts();
}

function loadAllProducts() {
    document.getElementById('productsSectionTitle').textContent = 'Todos los Productos';
    renderProducts();
}

// ==================== CART ====================
function addToCart(id) {
    const p = appData.products.find(x=>x.id===id);
    if(!p) return;
    const existing = appData.cart.find(x=>x.id===id);
    if(existing) existing.qty++;
    else appData.cart.push({...p, qty: 1});
    updateCartUI();
    showToast('success','Agregado','Producto agregado al carrito');
}

function removeFromCart(id) {
    appData.cart = appData.cart.filter(x=>x.id!==id);
    updateCartUI();
}

function updateCartQty(id, delta) {
    const item = appData.cart.find(x=>x.id===id);
    if(item) {
        item.qty += delta;
        if(item.qty <= 0) removeFromCart(id);
        else updateCartUI();
    }
}

function updateCartUI() {
    const badge = document.getElementById('cartCount');
    const list = document.getElementById('cartItems');
    const total = document.getElementById('cartTotal');
    const count = appData.cart.reduce((s,i)=>s+i.qty, 0);
    badge.textContent = count;
    badge.style.display = count > 0 ? 'flex' : 'none';
    if(appData.cart.length === 0) {
        list.innerHTML = '<div class="cart-empty"><i class="fas fa-shopping-cart"></i><p>Tu carrito está vacío</p></div>';
        total.textContent = '$0';
    } else {
        list.innerHTML = appData.cart.map(i => {
            const cartImg = i.image ? `<img src="${i.image}" alt="${i.name}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" onerror="this.outerHTML='<i class=\\'fas fa-box\\'></i>'">` : '<i class="fas fa-box"></i>';
            return `
            <div class="cart-item">
                <div class="cart-item-image">${cartImg}</div>
                <div class="cart-item-info">
                    <div class="cart-item-name">${i.name}</div>
                    <div class="cart-item-price">$${formatNumber(i.salePrice||i.price)}</div>
                </div>
                <div class="cart-item-qty">
                    <button onclick="updateCartQty(${i.id},-1)">-</button>
                    <span>${i.qty}</span>
                    <button onclick="updateCartQty(${i.id},1)">+</button>
                </div>
                <button class="cart-item-remove" onclick="removeFromCart(${i.id})"><i class="fas fa-times"></i></button>
            </div>
        `}).join('');
        const sum = appData.cart.reduce((s,i)=>s+(i.salePrice||i.price)*i.qty, 0);
        total.textContent = '$' + formatNumber(sum);
    }
}

function toggleCart() {
    document.getElementById('cartOverlay').classList.toggle('active');
    document.getElementById('cartSidebar').classList.toggle('active');
}

function buyNow(id) { addToCart(id); toggleCart(); }

function shareProduct(id) {
    const p = appData.products.find(x => x.id === id);
    if(!p) return;
    
    const companyName = window.companyName || 'Ferretería Bruzzone';
    const price = p.salePrice || p.price;
    const currentUrl = window.location.href.split('?')[0];
    const productUrl = `${currentUrl}?producto=${id}`;
    
    const shareText = `🔧 ${p.name}\n💰 $${formatNumber(price)}\n\n${companyName}`;
    
    // Mostrar opciones de compartir
    const options = `
        <div style="display:flex;flex-direction:column;gap:15px;padding:10px;">
            <button onclick="shareViaWhatsApp(${id})" style="padding:15px;background:#25D366;color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;">
                <i class="fab fa-whatsapp" style="font-size:20px;"></i> Compartir por WhatsApp
            </button>
            <button onclick="shareViaFacebook(${id})" style="padding:15px;background:#1877F2;color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;">
                <i class="fab fa-facebook-f" style="font-size:20px;"></i> Compartir en Facebook
            </button>
            <button onclick="copyProductLink(${id})" style="padding:15px;background:var(--secondary);color:white;border:none;border-radius:10px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;">
                <i class="fas fa-link" style="font-size:20px;"></i> Copiar enlace
            </button>
        </div>
    `;
    
    // Crear modal de compartir
    const modal = document.createElement('div');
    modal.id = 'shareModal';
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:10000;';
    modal.innerHTML = `
        <div style="background:white;border-radius:15px;padding:25px;max-width:350px;width:90%;text-align:center;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="margin:0;font-size:18px;">Compartir Producto</h3>
                <button onclick="document.getElementById('shareModal').remove()" style="background:none;border:none;font-size:20px;cursor:pointer;color:var(--text-light);">×</button>
            </div>
            <p style="color:var(--text-secondary);margin-bottom:15px;font-size:14px;">${p.name}</p>
            ${options}
        </div>
    `;
    document.body.appendChild(modal);
    
    // Cerrar al hacer clic fuera
    modal.addEventListener('click', (e) => {
        if(e.target === modal) modal.remove();
    });
}

function shareViaWhatsApp(id) {
    const p = appData.products.find(x => x.id === id);
    if(!p) return;
    
    const companyName = window.companyName || 'Ferretería Bruzzone';
    const price = p.salePrice || p.price;
    const currentUrl = window.location.href.split('?')[0];
    
    const mensaje = `🔧 *${p.name}*\n💰 Precio: $${formatNumber(price)}\n\n📍 ${companyName}\n🔗 ${currentUrl}`;
    
    window.open(`https://wa.me/?text=${encodeURIComponent(mensaje)}`, '_blank');
    document.getElementById('shareModal')?.remove();
}

function shareViaFacebook(id) {
    const currentUrl = window.location.href.split('?')[0];
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`, '_blank', 'width=600,height=400');
    document.getElementById('shareModal')?.remove();
}

function copyProductLink(id) {
    const p = appData.products.find(x => x.id === id);
    if(!p) return;
    
    const companyName = window.companyName || 'Ferretería Bruzzone';
    const price = p.salePrice || p.price;
    const currentUrl = window.location.href.split('?')[0];
    
    const texto = `${p.name} - $${formatNumber(price)} | ${companyName} - ${currentUrl}`;
    
    navigator.clipboard.writeText(texto).then(() => {
        showToast('success', 'Copiado', 'Enlace copiado al portapapeles');
        document.getElementById('shareModal')?.remove();
    }).catch(() => {
        // Fallback para navegadores viejos
        const input = document.createElement('input');
        input.value = texto;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        showToast('success', 'Copiado', 'Enlace copiado al portapapeles');
        document.getElementById('shareModal')?.remove();
    });
}

function proceedToCheckout() {
    if(appData.cart.length === 0) { 
        showToast('error', 'Carrito vacío', 'Agregá productos para continuar'); 
        return; 
    }
    
    // Pre-cargar datos del cliente si está logueado
    if(currentCustomer) {
        document.getElementById('checkoutName').value = currentCustomer.name || '';
        document.getElementById('checkoutPhone').value = currentCustomer.phone || '';
        document.getElementById('checkoutEmail').value = currentCustomer.email || '';
        document.getElementById('checkoutAddress').value = currentCustomer.address || '';
    } else {
        // Limpiar formulario
        document.getElementById('checkoutName').value = '';
        document.getElementById('checkoutPhone').value = '';
        document.getElementById('checkoutEmail').value = '';
        document.getElementById('checkoutAddress').value = '';
    }
    
    // Cargar zonas de envío activas
    const shippingSelect = document.getElementById('checkoutShipping');
    shippingSelect.innerHTML = '<option value="">Seleccioná tu zona...</option>' + 
        appData.shippingZones.filter(z => z.active).map(z => 
            `<option value="${z.id}" data-cost="${z.cost}" data-minfree="${z.minFree || 0}">${z.name} - ${z.cost === 0 ? 'Gratis' : '$' + formatNumber(z.cost)} (${z.time})</option>`
        ).join('');
    
    // Calcular subtotal
    updateCheckoutTotal();
    
    // Cerrar carrito y abrir checkout
    document.getElementById('cartSidebar').classList.remove('active');
    showModal('checkoutModal');
}

function updateCheckoutTotal() {
    const subtotal = appData.cart.reduce((sum, item) => {
        const product = appData.products.find(p => p.id === item.id);
        if(!product) return sum;
        const price = product.salePrice || product.price;
        return sum + (price * item.qty);
    }, 0);
    
    const shippingSelect = document.getElementById('checkoutShipping');
    const selectedOption = shippingSelect.options[shippingSelect.selectedIndex];
    
    let shippingCost = 0;
    let shippingText = 'Seleccioná zona';
    
    if(selectedOption && selectedOption.value) {
        const cost = parseFloat(selectedOption.dataset.cost) || 0;
        const minFree = parseFloat(selectedOption.dataset.minfree) || 0;
        
        if(cost === 0) {
            shippingCost = 0;
            shippingText = '<span style="color: var(--success);">Gratis</span>';
        } else if(minFree > 0 && subtotal >= minFree) {
            shippingCost = 0;
            shippingText = '<span style="color: var(--success);">Gratis (compraste +$' + formatNumber(minFree) + ')</span>';
        } else {
            shippingCost = cost;
            shippingText = '$' + formatNumber(cost);
            if(minFree > 0) {
                shippingText += `<br><small style="color: var(--primary);">Gratis si comprás +$${formatNumber(minFree)}</small>`;
            }
        }
    }
    
    const total = subtotal + shippingCost;
    
    document.getElementById('checkoutSubtotal').textContent = '$' + formatNumber(subtotal);
    document.getElementById('checkoutShippingCost').innerHTML = shippingText;
    document.getElementById('checkoutTotal').textContent = '$' + formatNumber(total);
}

function confirmOrder() {
    const name = document.getElementById('checkoutName').value.trim();
    const phone = document.getElementById('checkoutPhone').value.trim();
    const email = document.getElementById('checkoutEmail').value.trim();
    const address = document.getElementById('checkoutAddress').value.trim();
    const shippingZone = document.getElementById('checkoutShipping').value;
    const paymentMethod = document.getElementById('checkoutPayment').value;
    const notes = document.getElementById('checkoutNotes').value.trim();
    
    // Validaciones
    if(!name) { showToast('error', 'Error', 'Ingresá tu nombre'); return; }
    if(!phone) { showToast('error', 'Error', 'Ingresá tu teléfono'); return; }
    if(!email) { showToast('error', 'Error', 'Ingresá tu email'); return; }
    if(!address) { showToast('error', 'Error', 'Ingresá tu dirección'); return; }
    if(!shippingZone) { showToast('error', 'Error', 'Seleccioná una zona de envío'); return; }
    
    // Calcular totales
    const subtotal = appData.cart.reduce((sum, item) => {
        const product = appData.products.find(p => p.id === item.id);
        if(!product) return sum;
        return sum + ((product.salePrice || product.price) * item.qty);
    }, 0);
    
    const zone = appData.shippingZones.find(z => z.id === parseInt(shippingZone));
    let shippingCost = zone ? zone.cost : 0;
    if(zone && zone.minFree && subtotal >= zone.minFree) shippingCost = 0;
    
    const total = subtotal + shippingCost;
    
    // Crear pedido
    const order = {
        id: Date.now(),
        customer: name,
        phone: phone,
        email: email,
        address: address,
        date: new Date().toLocaleDateString('es-AR'),
        status: 'Pendiente',
        paymentMethod: paymentMethod === 'efectivo' ? 'Efectivo' : paymentMethod === 'transferencia' ? 'Transferencia' : 'Mercado Pago',
        items: appData.cart.map(item => {
            const p = appData.products.find(x => x.id === item.id);
            return {
                id: item.id,
                name: p ? p.name : 'Producto',
                qty: item.qty,
                price: p ? (p.salePrice || p.price) : 0
            };
        }),
        subtotal: subtotal,
        shipping: shippingCost,
        shippingZone: zone ? zone.name : '',
        total: total,
        notes: notes
    };
    
    appData.orders.push(order);
    
    // Actualizar cliente si existe
    if(currentCustomer) {
        const idx = appData.customers.findIndex(c => c.id === currentCustomer.id);
        if(idx >= 0) {
            appData.customers[idx].orders = (appData.customers[idx].orders || 0) + 1;
            appData.customers[idx].totalSpent = (appData.customers[idx].totalSpent || 0) + total;
        }
    }
    
    // Descontar stock
    appData.cart.forEach(item => {
        const pIdx = appData.products.findIndex(p => p.id === item.id);
        if(pIdx >= 0) {
            appData.products[pIdx].stock = Math.max(0, appData.products[pIdx].stock - item.qty);
        }
    });
    
    // Limpiar carrito
    appData.cart = [];
    
    saveData();
    renderAll();
    closeModal('checkoutModal');
    
    // Enviar notificación por email al admin
    sendOrderNotificationEmail(order);
    
    showToast('success', '¡Pedido Confirmado!', `Tu pedido #${order.id} fue registrado`);
    
    // Mostrar mensaje de confirmación
    setTimeout(() => {
        alert(`¡Gracias por tu compra, ${name.split(' ')[0]}!\n\nTu pedido #${order.id} fue registrado.\n\nTotal: $${formatNumber(total)}\n\nNos contactaremos pronto para coordinar el envío.`);
    }, 500);
}

function sendOrderWhatsApp() {
    const name = document.getElementById('checkoutName').value.trim();
    const phone = document.getElementById('checkoutPhone').value.trim();
    const email = document.getElementById('checkoutEmail').value.trim();
    const address = document.getElementById('checkoutAddress').value.trim();
    const shippingZone = document.getElementById('checkoutShipping').value;
    const paymentMethod = document.getElementById('checkoutPayment').value;
    const notes = document.getElementById('checkoutNotes').value.trim();
    
    // Validaciones básicas
    if(!name || !phone) { 
        showToast('error', 'Error', 'Completá al menos nombre y teléfono'); 
        return; 
    }
    
    // Calcular totales
    const subtotal = appData.cart.reduce((sum, item) => {
        const product = appData.products.find(p => p.id === item.id);
        if(!product) return sum;
        return sum + ((product.salePrice || product.price) * item.qty);
    }, 0);
    
    const zone = appData.shippingZones.find(z => z.id === parseInt(shippingZone));
    let shippingCost = zone ? zone.cost : 0;
    if(zone && zone.minFree && subtotal >= zone.minFree) shippingCost = 0;
    
    const total = subtotal + shippingCost;
    
    // Armar mensaje
    let mensaje = `🛒 *NUEVO PEDIDO*\n\n`;
    mensaje += `👤 *Cliente:* ${name}\n`;
    mensaje += `📱 *Tel:* ${phone}\n`;
    if(email) mensaje += `📧 *Email:* ${email}\n`;
    if(address) mensaje += `📍 *Dirección:* ${address}\n`;
    mensaje += `\n📦 *Productos:*\n`;
    
    appData.cart.forEach(item => {
        const p = appData.products.find(x => x.id === item.id);
        if(p) {
            const price = p.salePrice || p.price;
            mensaje += `• ${item.qty}x ${p.name} - $${formatNumber(price * item.qty)}\n`;
        }
    });
    
    mensaje += `\n💰 *Subtotal:* $${formatNumber(subtotal)}`;
    if(zone) mensaje += `\n🚚 *Envío (${zone.name}):* ${shippingCost === 0 ? 'Gratis' : '$' + formatNumber(shippingCost)}`;
    mensaje += `\n\n💵 *TOTAL: $${formatNumber(total)}*`;
    mensaje += `\n\n💳 *Pago:* ${paymentMethod === 'efectivo' ? 'Efectivo' : paymentMethod === 'transferencia' ? 'Transferencia' : 'Mercado Pago'}`;
    if(notes) mensaje += `\n\n📝 *Notas:* ${notes}`;
    
    // Enviar por WhatsApp
    let whatsappNumber = appData.company?.whatsapp || '';
    if(!whatsappNumber.startsWith('54')) whatsappNumber = '54' + whatsappNumber.replace(/\D/g, '');
    
    window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(mensaje)}`, '_blank');
}

// ==================== MODALS ====================
function showModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

let currentProductImages = []; // Array de imágenes del producto

function showProductModal(id = null) {
    const modal = document.getElementById('productModal');
    const urlInput = document.getElementById('productImageUrl');
    
    document.getElementById('productModalTitle').textContent = id ? 'Editar Producto' : 'Nuevo Producto';
    document.getElementById('productId').value = id || '';
    
    // Reset imágenes
    currentProductImages = [];
    urlInput.value = '';
    document.getElementById('productImage').value = '';
    
    if(id) {
        const p = appData.products.find(x=>x.id===id);
        document.getElementById('productName').value = p.name;
        document.getElementById('productCode').value = p.code;
        document.getElementById('productCategory').value = p.category;
        document.getElementById('productBrand').value = p.brand||'';
        document.getElementById('productPrice').value = p.price;
        document.getElementById('productSalePrice').value = p.salePrice||'';
        document.getElementById('productStock').value = p.stock;
        document.getElementById('productMinStock').value = p.minStock;
        document.getElementById('productDescription').value = p.description||'';
        document.getElementById('productActive').checked = p.active;
        document.getElementById('productFeatured').checked = p.featured;
        
        // Cargar imágenes existentes
        if(p.images && Array.isArray(p.images)) {
            currentProductImages = [...p.images];
        } else if(p.image) {
            // Compatibilidad con imagen única antigua
            currentProductImages = [p.image];
        }
    } else {
        document.getElementById('productForm').reset();
        document.getElementById('productActive').checked = true;
    }
    
    renderProductImagesGallery();
    showModal('productModal');
}

function renderProductImagesGallery() {
    const gallery = document.getElementById('productImagesGallery');
    if(!gallery) return;
    
    if(currentProductImages.length === 0) {
        gallery.innerHTML = '';
        return;
    }
    
    gallery.innerHTML = currentProductImages.map((img, idx) => `
        <div class="gallery-image-item ${idx === 0 ? 'main' : ''}">
            <img src="${img}" alt="Imagen ${idx + 1}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f0f0f0%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2250%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22>Error</text></svg>'">
            ${idx === 0 ? '<span class="main-badge">PRINCIPAL</span>' : ''}
            <button type="button" class="remove-img" onclick="removeProductImageAt(${idx})" title="Eliminar"><i class="fas fa-times"></i></button>
            ${idx !== 0 ? `<button type="button" class="set-main" onclick="setMainImage(${idx})" title="Hacer principal"><i class="fas fa-star"></i></button>` : ''}
        </div>
    `).join('');
}

function removeProductImageAt(index) {
    currentProductImages.splice(index, 1);
    renderProductImagesGallery();
}

function setMainImage(index) {
    const img = currentProductImages.splice(index, 1)[0];
    currentProductImages.unshift(img);
    renderProductImagesGallery();
}

function saveProduct() {
    const id = document.getElementById('productId').value;
    const data = {
        name: document.getElementById('productName').value,
        code: document.getElementById('productCode').value,
        category: document.getElementById('productCategory').value,
        brand: document.getElementById('productBrand').value,
        price: parseFloat(document.getElementById('productPrice').value),
        salePrice: document.getElementById('productSalePrice').value ? parseFloat(document.getElementById('productSalePrice').value) : null,
        stock: parseInt(document.getElementById('productStock').value),
        minStock: parseInt(document.getElementById('productMinStock').value)||5,
        description: document.getElementById('productDescription').value,
        active: document.getElementById('productActive').checked,
        featured: document.getElementById('productFeatured').checked,
        images: currentProductImages.length > 0 ? currentProductImages : [],
        image: currentProductImages.length > 0 ? currentProductImages[0] : null // Compatibilidad
    };
    if(!data.name||!data.code||!data.category||!data.price) { showToast('error','Error','Completá los campos requeridos'); return; }
    data.badge = data.salePrice ? 'sale' : null;
    if(id) {
        const idx = appData.products.findIndex(x=>x.id===parseInt(id));
        if(idx>=0) appData.products[idx] = {...appData.products[idx], ...data};
    } else {
        data.id = Date.now();
        appData.products.push(data);
    }
    try {
        saveData(); renderAll(); closeModal('productModal');
        showToast('success','Guardado',id?'Producto actualizado':'Producto creado');
    } catch(e) {
        if(e.name === 'QuotaExceededError') {
            showToast('error','Error','Almacenamiento lleno. Usá imágenes más pequeñas o URLs externas.');
        } else {
            showToast('error','Error','No se pudo guardar: ' + e.message);
        }
    }
}

// ==================== IMAGE HANDLING ====================
function handleProductImage(input) {
    if(input.files && input.files.length > 0) {
        const maxImages = 5;
        const remainingSlots = maxImages - currentProductImages.length;
        
        if(remainingSlots <= 0) {
            showToast('warning', 'Límite alcanzado', 'Máximo 5 imágenes por producto');
            input.value = '';
            return;
        }
        
        const filesToProcess = Array.from(input.files).slice(0, remainingSlots);
        let processed = 0;
        
        filesToProcess.forEach(file => {
            if(file.size > 2 * 1024 * 1024) {
                showToast('warning', 'Imagen omitida', `${file.name} supera 2MB`);
                processed++;
                if(processed === filesToProcess.length) {
                    renderProductImagesGallery();
                    input.value = '';
                }
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                if(file.size > 500 * 1024) {
                    compressImage(e.target.result, 800, 0.7, function(compressed) {
                        addProductImage(compressed);
                        processed++;
                        if(processed === filesToProcess.length) {
                            renderProductImagesGallery();
                            input.value = '';
                        }
                    });
                } else {
                    addProductImage(e.target.result);
                    processed++;
                    if(processed === filesToProcess.length) {
                        renderProductImagesGallery();
                        input.value = '';
                    }
                }
            };
            reader.readAsDataURL(file);
        });
    }
}

function compressImage(dataUrl, maxWidth, quality, callback) {
    const img = new Image();
    img.onload = function() {
        const canvas = document.createElement('canvas');
        let width = img.width;
        let height = img.height;
        
        if(width > maxWidth) {
            height = height * (maxWidth / width);
            width = maxWidth;
        }
        
        canvas.width = width;
        canvas.height = height;
        
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        
        callback(canvas.toDataURL('image/jpeg', quality));
    };
    img.src = dataUrl;
}

function addProductImage(imageData) {
    if(currentProductImages.length >= 5) {
        showToast('warning', 'Límite alcanzado', 'Máximo 5 imágenes');
        return;
    }
    currentProductImages.push(imageData);
}

function addImageByUrl() {
    const urlInput = document.getElementById('productImageUrl');
    const url = urlInput.value.trim();
    
    if(!url) {
        showToast('warning', 'URL vacía', 'Ingresá una URL de imagen');
        return;
    }
    
    if(currentProductImages.length >= 5) {
        showToast('warning', 'Límite alcanzado', 'Máximo 5 imágenes');
        return;
    }
    
    // Probar cargar la imagen
    const img = new Image();
    img.onload = function() {
        currentProductImages.push(url);
        renderProductImagesGallery();
        urlInput.value = '';
        showToast('success', 'Imagen agregada', 'URL válida');
    };
    img.onerror = function() {
        showToast('error', 'Error', 'No se pudo cargar la imagen desde esa URL');
    };
    img.src = url;
}

function handleImageUrl(url) {
    // Mantener compatibilidad
    document.getElementById('productImageUrl').value = url;
    addImageByUrl();
}

function removeProductImage() {
    // Mantener compatibilidad - elimina todas
    currentProductImages = [];
    renderProductImagesGallery();
}

// ==================== AUTO IMAGE SEARCH ====================
// Palabras clave para traducir categorías de ferretería al inglés
const imageKeywords = {
    'herramienta': 'tool hardware',
    'taladro': 'drill power tool',
    'martillo': 'hammer tool',
    'destornillador': 'screwdriver',
    'pintura': 'paint brush roller',
    'electricidad': 'electrical wire plug',
    'plomeria': 'plumbing pipe faucet',
    'jardin': 'garden tools',
    'iluminacion': 'light bulb lamp',
    'lampara': 'lamp light bulb',
    'led': 'led light bulb',
    'foco': 'light bulb',
    'cable': 'electrical cable wire',
    'enchufe': 'electrical plug socket',
    'llave': 'wrench key tool',
    'sierra': 'saw tool',
    'amoladora': 'angle grinder',
    'soldadora': 'welding machine',
    'compresor': 'air compressor',
    'escalera': 'ladder',
    'cinta': 'tape measure',
    'tornillo': 'screw bolt',
    'clavo': 'nail hardware',
    'candado': 'padlock lock',
    'cerradura': 'door lock',
    'bisagra': 'hinge hardware',
    'grifo': 'faucet tap',
    'canilla': 'faucet tap',
    'manguera': 'garden hose',
    'rociador': 'sprayer',
    'bateria': 'battery power tool',
    'cargador': 'charger',
    'guante': 'work gloves safety',
    'casco': 'safety helmet',
    'lente': 'safety glasses',
    'mascara': 'safety mask',
    'balde': 'bucket pail',
    'brocha': 'paint brush',
    'rodillo': 'paint roller',
    'lija': 'sandpaper',
    'cemento': 'cement bag',
    'adhesivo': 'adhesive glue',
    'silicona': 'silicone sealant',
    'cutter': 'utility knife cutter',
    'nivel': 'level tool',
    'metro': 'tape measure',
    'alicate': 'pliers tool',
    'pinza': 'pliers clamp',
    'hogar': 'home hardware',
    'cocina': 'kitchen hardware',
    'baño': 'bathroom hardware'
};

function getImageSearchTerms(productName, category) {
    // Convertir a minúsculas
    const name = (productName || '').toLowerCase();
    const cat = (category || '').toLowerCase();
    
    let terms = [];
    
    // Buscar palabras clave conocidas en el nombre del producto
    for(const [spanish, english] of Object.entries(imageKeywords)) {
        if(name.includes(spanish)) {
            terms.push(english);
        }
    }
    
    // Si no encontró ninguna, usar palabras del nombre
    if(terms.length === 0) {
        // Tomar las primeras 3 palabras significativas
        const words = name.split(/\s+/).filter(w => w.length > 3).slice(0, 3);
        terms = words;
    }
    
    // Agregar "tool" o "hardware" si es ferretería
    if(cat.includes('herramienta') || cat.includes('bateria')) {
        terms.push('power tool');
    } else if(cat.includes('hogar')) {
        terms.push('home hardware');
    }
    
    // Agregar término genérico de ferretería
    terms.push('hardware store');
    
    return terms.join(' ').substring(0, 50);
}

function searchProductImage() {
    const name = document.getElementById('productName').value;
    const category = document.getElementById('productCategory').value;
    
    if(!name) {
        showToast('warning', 'Sin nombre', 'Primero ingresá el nombre del producto');
        return;
    }
    
    if(currentProductImages.length >= 5) {
        showToast('warning', 'Límite alcanzado', 'Máximo 5 imágenes');
        return;
    }
    
    showToast('info', 'Buscando', 'Buscando imagen...');
    
    // Usar Lorem Picsum que es más confiable
    const randomId = Math.floor(Math.random() * 1000);
    const url = `https://picsum.photos/seed/${encodeURIComponent(name.substring(0,20))}_${randomId}/800/600`;
    
    const img = new Image();
    
    img.onload = function() {
        currentProductImages.push(url);
        renderProductImagesGallery();
        showToast('success', 'Imagen agregada', 'Podés agregar más o buscar otra');
    };
    
    img.onerror = function() {
        // Fallback a placeholder con color
        const colors = ['3498db', 'e74c3c', '2ecc71', 'f39c12', '9b59b6', '1abc9c'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        const fallbackUrl = `https://via.placeholder.com/800x600/${color}/ffffff?text=${encodeURIComponent(name.substring(0,15))}`;
        
        currentProductImages.push(fallbackUrl);
        renderProductImagesGallery();
        showToast('info', 'Placeholder', 'Se usó imagen genérica');
    };
    
    img.src = url;
}

async function autoLoadAllImages() {
    const productsWithoutImage = appData.products.filter(p => !p.image && (!p.images || p.images.length === 0));
    
    if(productsWithoutImage.length === 0) {
        showToast('info', 'Info', 'Todos los productos ya tienen imagen');
        return;
    }
    
    const confirm = window.confirm(`¿Cargar imágenes automáticas para ${productsWithoutImage.length} productos sin imagen?\n\nSe generarán imágenes con el nombre del producto.`);
    if(!confirm) return;
    
    showToast('info', 'Procesando', `Generando imágenes para ${productsWithoutImage.length} productos...`);
    
    // Colores de fondo según categoría
    const categoryColors = {
        'Herramientas Manuales': '2563EB',
        'Electricidad': 'F59E0B',
        'Plomería': '3B82F6',
        'Pinturas': '10B981',
        'Cerrajería': '6366F1',
        'Tornillería': '6B7280',
        'Jardinería': '059669',
        'Iluminación': 'FBBF24',
        'default': '2A7AB8'
    };
    
    for(const product of productsWithoutImage) {
        const color = categoryColors[product.category] || categoryColors['default'];
        const text = encodeURIComponent((product.name || 'Producto').substring(0, 15));
        const url = `https://placehold.co/400x400/${color}/ffffff?text=${text}&font=roboto`;
        
        product.image = url;
        product.images = [url];
    }
    
    saveData();
    renderAll();
    
    showToast('success', 'Completado', `${productsWithoutImage.length} imágenes generadas`);
}

// Configuración de imágenes locales
const IMAGE_BASE_URL = 'https://ferreteria.bruzzone.online/images/';

// Asignar imágenes por código de producto
function autoLoadImagesByCode() {
    const baseUrl = prompt(
        'URL base de tus imágenes:\n\n' +
        'Ejemplo: https://ferreteria.bruzzone.online/images/\n\n' +
        'Las imágenes deben llamarse igual que el código del producto.\n' +
        'Ej: Si el código es HM-001, la imagen debe ser HM-001.jpg',
        IMAGE_BASE_URL
    );
    
    if(!baseUrl) return;
    
    const extension = prompt('Extensión de las imágenes:', 'jpg');
    if(!extension) return;
    
    const productsWithCode = appData.products.filter(p => p.code);
    
    if(productsWithCode.length === 0) {
        showToast('error', 'Error', 'No hay productos con código');
        return;
    }
    
    const confirmMsg = `Se asignarán imágenes a ${productsWithCode.length} productos.\n\n` +
        `Ejemplo:\n` +
        `Código: ${productsWithCode[0].code}\n` +
        `Imagen: ${baseUrl}${productsWithCode[0].code}.${extension}\n\n` +
        `¿Continuar?`;
    
    if(!confirm(confirmMsg)) return;
    
    let assigned = 0;
    for(const product of productsWithCode) {
        const imageUrl = `${baseUrl}${product.code}.${extension}`;
        product.image = imageUrl;
        product.images = [imageUrl];
        assigned++;
    }
    
    saveData();
    renderAll();
    
    showToast('success', 'Completado', `${assigned} imágenes asignadas por código`);
}

// Verificar qué imágenes faltan
function checkMissingImages() {
    const missing = appData.products.filter(p => !p.image || p.image.includes('placehold'));
    
    if(missing.length === 0) {
        showToast('success', 'Completo', 'Todos los productos tienen imagen');
        return;
    }
    
    let list = 'Productos SIN imagen real:\n\n';
    missing.forEach((p, i) => {
        if(i < 20) {
            list += `• ${p.code || 'SIN-COD'} - ${p.name}\n`;
        }
    });
    
    if(missing.length > 20) {
        list += `\n... y ${missing.length - 20} más`;
    }
    
    list += `\n\nTotal: ${missing.length} productos sin imagen`;
    
    alert(list);
}

// Exportar lista de imágenes para descargar
function exportImageList() {
    const productsWithImages = appData.products.filter(p => p.image && !p.image.includes('placehold.co'));
    
    if(productsWithImages.length === 0) {
        showToast('error', 'Error', 'No hay productos con imágenes externas');
        return;
    }
    
    let html = `<!DOCTYPE html>
<html>
<head>
    <title>Imágenes de Productos - Ferretería Bruzzone</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        h1 { color: #2A7AB8; }
        .instructions { background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .product { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .product img { width: 80px; height: 80px; object-fit: cover; border-radius: 5px; }
        .product-info { flex: 1; }
        .product-code { font-weight: bold; color: #2A7AB8; }
        .product-name { color: #333; }
        .download-btn { background: #4CAF50; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; }
        .download-btn:hover { background: #45a049; }
        .new-name { background: #fff3cd; padding: 5px 10px; border-radius: 4px; font-family: monospace; margin-top: 5px; }
    </style>
</head>
<body>
    <h1>📸 Imágenes de Productos</h1>
    
    <div class="instructions">
        <h3>📋 Instrucciones:</h3>
        <ol>
            <li><strong>Clic derecho</strong> en cada imagen → <strong>"Guardar imagen como..."</strong></li>
            <li>Guardala con el nombre que aparece en <strong>amarillo</strong> (el código del producto)</li>
            <li>Subí todas las imágenes a tu carpeta <strong>images</strong> en GitHub</li>
            <li>En el Admin, usá el botón <strong>"Por Código"</strong> para asignarlas</li>
        </ol>
        <p><strong>Total de imágenes:</strong> ${productsWithImages.length}</p>
    </div>
    
    <div class="products">`;
    
    productsWithImages.forEach(p => {
        const newName = (p.code || 'PROD-' + p.id) + '.jpg';
        html += `
        <div class="product">
            <img src="${p.image}" alt="${p.name}" onerror="this.src='https://placehold.co/80x80/ccc/666?text=Error'">
            <div class="product-info">
                <div class="product-code">${p.code || 'Sin código'}</div>
                <div class="product-name">${p.name}</div>
                <div class="new-name">📁 Guardar como: <strong>${newName}</strong></div>
            </div>
            <a href="${p.image}" download="${newName}" class="download-btn" target="_blank">
                ⬇️ Descargar
            </a>
        </div>`;
    });
    
    html += `
    </div>
    
    <script>
        // Intentar descargar automáticamente al hacer clic
        document.querySelectorAll('.download-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // El navegador intentará descargar
            });
        });
    </script>
</body>
</html>`;
    
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'imagenes_productos.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showToast('success', 'Descargado', 'Abrí el archivo HTML para ver y descargar las imágenes');
}

// Migrar imágenes a dominio local
function migrateImagesToLocal() {
    const baseUrl = prompt(
        'URL base de tu carpeta de imágenes:\n\n' +
        'Ejemplo: https://ferreteria.bruzzone.online/images/',
        'https://ferreteria.bruzzone.online/images/'
    );
    
    if(!baseUrl) return;
    
    const extension = prompt('Extensión de las imágenes que subiste:', 'jpg');
    if(!extension) return;
    
    let migrated = 0;
    appData.products.forEach(p => {
        if(p.code) {
            const newUrl = `${baseUrl}${p.code}.${extension}`;
            p.image = newUrl;
            p.images = [newUrl];
            migrated++;
        }
    });
    
    saveData();
    renderAll();
    
    showToast('success', 'Migrado', `${migrated} productos actualizados con imágenes locales`);
}

function editProduct(id) { showProductModal(id); }

function showCategoryModal(id = null) {
    document.getElementById('categoryModalTitle').textContent = id ? 'Editar Categoría' : 'Nueva Categoría';
    document.getElementById('categoryId').value = id || '';
    if(id) {
        const c = appData.categories.find(x=>x.id===id);
        document.getElementById('categoryName').value = c.name;
        document.getElementById('categoryIcon').value = c.icon;
        document.getElementById('categoryActive').checked = c.active;
    } else {
        document.getElementById('categoryForm').reset();
        document.getElementById('categoryActive').checked = true;
    }
    showModal('categoryModal');
}

function saveCategory() {
    const id = document.getElementById('categoryId').value;
    const data = {
        name: document.getElementById('categoryName').value,
        icon: document.getElementById('categoryIcon').value || 'fa-folder',
        active: document.getElementById('categoryActive').checked,
        productCount: 0
    };
    if(!data.name) { showToast('error','Error','Ingresá el nombre'); return; }
    if(id) {
        const idx = appData.categories.findIndex(x=>x.id===parseInt(id));
        if(idx>=0) { data.productCount = appData.categories[idx].productCount; appData.categories[idx] = {...appData.categories[idx], ...data}; }
    } else {
        data.id = Date.now();
        appData.categories.push(data);
    }
    saveData(); renderAll(); closeModal('categoryModal');
    showToast('success','Guardado',id?'Categoría actualizada':'Categoría creada');
}

function editCategory(id) { showCategoryModal(id); }
function deleteCategory(id) {
    if(confirm('¿Eliminar esta categoría?')) {
        appData.categories = appData.categories.filter(c=>c.id!==id);
        
        // Eliminar de Firebase si está habilitado
        if(firebaseEnabled && db) {
            try {
                db.collection('categories').doc(String(id)).delete();
            } catch(e) {
                console.log('Error eliminando de Firebase:', e);
            }
        }
        
        saveData(); renderAll(); showToast('success','Eliminado','Categoría eliminada');
    }
}

function deleteProduct(id) {
    if(confirm('¿Eliminar este producto?')) {
        appData.products = appData.products.filter(p=>p.id!==id);
        
        // Eliminar de Firebase si está habilitado
        if(firebaseEnabled && db) {
            try {
                db.collection('products').doc(String(id)).delete();
            } catch(e) {
                console.log('Error eliminando de Firebase:', e);
            }
        }
        
        saveData(); renderAll(); showToast('success','Eliminado','Producto eliminado');
    }
}

function showCouponModal(id = null) {
    document.getElementById('couponModalTitle').textContent = id ? 'Editar Cupón' : 'Nuevo Cupón';
    document.getElementById('couponId').value = id || '';
    if(id) {
        const c = appData.coupons.find(x=>x.id===id);
        document.getElementById('couponCode').value = c.code;
        document.getElementById('couponType').value = c.type;
        document.getElementById('couponValue').value = c.value;
        document.getElementById('couponMinPurchase').value = c.minPurchase||0;
        document.getElementById('couponMaxUses').value = c.maxUses||'';
        document.getElementById('couponExpiry').value = c.expiry||'';
        document.getElementById('couponActive').checked = c.active;
    } else {
        document.getElementById('couponForm').reset();
        document.getElementById('couponActive').checked = true;
    }
    showModal('couponModal');
}

function saveCoupon() {
    const id = document.getElementById('couponId').value;
    const data = {
        code: document.getElementById('couponCode').value.toUpperCase(),
        type: document.getElementById('couponType').value,
        value: parseFloat(document.getElementById('couponValue').value),
        minPurchase: parseFloat(document.getElementById('couponMinPurchase').value)||0,
        maxUses: document.getElementById('couponMaxUses').value ? parseInt(document.getElementById('couponMaxUses').value) : null,
        expiry: document.getElementById('couponExpiry').value||null,
        active: document.getElementById('couponActive').checked,
        uses: 0
    };
    if(!data.code||!data.value) { showToast('error','Error','Completá código y valor'); return; }
    if(id) {
        const idx = appData.coupons.findIndex(x=>x.id===parseInt(id));
        if(idx>=0) { data.uses = appData.coupons[idx].uses; appData.coupons[idx] = {...appData.coupons[idx], ...data}; }
    } else {
        data.id = Date.now();
        appData.coupons.push(data);
    }
    saveData(); renderAll(); closeModal('couponModal');
    showToast('success','Guardado',id?'Cupón actualizado':'Cupón creado');
}

function editCoupon(id) { showCouponModal(id); }
function deleteCoupon(id) {
    if(confirm('¿Eliminar este cupón?')) {
        appData.coupons = appData.coupons.filter(c=>c.id!==id);
        saveData(); renderAll(); showToast('success','Eliminado','Cupón eliminado');
    }
}

// ==================== BANNERS ====================
let currentBannerImage = '';

function showBannerModal(id = null) {
    document.getElementById('bannerModalTitle').textContent = id ? 'Editar Banner' : 'Nuevo Banner';
    document.getElementById('bannerForm').reset();
    document.getElementById('bannerId').value = '';
    currentBannerImage = '';
    document.getElementById('bannerImagePreview').innerHTML = '<i class="fas fa-image"></i><span>Sin imagen</span>';
    
    if(id) {
        const b = appData.banners.find(x => x.id === id);
        if(b) {
            document.getElementById('bannerId').value = b.id;
            document.getElementById('bannerTitle').value = b.title || '';
            document.getElementById('bannerSubtitle').value = b.subtitle || '';
            document.getElementById('bannerDescription').value = b.description || '';
            document.getElementById('bannerOldPrice').value = b.oldPrice || '';
            document.getElementById('bannerNewPrice').value = b.newPrice || '';
            document.getElementById('bannerBtnText').value = b.btnText || '¡Lo Quiero!';
            document.getElementById('bannerBtnAction').value = b.btnAction || 'products';
            document.getElementById('bannerOrder').value = b.order || 1;
            document.getElementById('bannerActive').checked = b.active !== false;
            if(b.image) {
                currentBannerImage = b.image;
                document.getElementById('bannerImagePreview').innerHTML = `<img src="${b.image}" alt="Preview">`;
            }
        }
    }
    showModal('bannerModal');
}

function handleBannerImage(input) {
    if(input.files && input.files[0]) {
        const file = input.files[0];
        if(file.size > 500000) {
            showToast('warning', 'Imagen grande', 'La imagen supera 500KB, puede tardar en cargar');
        }
        const reader = new FileReader();
        reader.onload = function(e) {
            currentBannerImage = e.target.result;
            document.getElementById('bannerImagePreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
        };
        reader.readAsDataURL(file);
    }
}

function handleBannerImageUrl(url) {
    if(url) {
        currentBannerImage = url;
        document.getElementById('bannerImagePreview').innerHTML = `<img src="${url}" alt="Preview" onerror="this.parentElement.innerHTML='<i class=\\'fas fa-exclamation-triangle\\'></i><span>Error al cargar</span>'">`;
    }
}

function saveBanner() {
    const id = document.getElementById('bannerId').value;
    const banner = {
        id: id ? parseInt(id) : Date.now(),
        title: document.getElementById('bannerTitle').value,
        subtitle: document.getElementById('bannerSubtitle').value,
        description: document.getElementById('bannerDescription').value,
        oldPrice: parseFloat(document.getElementById('bannerOldPrice').value) || 0,
        newPrice: parseFloat(document.getElementById('bannerNewPrice').value) || 0,
        btnText: document.getElementById('bannerBtnText').value || '¡Lo Quiero!',
        btnAction: document.getElementById('bannerBtnAction').value,
        image: currentBannerImage,
        order: parseInt(document.getElementById('bannerOrder').value) || 1,
        active: document.getElementById('bannerActive').checked
    };
    
    if(!banner.title) {
        showToast('error', 'Error', 'El título es requerido');
        return;
    }
    
    if(id) {
        const idx = appData.banners.findIndex(b => b.id === parseInt(id));
        if(idx >= 0) appData.banners[idx] = banner;
    } else {
        appData.banners.push(banner);
    }
    
    saveData(); 
    renderAll();
    renderSlider();
    closeModal('bannerModal');
    showToast('success', 'Guardado', id ? 'Banner actualizado' : 'Banner creado');
}

function editBanner(id) { showBannerModal(id); }

function deleteBanner(id) {
    if(confirm('¿Eliminar este banner?')) {
        appData.banners = appData.banners.filter(b => b.id !== id);
        saveData(); 
        renderAll();
        renderSlider();
        showToast('success', 'Eliminado', 'Banner eliminado');
    }
}

function toggleBanner(id) {
    const banner = appData.banners.find(b => b.id === id);
    if(banner) {
        banner.active = !banner.active;
        saveData();
        renderAll();
        renderSlider();
    }
}

function renderBannersAdmin() {
    const grid = document.getElementById('bannersGrid');
    if(!grid) return;
    
    const banners = appData.banners.sort((a, b) => a.order - b.order);
    
    if(banners.length === 0) {
        grid.innerHTML = '<div class="empty-state"><i class="fas fa-images" style="font-size:48px;color:var(--text-light);margin-bottom:15px;"></i><p>No hay banners creados</p><button class="btn btn-primary" onclick="showBannerModal()"><i class="fas fa-plus"></i> Crear primer banner</button></div>';
        return;
    }
    
    grid.innerHTML = banners.map((b, idx) => `
        <div class="banner-card">
            <div class="banner-preview">
                ${b.image ? `<img src="${b.image}" alt="${b.title}">` : '<i class="fas fa-image"></i>'}
                <span class="banner-order">${b.order}</span>
                <span class="banner-status ${b.active ? 'active' : 'inactive'}">${b.active ? 'Activo' : 'Inactivo'}</span>
            </div>
            <div class="banner-info">
                <div class="banner-title">${b.title}</div>
                <div class="banner-subtitle">${b.subtitle || 'Sin subtítulo'}</div>
                ${b.newPrice ? `<div style="color:var(--primary);font-weight:600;">$${formatNumber(b.newPrice)}</div>` : ''}
                <div class="banner-actions">
                    <button class="btn btn-outline" onclick="editBanner(${b.id})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-outline" onclick="toggleBanner(${b.id})"><i class="fas ${b.active ? 'fa-eye-slash' : 'fa-eye'}"></i></button>
                    <button class="btn btn-danger" onclick="deleteBanner(${b.id})"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderSlider() {
    const slidesContainer = document.getElementById('promoSlides');
    const dotsContainer = document.getElementById('promoDots');
    if(!slidesContainer) return;
    
    const activeBanners = (appData.banners || []).filter(b => b.active).sort((a, b) => a.order - b.order);
    
    // Si no hay banners personalizados, mostrar los predeterminados
    if(activeBanners.length === 0) {
        slidesContainer.innerHTML = `
            <div class="promo-slide">
                <div class="promo-content container">
                    <div class="promo-text">
                        <span class="promo-badge">Oferta Especial</span>
                        <h2 class="promo-title">Bienvenido a Ferretería Bruzzone</h2>
                        <p class="promo-description">Encontrá las mejores herramientas y materiales para tu hogar y obra.</p>
                        <div class="promo-price"><span class="promo-price-new">¡Los mejores precios!</span></div>
                        <button class="promo-btn" onclick="scrollToProducts()">Ver Productos</button>
                    </div>
                    <div class="promo-image"><i class="fas fa-tools"></i></div>
                </div>
            </div>
        `;
        if(dotsContainer) dotsContainer.innerHTML = '<span class="promo-dot active"></span>';
        return;
    }
    
    // Renderizar banners activos
    slidesContainer.innerHTML = activeBanners.map((b, idx) => `
        <div class="promo-slide">
            <div class="promo-content container">
                <div class="promo-text">
                    ${b.subtitle ? `<span class="promo-badge">${b.subtitle}</span>` : ''}
                    <h2 class="promo-title">${b.title}</h2>
                    ${b.description ? `<p class="promo-description">${b.description}</p>` : ''}
                    <div class="promo-price">
                        ${b.oldPrice ? `<span class="promo-price-old">$${formatNumber(b.oldPrice)}</span>` : ''}
                        ${b.newPrice ? `<span class="promo-price-new">$${formatNumber(b.newPrice)}</span>` : ''}
                    </div>
                    <button class="promo-btn" onclick="${getBannerAction(b.btnAction)}">${b.btnText || '¡Lo Quiero!'}</button>
                </div>
                <div class="promo-image">
                    ${b.image ? `<img src="${b.image}" alt="${b.title}">` : '<i class="fas fa-image"></i>'}
                </div>
            </div>
        </div>
    `).join('');
    
    // Actualizar dots
    if(dotsContainer) {
        dotsContainer.innerHTML = activeBanners.map((b, idx) => 
            `<span class="promo-dot ${idx === 0 ? 'active' : ''}" onclick="goToSlide(${idx})"></span>`
        ).join('');
    }
    
    currentSlide = 0;
    updateSlider();
}

function getBannerAction(action) {
    switch(action) {
        case 'whatsapp': return 'openWhatsApp()';
        case 'category': return 'scrollToProducts()';
        default: return 'scrollToProducts()';
    }
}

function showImportModal() {
    document.getElementById('importPreview').style.display = 'none';
    document.getElementById('importBtn').disabled = true;
    document.getElementById('importFile').value = '';
    window.pendingImport = null;
    showModal('importModal');
}

let pendingImport = null;

function handleImportFile(input) {
    if(input.files.length === 0) return;
    
    const file = input.files[0];
    const fileName = file.name.toLowerCase();
    document.getElementById('importFileName').textContent = file.name;
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        try {
            let data;
            
            if(fileName.endsWith('.json')) {
                // Importar JSON
                data = JSON.parse(e.target.result);
                if(data.products) {
                    pendingImport = data;
                } else if(Array.isArray(data)) {
                    pendingImport = { products: data, categories: [] };
                }
            } else if(fileName.endsWith('.csv')) {
                // Importar CSV de Tienda Nube
                data = parseCSVTiendaNube(e.target.result);
                pendingImport = data;
            }
            
            if(pendingImport && pendingImport.products) {
                document.getElementById('importCount').textContent = pendingImport.products.length;
                document.getElementById('importCategories').textContent = pendingImport.categories ? pendingImport.categories.length : 'N/A';
                document.getElementById('importPreview').style.display = 'block';
                document.getElementById('importBtn').disabled = false;
            } else {
                showToast('error', 'Error', 'Formato de archivo no válido');
            }
        } catch(err) {
            console.error('Error parsing file:', err);
            showToast('error', 'Error', 'No se pudo leer el archivo: ' + err.message);
        }
    };
    
    reader.readAsText(file, 'ISO-8859-1'); // Encoding común en Tienda Nube
}

function parseCSVTiendaNube(csvText) {
    const lines = csvText.split('\n');
    if(lines.length < 2) return { products: [], categories: [] };
    
    // Detectar delimitador (punto y coma o coma)
    const delimiter = lines[0].includes(';') ? ';' : ',';
    
    // Parsear header
    const headers = parseCSVLine(lines[0], delimiter);
    
    const products = [];
    const categoriesSet = new Set();
    const seenNames = new Set();
    
    for(let i = 1; i < lines.length; i++) {
        if(!lines[i].trim()) continue;
        
        const values = parseCSVLine(lines[i], delimiter);
        const row = {};
        headers.forEach((h, idx) => {
            row[h.trim().replace(/"/g, '')] = (values[idx] || '').replace(/^"|"$/g, '');
        });
        
        const nombre = row['Nombre'] || row['nombre'] || '';
        if(!nombre || seenNames.has(nombre)) continue;
        seenNames.add(nombre);
        
        // Parsear precio
        let precio = row['Precio promocional'] || row['Precio'] || '0';
        precio = parseFloat(precio.replace(/[,.]/g, m => m === ',' ? '' : '.')) || 0;
        
        let precioOriginal = row['Precio'] || '0';
        precioOriginal = parseFloat(precioOriginal.replace(/[,.]/g, m => m === ',' ? '' : '.')) || 0;
        
        // Categoría
        const categorias = row['Categorías'] || row['Categoria'] || 'General';
        const categoria = categorias.split(',')[0].trim();
        categoriesSet.add(categoria);
        
        // Stock
        const stock = parseInt(row['Stock']) || 10;
        
        // SKU
        const sku = row['SKU'] || row['Código'] || `PROD-${String(products.length + 1).padStart(4, '0')}`;
        
        // Descripción (limpiar HTML)
        let descripcion = row['Descripción'] || row['Descripcion'] || '';
        descripcion = descripcion.replace(/<[^>]+>/g, ' ').replace(/&[^;]+;/g, ' ').replace(/\s+/g, ' ').trim().slice(0, 500);
        
        // Activo
        const activo = (row['Mostrar en tienda'] || 'SI').toUpperCase() === 'SI';
        
        // Marca
        const marca = row['Marca'] || '';
        
        products.push({
            id: products.length + 1,
            code: sku,
            name: nombre,
            category: categoria,
            price: precio || precioOriginal,
            originalPrice: (row['Precio promocional'] && precioOriginal > precio) ? precioOriginal : 0,
            stock: stock,
            minStock: 5,
            description: descripcion || nombre + ' - Producto de calidad',
            brand: marca,
            active: activo,
            featured: products.length < 20,
            image: ''
        });
    }
    
    // Crear categorías
    const categoryIcons = {
        'hogar': 'fa-home', 'herramienta': 'fa-hammer', 'electric': 'fa-bolt',
        'pintura': 'fa-paint-roller', 'plomer': 'fa-faucet', 'jardin': 'fa-leaf',
        'ferret': 'fa-tools', 'construc': 'fa-hard-hat', 'iluminac': 'fa-lightbulb',
        'luz': 'fa-lightbulb', 'seguridad': 'fa-lock', 'auto': 'fa-car',
        'limpieza': 'fa-broom', 'bateria': 'fa-battery-full', 'temporada': 'fa-calendar'
    };
    
    const categories = Array.from(categoriesSet).map((name, idx) => {
        let icon = 'fa-box';
        for(const [key, val] of Object.entries(categoryIcons)) {
            if(name.toLowerCase().includes(key)) { icon = val; break; }
        }
        return {
            id: idx + 1,
            name: name,
            icon: icon,
            active: true,
            productCount: products.filter(p => p.category === name).length
        };
    });
    
    return { products, categories };
}

function parseCSVLine(line, delimiter) {
    const result = [];
    let current = '';
    let inQuotes = false;
    
    for(let i = 0; i < line.length; i++) {
        const char = line[i];
        if(char === '"') {
            inQuotes = !inQuotes;
        } else if(char === delimiter && !inQuotes) {
            result.push(current);
            current = '';
        } else {
            current += char;
        }
    }
    result.push(current);
    return result;
}

function processImport() {
    if(!pendingImport || !pendingImport.products || pendingImport.products.length === 0) {
        showToast('error', 'Error', 'No hay productos para importar');
        return;
    }
    
    const confirmMsg = `¿Importar ${pendingImport.products.length} productos?\n\nEsto REEMPLAZARÁ todos los productos actuales.`;
    if(!confirm(confirmMsg)) return;
    
    // Reasignar IDs
    const maxId = Math.max(0, ...appData.products.map(p => p.id));
    pendingImport.products.forEach((p, i) => {
        p.id = maxId + i + 1;
    });
    
    // Reemplazar productos
    appData.products = pendingImport.products;
    
    // Importar categorías si existen
    if(pendingImport.categories && pendingImport.categories.length > 0) {
        const maxCatId = Math.max(0, ...appData.categories.map(c => c.id));
        pendingImport.categories.forEach((c, i) => {
            c.id = maxCatId + i + 1;
        });
        appData.categories = pendingImport.categories;
    }
    
    saveData();
    renderAll();
    closeModal('importModal');
    
    showToast('success', '¡Importado!', `${pendingImport.products.length} productos importados correctamente`);
    pendingImport = null;
}

// ==================== CUSTOMER AUTHENTICATION ====================
let currentCustomer = null; // Cliente logueado actualmente

function loadCurrentCustomer() {
    const saved = localStorage.getItem('ferrecloud_current_customer');
    if(saved) {
        currentCustomer = JSON.parse(saved);
        updateCustomerUI();
    }
}

function updateCustomerUI() {
    const btn = document.querySelector('.header-btn[onclick="showAuthModal()"]');
    if(btn) {
        if(currentCustomer) {
            btn.innerHTML = `<i class="fas fa-user-check"></i> <span>${currentCustomer.name.split(' ')[0]}</span>`;
            btn.onclick = () => showCustomerAccount();
        } else {
            btn.innerHTML = `<i class="fas fa-user"></i> <span>Mi Cuenta</span>`;
            btn.onclick = () => showAuthModal();
        }
    }
}

function showAuthModal() { 
    showLoginForm();
    showModal('authModal'); 
}

function showLoginForm() {
    document.getElementById('authModalTitle').textContent = 'Iniciar Sesión';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('registerForm').style.display = 'none';
}

function showRegisterForm() {
    document.getElementById('authModalTitle').textContent = 'Crear Cuenta';
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('registerForm').style.display = 'block';
}

function handleLogin() {
    const email = document.getElementById('loginEmail').value.trim().toLowerCase();
    const password = document.getElementById('loginPassword').value;
    
    if(!email) { 
        showToast('error', 'Error', 'Ingresá tu email'); 
        return; 
    }
    if(!password) { 
        showToast('error', 'Error', 'Ingresá tu contraseña'); 
        return; 
    }
    
    // Buscar cliente registrado
    const customer = appData.customers.find(c => c.email && c.email.toLowerCase() === email);
    
    if(!customer) {
        showToast('error', 'Error', 'Email no registrado. ¿Querés crear una cuenta?');
        return;
    }
    
    if(customer.password !== password) {
        showToast('error', 'Error', 'Contraseña incorrecta');
        return;
    }
    
    // Login exitoso
    currentCustomer = {
        id: customer.id,
        name: customer.name,
        email: customer.email,
        phone: customer.phone,
        address: customer.address
    };
    
    localStorage.setItem('ferrecloud_current_customer', JSON.stringify(currentCustomer));
    updateCustomerUI();
    closeModal('authModal');
    
    // Limpiar formulario
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
    
    showToast('success', '¡Bienvenido!', `Hola ${currentCustomer.name.split(' ')[0]}`);
}

function handleRegister() {
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim().toLowerCase();
    const phone = document.getElementById('registerPhone').value.trim();
    const address = document.getElementById('registerAddress').value.trim();
    const password = document.getElementById('registerPassword').value;
    const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
    
    // Validaciones
    if(!name) { 
        showToast('error', 'Error', 'Ingresá tu nombre'); 
        return; 
    }
    if(!email) { 
        showToast('error', 'Error', 'Ingresá tu email'); 
        return; 
    }
    if(!email.includes('@')) { 
        showToast('error', 'Error', 'Email inválido'); 
        return; 
    }
    if(!phone) { 
        showToast('error', 'Error', 'Ingresá tu teléfono'); 
        return; 
    }
    if(!password || password.length < 6) { 
        showToast('error', 'Error', 'La contraseña debe tener al menos 6 caracteres'); 
        return; 
    }
    if(password !== passwordConfirm) { 
        showToast('error', 'Error', 'Las contraseñas no coinciden'); 
        return; 
    }
    
    // Verificar si ya existe
    const exists = appData.customers.find(c => c.email && c.email.toLowerCase() === email);
    if(exists) {
        showToast('error', 'Error', 'Este email ya está registrado. Iniciá sesión.');
        showLoginForm();
        return;
    }
    
    // Crear nuevo cliente
    const newCustomer = {
        id: Date.now(),
        name: name,
        email: email,
        phone: phone,
        address: address,
        password: password,
        orders: 0,
        totalSpent: 0,
        registeredAt: new Date().toISOString(),
        active: true
    };
    
    appData.customers.push(newCustomer);
    saveData();
    
    // Auto-login
    currentCustomer = {
        id: newCustomer.id,
        name: newCustomer.name,
        email: newCustomer.email,
        phone: newCustomer.phone,
        address: newCustomer.address
    };
    
    localStorage.setItem('ferrecloud_current_customer', JSON.stringify(currentCustomer));
    updateCustomerUI();
    closeModal('authModal');
    
    // Limpiar formulario manualmente
    document.getElementById('registerName').value = '';
    document.getElementById('registerEmail').value = '';
    document.getElementById('registerPhone').value = '';
    document.getElementById('registerAddress').value = '';
    document.getElementById('registerPassword').value = '';
    document.getElementById('registerPasswordConfirm').value = '';
    
    showToast('success', '¡Cuenta Creada!', `Bienvenido ${name.split(' ')[0]}`);
}

function showCustomerAccount() {
    if(!currentCustomer) {
        showAuthModal();
        return;
    }
    
    // Cargar datos en el formulario
    document.getElementById('customerAccountName').textContent = currentCustomer.name;
    document.getElementById('customerAccountEmail').textContent = currentCustomer.email;
    document.getElementById('customerName').value = currentCustomer.name;
    document.getElementById('customerPhone').value = currentCustomer.phone || '';
    document.getElementById('customerEmail').value = currentCustomer.email;
    document.getElementById('customerAddress').value = currentCustomer.address || '';
    
    showCustomerTab('profile');
    showModal('customerAccountModal');
}

function showCustomerTab(tab) {
    const profileTab = document.getElementById('customerProfileTab');
    const ordersTab = document.getElementById('customerOrdersTab');
    const btnProfile = document.getElementById('tabProfile');
    const btnOrders = document.getElementById('tabOrders');
    
    if(tab === 'profile') {
        profileTab.style.display = 'block';
        ordersTab.style.display = 'none';
        btnProfile.style.background = 'var(--primary)';
        btnProfile.style.color = 'white';
        btnOrders.style.background = 'var(--bg-main)';
        btnOrders.style.color = 'var(--text-secondary)';
    } else {
        profileTab.style.display = 'none';
        ordersTab.style.display = 'block';
        btnOrders.style.background = 'var(--primary)';
        btnOrders.style.color = 'white';
        btnProfile.style.background = 'var(--bg-main)';
        btnProfile.style.color = 'var(--text-secondary)';
        loadCustomerOrders();
    }
}

function loadCustomerOrders() {
    if(!currentCustomer) return;
    
    const customerOrders = appData.orders.filter(o => 
        o.email && o.email.toLowerCase() === currentCustomer.email.toLowerCase()
    );
    
    const container = document.getElementById('customerOrdersList');
    
    if(customerOrders.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--text-light);">
                <i class="fas fa-shopping-bag" style="font-size: 50px; margin-bottom: 15px; display: block;"></i>
                <p>Todavía no tenés pedidos</p>
                <button class="btn btn-primary" onclick="closeModal('customerAccountModal')" style="margin-top: 15px;">
                    <i class="fas fa-shopping-cart"></i> Empezar a comprar
                </button>
            </div>
        `;
        return;
    }
    
    container.innerHTML = customerOrders.sort((a,b) => b.id - a.id).map(o => {
        const statusColors = {
            'Pendiente': '#F59E0B',
            'En Proceso': '#F97316',
            'Enviado': '#3B82F6',
            'Entregado': '#10B981',
            'Cancelado': '#EF4444'
        };
        const statusColor = statusColors[o.status] || '#6B7280';
        
        return `
            <div style="background: var(--bg-main); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong style="color: var(--primary);">Pedido #${o.id}</strong>
                    <span style="background: ${statusColor}20; color: ${statusColor}; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">${o.status}</span>
                </div>
                <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">
                    <i class="fas fa-calendar"></i> ${o.date || 'Sin fecha'}
                </div>
                <div style="font-size: 13px; margin-bottom: 10px;">
                    ${o.items ? o.items.map(i => `${i.qty}x ${i.name}`).join(', ') : 'Sin productos'}
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <strong style="font-size: 18px;">$${formatNumber(o.total)}</strong>
                    ${o.status === 'Enviado' ? `<span style="color: var(--success); font-size: 12px;"><i class="fas fa-truck"></i> En camino</span>` : ''}
                </div>
            </div>
        `;
    }).join('');
}

function saveCustomerProfile() {
    if(!currentCustomer) return;
    
    const name = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    const address = document.getElementById('customerAddress').value.trim();
    
    if(!name) {
        showToast('error', 'Error', 'El nombre es obligatorio');
        return;
    }
    
    // Actualizar en appData.customers
    const idx = appData.customers.findIndex(c => c.id === currentCustomer.id);
    if(idx >= 0) {
        appData.customers[idx].name = name;
        appData.customers[idx].phone = phone;
        appData.customers[idx].address = address;
    }
    
    // Actualizar sesión actual
    currentCustomer.name = name;
    currentCustomer.phone = phone;
    currentCustomer.address = address;
    
    localStorage.setItem('ferrecloud_current_customer', JSON.stringify(currentCustomer));
    saveData();
    updateCustomerUI();
    
    // Actualizar header del modal
    document.getElementById('customerAccountName').textContent = name;
    
    showToast('success', 'Guardado', 'Perfil actualizado');
}

function customerLogout() {
    currentCustomer = null;
    localStorage.removeItem('ferrecloud_current_customer');
    updateCustomerUI();
    closeModal('customerAccountModal');
    showToast('info', 'Sesión cerrada', 'Hasta pronto');
}

// Cargar cliente al iniciar
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(loadCurrentCustomer, 500);
});

function exportProducts(format) {
    if(appData.products.length === 0) {
        showToast('error', 'Error', 'No hay productos para exportar');
        return;
    }
    
    let content, filename, type;
    
    if(format === 'json') {
        const exportData = {
            products: appData.products,
            categories: appData.categories,
            exportDate: new Date().toISOString(),
            totalProducts: appData.products.length
        };
        content = JSON.stringify(exportData, null, 2);
        filename = `productos_ferrecloud_${getDateString()}.json`;
        type = 'application/json';
    } else {
        const headers = ['Código', 'Nombre', 'Categoría', 'Precio', 'Precio Original', 'Stock', 'Stock Mínimo', 'Marca', 'Descripción', 'Activo', 'Destacado'];
        const rows = appData.products.map(p => [
            p.code || '',
            `"${(p.name || '').replace(/"/g, '""')}"`,
            `"${(p.category || '').replace(/"/g, '""')}"`,
            p.price || 0,
            p.originalPrice || 0,
            p.stock || 0,
            p.minStock || 5,
            `"${(p.brand || '').replace(/"/g, '""')}"`,
            `"${(p.description || '').replace(/"/g, '""').slice(0, 200)}"`,
            p.active ? 'SI' : 'NO',
            p.featured ? 'SI' : 'NO'
        ]);
        
        content = '\uFEFF' + headers.join(';') + '\n' + rows.map(r => r.join(';')).join('\n');
        filename = `productos_ferrecloud_${getDateString()}.csv`;
        type = 'text/csv;charset=utf-8';
    }
    
    const blob = new Blob([content], { type: type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showToast('success', 'Exportado', `${appData.products.length} productos exportados`);
}

function getDateString() {
    const d = new Date();
    return `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
}

function quickView(id) {
    const p = appData.products.find(x=>x.id===id);
    if(!p) return;
    
    const images = p.images && p.images.length > 0 ? p.images : (p.image ? [p.image] : []);
    const price = p.salePrice 
        ? `<span style="text-decoration:line-through;color:#999;">$${formatNumber(p.price)}</span> <span style="color:var(--primary);font-size:24px;font-weight:700;">$${formatNumber(p.salePrice)}</span>`
        : `<span style="color:var(--primary);font-size:24px;font-weight:700;">$${formatNumber(p.price)}</span>`;
    
    const modal = document.createElement('div');
    modal.id = 'quickViewModal';
    modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:10000;padding:20px;';
    
    modal.innerHTML = `
        <div style="background:white;border-radius:15px;max-width:800px;width:100%;max-height:90vh;overflow:auto;">
            <div style="display:flex;flex-wrap:wrap;">
                <div style="flex:1;min-width:280px;padding:20px;background:#f8f8f8;">
                    <img id="qvMainImage" src="${images[0] || ''}" alt="${p.name}" style="width:100%;height:300px;object-fit:contain;border-radius:10px;background:white;" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f0f0f0%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2250%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2210%22>Sin imagen</text></svg>'">
                    ${images.length > 1 ? `
                        <div style="display:flex;gap:8px;margin-top:10px;overflow-x:auto;padding:5px 0;">
                            ${images.map((img, idx) => `
                                <img src="${img}" onclick="document.getElementById('qvMainImage').src='${img}'" 
                                    style="width:50px;height:50px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;flex-shrink:0;"
                                    onmouseover="this.style.borderColor='var(--primary)'" onmouseout="this.style.borderColor='transparent'">
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                <div style="flex:1;min-width:280px;padding:25px;">
                    <button onclick="document.getElementById('quickViewModal').remove()" style="float:right;background:none;border:none;font-size:24px;cursor:pointer;color:#999;">×</button>
                    <span style="color:var(--primary);font-size:12px;text-transform:uppercase;font-weight:600;">${p.category}</span>
                    <h2 style="margin:10px 0;font-size:22px;">${p.name}</h2>
                    ${p.brand ? `<p style="color:#666;margin-bottom:15px;">Marca: <strong>${p.brand}</strong></p>` : ''}
                    <div style="margin:20px 0;">${price}</div>
                    <p style="color:#666;font-size:14px;line-height:1.6;margin-bottom:20px;">${p.description || 'Sin descripción disponible.'}</p>
                    <p style="color:${p.stock > 0 ? '#10B981' : '#EF4444'};font-weight:600;margin-bottom:20px;">
                        <i class="fas ${p.stock > 0 ? 'fa-check-circle' : 'fa-times-circle'}"></i> 
                        ${p.stock > 0 ? `${p.stock} unidades disponibles` : 'Sin stock'}
                    </p>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <button onclick="addToCart(${p.id});document.getElementById('quickViewModal').remove();" style="flex:1;padding:12px 20px;background:var(--primary);color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;"><i class="fas fa-cart-plus"></i> Agregar</button>
                        <button onclick="openWhatsApp('${p.name.replace(/'/g, "\\'")}');document.getElementById('quickViewModal').remove();" style="padding:12px 20px;background:#25D366;color:white;border:none;border-radius:8px;cursor:pointer;"><i class="fab fa-whatsapp"></i></button>
                        <button onclick="shareProduct(${p.id});" style="padding:12px 20px;background:#6366F1;color:white;border:none;border-radius:8px;cursor:pointer;"><i class="fas fa-share-alt"></i></button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.addEventListener('click', (e) => {
        if(e.target === modal) modal.remove();
    });
}

// ==================== SETTINGS ====================
function saveCompanyData(e) {
    e.preventDefault();
    appData.company = {
        name: document.getElementById('companyName').value,
        cuit: document.getElementById('companyCuit').value,
        address: document.getElementById('companyAddress').value,
        phone: document.getElementById('companyPhone').value,
        whatsapp: document.getElementById('companyWhatsapp').value,
        email: document.getElementById('companyEmail').value,
        instagram: document.getElementById('companyInstagram').value,
        facebook: document.getElementById('companyFacebook').value,
        description: document.getElementById('companyDescription').value,
        hours: document.getElementById('companyHours').value,
        freeShipping: parseInt(document.getElementById('companyFreeShipping').value) || 50000
    };
    saveData(); 
    loadCompanyData(); // Actualizar links de redes sociales
    showToast('success','Guardado','Datos actualizados');
}

function loadCompanyData() {
    const c = appData.company || {};
    
    // Formulario admin
    document.getElementById('companyName').value = c.name || 'FerreCloud';
    document.getElementById('companyCuit').value = c.cuit || '';
    document.getElementById('companyAddress').value = c.address || '';
    document.getElementById('companyPhone').value = c.phone || '';
    document.getElementById('companyWhatsapp').value = c.whatsapp || '';
    document.getElementById('companyEmail').value = c.email || '';
    document.getElementById('companyInstagram').value = c.instagram || '';
    document.getElementById('companyFacebook').value = c.facebook || '';
    document.getElementById('companyDescription').value = c.description || '';
    document.getElementById('companyHours').value = c.hours || '';
    document.getElementById('companyFreeShipping').value = c.freeShipping || 50000;
    
    // Actualizar Header
    const phone = c.phone || '(358) 412-3456';
    const email = c.email || 'ventas@ferrecloud.com';
    const freeShipping = c.freeShipping || 50000;
    
    document.getElementById('headerPhoneText').textContent = phone;
    document.getElementById('headerPhone').href = 'tel:' + phone.replace(/[^0-9+]/g, '');
    document.getElementById('headerEmailText').textContent = email;
    document.getElementById('headerEmail').href = 'mailto:' + email;
    document.getElementById('headerFreeShipping').textContent = freeShipping.toLocaleString('es-AR');
    
    // Actualizar Footer
    document.getElementById('footerAddress').textContent = c.address || 'Dr. Carlos Rocha 128';
    document.getElementById('footerPhone').textContent = phone;
    document.getElementById('footerEmail').textContent = email;
    document.getElementById('footerCompanyName').textContent = c.name || 'FerreCloud';
    
    // Configurar links de redes sociales
    const whatsappNum = (c.whatsapp || c.phone || '').replace(/[^0-9]/g, '');
    const instagram = c.instagram || '';
    const facebook = c.facebook || '';
    
    // WhatsApp
    if(whatsappNum) {
        const waNum = whatsappNum.startsWith('54') ? whatsappNum : '54' + whatsappNum;
        document.getElementById('socialWhatsapp').href = `https://wa.me/${waNum}`;
        document.getElementById('socialWhatsapp').style.display = 'flex';
    } else {
        document.getElementById('socialWhatsapp').style.display = 'none';
    }
    
    // Instagram
    if(instagram) {
        const igUser = instagram.replace('@', '');
        document.getElementById('socialInstagram').href = `https://instagram.com/${igUser}`;
        document.getElementById('socialInstagram').style.display = 'flex';
    } else {
        document.getElementById('socialInstagram').style.display = 'none';
    }
    
    // Facebook
    if(facebook) {
        const fbUser = facebook.replace(/.*facebook.com\//, '').replace('@', '');
        document.getElementById('socialFacebook').href = `https://facebook.com/${fbUser}`;
        document.getElementById('socialFacebook').style.display = 'flex';
    } else {
        document.getElementById('socialFacebook').style.display = 'none';
    }
    
    // Guardar WhatsApp para el botón flotante
    window.companyWhatsapp = c.whatsapp || c.phone || '';
    window.companyName = c.name || 'Ferretería Bruzzone';
}

function openWhatsApp(productName = null) {
    let whatsapp = window.companyWhatsapp || '';
    
    // Limpiar número (solo números y +)
    whatsapp = whatsapp.replace(/[^0-9+]/g, '');
    
    // Si no tiene código de país, agregar Argentina
    if(whatsapp && !whatsapp.startsWith('+')) {
        whatsapp = '+54' + whatsapp;
    }
    
    if(!whatsapp) {
        showToast('error', 'Error', 'No hay número de WhatsApp configurado');
        return;
    }
    
    // Mensaje predeterminado
    let mensaje = `¡Hola! Me contacto desde ${window.companyName || 'la web'}.`;
    if(productName) {
        mensaje = `¡Hola! Estoy interesado en: *${productName}*. ¿Podrían darme más información?`;
    } else {
        mensaje += ' Quisiera hacer una consulta.';
    }
    
    const url = `https://wa.me/${whatsapp.replace('+', '')}?text=${encodeURIComponent(mensaje)}`;
    window.open(url, '_blank');
}

function savePaymentSettings(e) { e.preventDefault(); showToast('success','Guardado','Pagos configurados'); }

function saveWyndesConfig(e) {
    e.preventDefault();
    appData.wyndesConfig = {
        url: document.getElementById('wyndesUrl').value,
        apiKey: document.getElementById('wyndesApiKey').value,
        syncProducts: document.getElementById('syncProducts').checked,
        syncStock: document.getElementById('syncStock').checked,
        syncPrices: document.getElementById('syncPrices').checked,
        syncOrders: document.getElementById('syncOrders').checked,
        frequency: document.getElementById('syncFrequency').value,
        priceMargin: parseFloat(document.getElementById('priceMargin').value)||0,
        lastSync: appData.wyndesConfig.lastSync
    };
    saveData(); showToast('success','Guardado','Configuración Wyndes guardada');
}

function testWyndesConnection() {
    showToast('warning','Probando...','Verificando conexión...');
    setTimeout(()=>{
        if(appData.wyndesConfig.url&&appData.wyndesConfig.apiKey) showToast('success','Conectado','Conexión exitosa');
        else showToast('error','Error','Configurá URL y API Key');
    },2000);
}

function syncWithWyndes() {
    showToast('warning','Sincronizando','Sincronizando con Wyndes...');
    setTimeout(()=>{
        appData.wyndesConfig.lastSync = new Date().toLocaleString('es-AR');
        document.getElementById('lastSync').textContent = appData.wyndesConfig.lastSync;
        saveData(); showToast('success','Completado','Sincronización exitosa');
    },3000);
}

// ==================== FIREBASE CONFIG PANEL ====================
function saveFirebaseConfig(e) {
    e.preventDefault();
    const config = {
        apiKey: document.getElementById('fbApiKey').value,
        projectId: document.getElementById('fbProjectId').value,
        authDomain: document.getElementById('fbAuthDomain').value || document.getElementById('fbProjectId').value + '.firebaseapp.com',
        storageBucket: document.getElementById('fbStorageBucket').value || document.getElementById('fbProjectId').value + '.appspot.com'
    };
    
    if(!config.apiKey || !config.projectId) {
        showToast('error', 'Error', 'API Key y Project ID son requeridos');
        return;
    }
    
    // Guardar en localStorage
    localStorage.setItem('ferrecloud_firebase_config', JSON.stringify(config));
    showToast('success', 'Guardado', 'Configuración guardada. Recargá la página para conectar.');
    
    // Actualizar estado visual
    updateFirebaseStatusPanel(true);
}

function testFirebaseConnection() {
    const apiKey = document.getElementById('fbApiKey').value;
    const projectId = document.getElementById('fbProjectId').value;
    
    if(!apiKey || !projectId) {
        showToast('error', 'Error', 'Completá API Key y Project ID');
        return;
    }
    
    showToast('warning', 'Probando...', 'Verificando conexión...');
    
    // Simular test de conexión
    setTimeout(() => {
        showToast('success', 'Conexión OK', 'Firebase está accesible');
        updateFirebaseStatusPanel(true);
    }, 1500);
}

function updateFirebaseStatusPanel(connected) {
    const icon = document.getElementById('fbStatusIcon');
    const title = document.getElementById('fbStatusTitle');
    const desc = document.getElementById('fbStatusDesc');
    
    if(connected || firebaseEnabled) {
        icon.style.background = '#D1FAE5';
        icon.style.color = '#065F46';
        icon.innerHTML = '<i class="fas fa-check"></i>';
        title.textContent = 'Conectado a Firebase';
        desc.textContent = 'Los datos se sincronizan en la nube';
    } else {
        icon.style.background = '#FEE2E2';
        icon.style.color = '#991B1B';
        icon.innerHTML = '<i class="fas fa-times"></i>';
        title.textContent = 'Modo Local';
        desc.textContent = 'Los datos se guardan en este navegador únicamente';
    }
}

// ==================== EMAIL NOTIFICATIONS (EmailJS) ====================
let emailConfig = {
    enabled: false,
    publicKey: '',
    serviceId: '',
    templateId: '',
    adminEmail: ''
};

function loadEmailConfig() {
    const saved = localStorage.getItem('ferrecloud_email_config');
    if(saved) {
        emailConfig = JSON.parse(saved);
        if(emailConfig.publicKey && typeof emailjs !== 'undefined') {
            emailjs.init(emailConfig.publicKey);
        }
    }
    updateEmailStatusPanel();
}

function updateEmailStatusPanel() {
    const el = document.getElementById('emailNotifStatus');
    if(!el) return;
    
    if(emailConfig.enabled && emailConfig.publicKey && emailConfig.serviceId && emailConfig.templateId) {
        el.innerHTML = '<i class="fas fa-circle" style="color:#10B981;"></i><span>Notificaciones activadas - Recibirás emails en: <strong>' + emailConfig.adminEmail + '</strong></span>';
    } else {
        el.innerHTML = '<i class="fas fa-circle" style="color:#EF4444;"></i><span>Notificaciones desactivadas</span>';
    }
}

function saveEmailConfig() {
    emailConfig.publicKey = document.getElementById('emailjsPublicKey').value.trim();
    emailConfig.serviceId = document.getElementById('emailjsServiceId').value.trim();
    emailConfig.templateId = document.getElementById('emailjsTemplateId').value.trim();
    emailConfig.adminEmail = document.getElementById('emailjsAdminEmail').value.trim();
    emailConfig.enabled = document.getElementById('emailjsEnabled').checked;
    
    if(emailConfig.enabled && (!emailConfig.publicKey || !emailConfig.serviceId || !emailConfig.templateId || !emailConfig.adminEmail)) {
        showToast('error', 'Error', 'Completá todos los campos para activar notificaciones');
        return;
    }
    
    localStorage.setItem('ferrecloud_email_config', JSON.stringify(emailConfig));
    
    if(emailConfig.publicKey && typeof emailjs !== 'undefined') {
        emailjs.init(emailConfig.publicKey);
    }
    
    updateEmailStatusPanel();
    showToast('success', 'Guardado', 'Configuración de email guardada');
}

function loadEmailConfigToForm() {
    if(document.getElementById('emailjsPublicKey')) {
        document.getElementById('emailjsPublicKey').value = emailConfig.publicKey || '';
        document.getElementById('emailjsServiceId').value = emailConfig.serviceId || '';
        document.getElementById('emailjsTemplateId').value = emailConfig.templateId || '';
        document.getElementById('emailjsAdminEmail').value = emailConfig.adminEmail || '';
        document.getElementById('emailjsEnabled').checked = emailConfig.enabled || false;
    }
}

function testEmailNotification() {
    if(!emailConfig.publicKey || !emailConfig.serviceId || !emailConfig.templateId) {
        showToast('error', 'Error', 'Primero configurá EmailJS');
        return;
    }
    
    showToast('info', 'Enviando...', 'Enviando email de prueba...');
    
    const testParams = {
        to_email: emailConfig.adminEmail,
        order_id: 'TEST-' + Date.now(),
        customer_name: 'Cliente de Prueba',
        customer_email: 'prueba@test.com',
        customer_phone: '358-1234567',
        customer_address: 'Calle Test 123',
        products: '1x Producto de Prueba - $1.000',
        subtotal: '$1.000',
        shipping: 'Gratis',
        total: '$1.000',
        payment_method: 'Efectivo',
        store_name: appData.company?.name || 'FerreCloud',
        store_phone: appData.company?.phone || ''
    };
    
    emailjs.send(emailConfig.serviceId, emailConfig.templateId, testParams)
        .then(function(response) {
            showToast('success', '¡Email Enviado!', 'Revisá tu bandeja de entrada');
        })
        .catch(function(error) {
            console.error('Error EmailJS:', error);
            showToast('error', 'Error', 'No se pudo enviar: ' + (error.text || error.message || 'Error desconocido'));
        });
}

function sendOrderNotificationEmail(order) {
    if(!emailConfig.enabled || !emailConfig.publicKey || !emailConfig.serviceId || !emailConfig.templateId) {
        console.log('Email notifications disabled or not configured');
        return;
    }
    
    const productsList = order.items.map(i => `${i.qty}x ${i.name} - $${formatNumber(i.price * i.qty)}`).join('\n');
    
    const params = {
        to_email: emailConfig.adminEmail,
        order_id: order.id,
        customer_name: order.customer,
        customer_email: order.email || 'No especificado',
        customer_phone: order.phone,
        customer_address: order.address || 'No especificada',
        products: productsList,
        subtotal: '$' + formatNumber(order.subtotal),
        shipping: order.shipping === 0 ? 'Gratis' : '$' + formatNumber(order.shipping),
        shipping_zone: order.shippingZone || '',
        total: '$' + formatNumber(order.total),
        payment_method: order.paymentMethod || 'No especificado',
        notes: order.notes || 'Sin notas',
        store_name: appData.company?.name || 'FerreCloud',
        store_phone: appData.company?.phone || '',
        order_date: order.date
    };
    
    emailjs.send(emailConfig.serviceId, emailConfig.templateId, params)
        .then(function(response) {
            console.log('Email de pedido enviado correctamente');
        })
        .catch(function(error) {
            console.error('Error enviando email de pedido:', error);
        });
}

// Cargar config de email al iniciar
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        loadEmailConfig();
        loadEmailConfigToForm();
    }, 1000);
});

async function migrateToFirebase() {
    if(!firebaseEnabled) {
        showToast('error', 'Error', 'Primero configurá y conectá Firebase');
        return;
    }
    
    if(!confirm('¿Subir todos los datos locales a Firebase? Esto sobrescribirá los datos en la nube.')) return;
    
    showToast('warning', 'Migrando...', 'Subiendo datos a Firebase...');
    
    try {
        await saveDataToFirebase();
        showToast('success', 'Completado', 'Datos migrados exitosamente a Firebase');
    } catch(e) {
        showToast('error', 'Error', 'No se pudieron migrar los datos: ' + e.message);
    }
}

function adjustStock(id) {
    const p = appData.products.find(x=>x.id===id);
    if(!p) return;
    const newStock = prompt(`Stock de "${p.name}": ${p.stock}\n\nNuevo stock:`,p.stock);
    if(newStock!==null&&!isNaN(newStock)) {
        p.stock = parseInt(newStock);
        saveData(); renderAll(); showToast('success','Actualizado','Stock actualizado');
    }
}

// ==================== ORDER MANAGEMENT ====================
let currentOrderId = null;

function viewOrderDetail(id) {
    const o = appData.orders.find(x => x.id === id);
    if(!o) return;
    
    currentOrderId = id;
    
    document.getElementById('orderModalId').textContent = o.id;
    document.getElementById('orderCustomerName').textContent = o.customer || 'Sin nombre';
    document.getElementById('orderCustomerPhone').textContent = o.phone || 'Sin teléfono';
    document.getElementById('orderCustomerEmail').textContent = o.email || 'Sin email';
    document.getElementById('orderCustomerAddress').textContent = o.address || 'Sin dirección';
    document.getElementById('orderDate').textContent = o.date || '';
    document.getElementById('orderPayment').textContent = o.paymentMethod || 'No especificado';
    document.getElementById('orderPaymentLink').value = o.paymentLink || '';
    document.getElementById('orderNotes').value = o.notes || '';
    
    const statusText = {pending:'Pendiente',processing:'En Proceso',shipped:'Enviado',completed:'Entregado',cancelled:'Cancelado'}[o.status] || 'Pendiente';
    document.getElementById('orderStatus').textContent = statusText;
    document.getElementById('orderStatusSelect').value = o.status || 'pending';
    
    // Renderizar items
    const items = o.items || [];
    document.getElementById('orderItems').innerHTML = items.length ? items.map(item => `
        <div class="order-item">
            <div>
                <div class="order-item-name">${item.name}</div>
                <div class="order-item-qty">Cantidad: ${item.qty}</div>
            </div>
            <div class="order-item-price">$${formatNumber(item.price * item.qty)}</div>
        </div>
    `).join('') : '<p style="text-align:center;color:var(--text-light);padding:20px;">Sin productos registrados</p>';
    
    document.getElementById('orderTotal').textContent = '$' + formatNumber(o.total);
    
    showModal('orderModal');
}

function viewOrder(id) { viewOrderDetail(id); }

function changeOrderStatus(id) {
    const o = appData.orders.find(x => x.id === id);
    if(!o) return;
    
    const statuses = ['pending', 'processing', 'shipped', 'completed', 'cancelled'];
    const statusNames = ['Pendiente', 'En Proceso', 'Enviado', 'Entregado', 'Cancelado'];
    
    const currentIndex = statuses.indexOf(o.status);
    let options = statusNames.map((name, i) => `${i + 1}. ${name}${i === currentIndex ? ' (actual)' : ''}`).join('\n');
    
    const choice = prompt(`Cambiar estado del Pedido #${id}\n\n${options}\n\nIngresá el número:`);
    
    if(choice && choice >= 1 && choice <= 5) {
        o.status = statuses[choice - 1];
        saveData();
        renderAll();
        showToast('success', 'Actualizado', `Pedido #${id} ahora está: ${statusNames[choice - 1]}`);
    }
}

function updateOrderStatus() {
    if(!currentOrderId) return;
    const o = appData.orders.find(x => x.id === currentOrderId);
    if(o) {
        const newStatus = document.getElementById('orderStatusSelect').value;
        const statusText = {pending:'Pendiente',processing:'En Proceso',shipped:'Enviado',completed:'Entregado',cancelled:'Cancelado'}[newStatus];
        document.getElementById('orderStatus').textContent = statusText;
    }
}

function saveOrderChanges() {
    if(!currentOrderId) return;
    const o = appData.orders.find(x => x.id === currentOrderId);
    if(o) {
        o.status = document.getElementById('orderStatusSelect').value;
        o.paymentLink = document.getElementById('orderPaymentLink').value;
        o.notes = document.getElementById('orderNotes').value;
        saveData();
        renderAll();
        closeModal('orderModal');
        showToast('success', 'Guardado', 'Pedido actualizado correctamente');
    }
}

function sendPaymentLink(id) {
    const o = appData.orders.find(x => x.id === id);
    if(!o) return;
    
    const link = prompt('Ingresá el link de pago (Mercado Pago, transferencia, etc.):', o.paymentLink || '');
    if(link !== null) {
        o.paymentLink = link;
        saveData();
        
        if(link && o.phone) {
            const mensaje = `¡Hola ${o.customer}! 👋\n\nTu pedido #${o.id} está listo.\n\n📦 Total: $${formatNumber(o.total)}\n\n💳 Link de pago:\n${link}\n\n¡Gracias por tu compra!`;
            const phone = o.phone.replace(/[^0-9]/g, '');
            const wa = phone.startsWith('54') ? phone : '54' + phone;
            window.open(`https://wa.me/${wa}?text=${encodeURIComponent(mensaje)}`, '_blank');
        } else if(link) {
            showToast('success', 'Link guardado', 'Link de pago actualizado');
        }
    }
}

function sendPaymentLinkFromModal() {
    if(!currentOrderId) return;
    const o = appData.orders.find(x => x.id === currentOrderId);
    const link = document.getElementById('orderPaymentLink').value;
    
    if(!link) {
        showToast('error', 'Error', 'Ingresá un link de pago');
        return;
    }
    
    if(!o.phone) {
        showToast('error', 'Error', 'El cliente no tiene teléfono registrado');
        return;
    }
    
    o.paymentLink = link;
    saveData();
    
    const mensaje = `¡Hola ${o.customer}! 👋\n\nTu pedido #${o.id} está listo.\n\n📦 Total: $${formatNumber(o.total)}\n\n💳 Link de pago:\n${link}\n\n¡Gracias por tu compra!`;
    const phone = o.phone.replace(/[^0-9]/g, '');
    const wa = phone.startsWith('54') ? phone : '54' + phone;
    window.open(`https://wa.me/${wa}?text=${encodeURIComponent(mensaje)}`, '_blank');
}

function contactCustomerOrder(id) {
    const o = appData.orders.find(x => x.id === id);
    if(!o || !o.phone) {
        showToast('error', 'Error', 'El cliente no tiene teléfono registrado');
        return;
    }
    
    const statusText = {pending:'pendiente',processing:'en proceso',shipped:'enviado',completed:'entregado',cancelled:'cancelado'}[o.status] || 'pendiente';
    const mensaje = `¡Hola ${o.customer}! 👋\n\nTe escribimos de ${window.companyName || 'la ferretería'} por tu pedido #${o.id}.\n\nEstado: ${statusText}\nTotal: $${formatNumber(o.total)}\n\n¿En qué podemos ayudarte?`;
    
    const phone = o.phone.replace(/[^0-9]/g, '');
    const wa = phone.startsWith('54') ? phone : '54' + phone;
    window.open(`https://wa.me/${wa}?text=${encodeURIComponent(mensaje)}`, '_blank');
}

function contactCustomerFromModal() {
    if(currentOrderId) contactCustomerOrder(currentOrderId);
}

function editCustomer(id) { showToast('info','Info','Función en desarrollo'); }
function showCustomerModal() { showToast('info','Info','Función en desarrollo'); }
function showShippingModal(id = null) {
    document.getElementById('shippingModalTitle').textContent = id ? 'Editar Zona de Envío' : 'Nueva Zona de Envío';
    document.getElementById('shippingId').value = id || '';
    
    if(id) {
        const z = appData.shippingZones.find(x => x.id === id);
        if(z) {
            document.getElementById('shippingName').value = z.name || '';
            document.getElementById('shippingTime').value = z.time || '';
            document.getElementById('shippingCost').value = z.cost || 0;
            document.getElementById('shippingDescription').value = z.description || '';
            document.getElementById('shippingMinFree').value = z.minFree || 0;
            document.getElementById('shippingActive').checked = z.active !== false;
        }
    } else {
        document.getElementById('shippingForm').reset();
        document.getElementById('shippingActive').checked = true;
    }
    
    showModal('shippingModal');
}

function editShipping(id) { 
    showShippingModal(id); 
}

function saveShipping() {
    const id = document.getElementById('shippingId').value;
    const data = {
        name: document.getElementById('shippingName').value.trim(),
        time: document.getElementById('shippingTime').value.trim(),
        cost: parseFloat(document.getElementById('shippingCost').value) || 0,
        description: document.getElementById('shippingDescription').value.trim(),
        minFree: parseFloat(document.getElementById('shippingMinFree').value) || 0,
        active: document.getElementById('shippingActive').checked
    };
    
    if(!data.name) {
        showToast('error', 'Error', 'Ingresá el nombre de la zona');
        return;
    }
    if(!data.time) {
        showToast('error', 'Error', 'Ingresá el tiempo de entrega');
        return;
    }
    
    if(id) {
        const idx = appData.shippingZones.findIndex(x => x.id === parseInt(id));
        if(idx >= 0) {
            appData.shippingZones[idx] = { ...appData.shippingZones[idx], ...data };
        }
    } else {
        data.id = Date.now();
        appData.shippingZones.push(data);
    }
    
    saveData();
    renderAll();
    closeModal('shippingModal');
    showToast('success', 'Guardado', id ? 'Zona de envío actualizada' : 'Zona de envío creada');
}

function deleteShipping(id) { 
    if(confirm('¿Eliminar esta zona de envío?')) { 
        appData.shippingZones = appData.shippingZones.filter(z => z.id !== id); 
        
        // Eliminar de Firebase si está habilitado
        if(firebaseEnabled && db) {
            try {
                db.collection('shippingZones').doc(String(id)).delete();
            } catch(e) {
                console.log('Error eliminando de Firebase:', e);
            }
        }
        
        saveData(); 
        renderAll(); 
        showToast('success', 'Eliminado', 'Zona de envío eliminada');
    } 
}

// ==================== UTILITIES ====================
function formatNumber(n) { return new Intl.NumberFormat('es-AR').format(n); }

function showToast(type, title, message) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<div class="toast-icon"><i class="fas fa-${type==='success'?'check':type==='error'?'times':'exclamation'}"></i></div><div class="toast-content"><div class="toast-title">${title}</div><div class="toast-message">${message}</div></div>`;
    container.appendChild(toast);
    setTimeout(()=>{toast.style.opacity='0';setTimeout(()=>toast.remove(),300);},4000);
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(o=>{
    o.addEventListener('click',function(e){if(e.target===this) this.classList.remove('active');});
});

// Keyboard shortcuts
document.addEventListener('keydown',function(e){
    if(e.key==='Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(m=>m.classList.remove('active'));
        document.getElementById('cartOverlay').classList.remove('active');
        document.getElementById('cartSidebar').classList.remove('active');
        document.getElementById('adminLoginModal').classList.remove('active');
    }
});

// Cargar estado Firebase en panel admin
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        updateFirebaseStatusPanel(firebaseEnabled);
        const savedConfig = localStorage.getItem('ferrecloud_firebase_config');
        if(savedConfig) {
            const cfg = JSON.parse(savedConfig);
            if(document.getElementById('fbApiKey')) {
                document.getElementById('fbApiKey').value = cfg.apiKey || '';
                document.getElementById('fbProjectId').value = cfg.projectId || '';
                document.getElementById('fbAuthDomain').value = cfg.authDomain || '';
                document.getElementById('fbStorageBucket').value = cfg.storageBucket || '';            }
        }
    }, 2000);
});

// FALLBACK: Si después de 3 segundos el loader sigue visible, forzar mostrar tienda
setTimeout(function() {
    var l = document.getElementById("loader");
    var s = document.getElementById("storeView");
    if(l && s && s.style.display === "none") {
        console.log("Fallback: forzando mostrar tienda");
        l.style.display = "none";
        s.style.display = "block";
    }
}, 3000);
    </script>
</body>
</html>
